........................................................................ [  6%]
....F...FFFFFFF..FFFFFFFFFFFFFFFFFFF.........FFFFFF.................F... [ 12%]
....FFFF....F...F..........F...F........................................ [ 18%]
....................FFFF.......FFFFFF....................FFFF........... [ 24%]
...........F..FsFFFFFF..F.FF.......s...FF.........................FFFFFF [ 30%]
......FFEEEFFFEFFEEEFEFF.......EFE................................FF.... [ 36%]
........................................................................ [ 42%]
.......EEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE................................. [ 48%]
........................................................................ [ 54%]
........................................................................ [ 61%]
...F..........F......FFFFFFFF........................................... [ 67%]
........................................................................ [ 73%]
......FF................................................................ [ 79%]
...........F............F.......F.....FFFFFFFFFF........................ [ 85%]
..............F...FFF.F.FF.........FFFFFFFFFFFF.F.F..................... [ 91%]
..F....FFFF...........................F.F..F.............FF.FFF......... [ 97%]
...........................<unknown>:13: DeprecationWarning: invalid escape sequence '\`'
/Users/parkersligting/develop/pt/worktrees/harness-agent-rework/dawn_kestrel/agents/bolt_merlin/librarian/__init__.py:13: DeprecationWarning: invalid escape sequence '\`'
  LIBRARIAN_PROMPT = """# THE LIBRARIAN
/Users/parkersligting/.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/re/__init__.py:223: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
  return _compile(pattern, flags).finditer(string)
RuntimeWarning: Enable tracemalloc to get the object allocation traceback
                                              [100%]
==================================== ERRORS ====================================
___________ ERROR at setup of test_build_context_extract_agent_name ____________

mock_discovery = <MagicMock spec='EntryPointDiscovery' id='4587729936'>

    @pytest.fixture
    def orchestrator_with_mock_discovery(mock_discovery):
        """Orchestrator with mocked discovery."""
>       agent = TestReviewerAgent(agent_name="TestReviewer", is_relevant=True)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class TestReviewerAgent with abstract method get_allowed_tools

tests/review/test_orchestrator_entry_points.py:148: TypeError
________ ERROR at setup of test_build_context_with_successful_discovery ________

mock_discovery = <MagicMock spec='EntryPointDiscovery' id='4587675472'>

    @pytest.fixture
    def orchestrator_with_mock_discovery(mock_discovery):
        """Orchestrator with mocked discovery."""
>       agent = TestReviewerAgent(agent_name="TestReviewer", is_relevant=True)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class TestReviewerAgent with abstract method get_allowed_tools

tests/review/test_orchestrator_entry_points.py:148: TypeError
___ ERROR at setup of test_build_context_with_none_discovery_relevant_agent ____

mock_discovery = <MagicMock spec='EntryPointDiscovery' id='4599575376'>

    @pytest.fixture
    def orchestrator_with_mock_discovery(mock_discovery):
        """Orchestrator with mocked discovery."""
>       agent = TestReviewerAgent(agent_name="TestReviewer", is_relevant=True)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class TestReviewerAgent with abstract method get_allowed_tools

tests/review/test_orchestrator_entry_points.py:148: TypeError
______ ERROR at setup of test_build_context_filters_files_to_entry_points ______

mock_discovery = <MagicMock spec='EntryPointDiscovery' id='4599512400'>

    @pytest.fixture
    def orchestrator_with_mock_discovery(mock_discovery):
        """Orchestrator with mocked discovery."""
>       agent = TestReviewerAgent(agent_name="TestReviewer", is_relevant=True)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class TestReviewerAgent with abstract method get_allowed_tools

tests/review/test_orchestrator_entry_points.py:148: TypeError
____ ERROR at setup of test_build_context_discovery_integration_parameters _____

mock_discovery = <MagicMock spec='EntryPointDiscovery' id='4603151824'>

    @pytest.fixture
    def orchestrator_with_mock_discovery(mock_discovery):
        """Orchestrator with mocked discovery."""
>       agent = TestReviewerAgent(agent_name="TestReviewer", is_relevant=True)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class TestReviewerAgent with abstract method get_allowed_tools

tests/review/test_orchestrator_entry_points.py:148: TypeError
_________ ERROR at setup of test_build_context_logs_discovery_success __________

mock_discovery = <MagicMock spec='EntryPointDiscovery' id='4601009680'>

    @pytest.fixture
    def orchestrator_with_mock_discovery(mock_discovery):
        """Orchestrator with mocked discovery."""
>       agent = TestReviewerAgent(agent_name="TestReviewer", is_relevant=True)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class TestReviewerAgent with abstract method get_allowed_tools

tests/review/test_orchestrator_entry_points.py:148: TypeError
______________ ERROR at setup of test_build_context_logs_fallback ______________

mock_discovery = <MagicMock spec='EntryPointDiscovery' id='4423453392'>

    @pytest.fixture
    def orchestrator_with_mock_discovery(mock_discovery):
        """Orchestrator with mocked discovery."""
>       agent = TestReviewerAgent(agent_name="TestReviewer", is_relevant=True)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class TestReviewerAgent with abstract method get_allowed_tools

tests/review/test_orchestrator_entry_points.py:148: TypeError
__________ ERROR at setup of test_build_context_populates_all_fields ___________

mock_discovery = <MagicMock spec='EntryPointDiscovery' id='4586219088'>

    @pytest.fixture
    def orchestrator_with_mock_discovery(mock_discovery):
        """Orchestrator with mocked discovery."""
>       agent = TestReviewerAgent(agent_name="TestReviewer", is_relevant=True)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class TestReviewerAgent with abstract method get_allowed_tools

tests/review/test_orchestrator_entry_points.py:148: TypeError
_ ERROR at setup of TestFixtureCompatibility.test_orchestrator_compatibility_minimal _

self = <review.test_parity_baseline.TestFixtureCompatibility object at 0x107ab5290>

    @pytest.fixture
    def mock_reviewer(self):
        """Create a mock reviewer agent that returns minimal fixture output."""
    
        class MockReviewer(BaseReviewerAgent):
            def get_agent_name(self) -> str:
                return "security"
    
            async def review(self, context: ReviewContext) -> ReviewOutput:
                # Return minimal fixture output (no findings, merge severity)
                return ReviewOutput(
                    agent="security",
                    summary="No security issues found in reviewed files",
                    severity="merge",
                    scope=Scope(
                        relevant_files=["config/auth.py", "config/routes.py"],
                        ignored_files=[],
                        reasoning="Reviewed authentication and API route files for common security vulnerabilities"
                    ),
                    checks=[],
                    skips=[],
                    findings=[],
                    merge_gate=MergeGate(
                        decision="approve",
                        must_fix=[],
                        should_fix=[],
                        notes_for_coding_agent=[]
                    )
                )
    
            def get_system_prompt(self) -> str:
                return "Mock security review agent"
    
            def get_relevant_file_patterns(self) -> list[str]:
                return ["*.py"]
    
>       return MockReviewer()
               ^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewer with abstract method get_allowed_tools

tests/review/test_parity_baseline.py:178: TypeError
__ ERROR at setup of TestFixtureCompatibility.test_orchestrator_deduplication __

self = <review.test_parity_baseline.TestFixtureCompatibility object at 0x107ab5850>

    @pytest.fixture
    def mock_reviewer(self):
        """Create a mock reviewer agent that returns minimal fixture output."""
    
        class MockReviewer(BaseReviewerAgent):
            def get_agent_name(self) -> str:
                return "security"
    
            async def review(self, context: ReviewContext) -> ReviewOutput:
                # Return minimal fixture output (no findings, merge severity)
                return ReviewOutput(
                    agent="security",
                    summary="No security issues found in reviewed files",
                    severity="merge",
                    scope=Scope(
                        relevant_files=["config/auth.py", "config/routes.py"],
                        ignored_files=[],
                        reasoning="Reviewed authentication and API route files for common security vulnerabilities"
                    ),
                    checks=[],
                    skips=[],
                    findings=[],
                    merge_gate=MergeGate(
                        decision="approve",
                        must_fix=[],
                        should_fix=[],
                        notes_for_coding_agent=[]
                    )
                )
    
            def get_system_prompt(self) -> str:
                return "Mock security review agent"
    
            def get_relevant_file_patterns(self) -> list[str]:
                return ["*.py"]
    
>       return MockReviewer()
               ^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewer with abstract method get_allowed_tools

tests/review/test_parity_baseline.py:178: TypeError
_ ERROR at setup of TestSelfVerification.test_verify_findings_with_valid_findings _

self = <review.test_self_verification.TestSelfVerification object at 0x107b749d0>

    @pytest.fixture
    def reviewer(self):
        """Create a MockReviewerAgent instance."""
>       return MockReviewerAgent()
               ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/test_self_verification.py:50: TypeError
_ ERROR at setup of TestSelfVerification.test_verify_findings_with_empty_findings _

self = <review.test_self_verification.TestSelfVerification object at 0x107b74dd0>

    @pytest.fixture
    def reviewer(self):
        """Create a MockReviewerAgent instance."""
>       return MockReviewerAgent()
               ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/test_self_verification.py:50: TypeError
_ ERROR at setup of TestSelfVerification.test_verify_findings_with_invalid_finding_objects _

self = <review.test_self_verification.TestSelfVerification object at 0x107b75150>

    @pytest.fixture
    def reviewer(self):
        """Create a MockReviewerAgent instance."""
>       return MockReviewerAgent()
               ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/test_self_verification.py:50: TypeError
_ ERROR at setup of TestSelfVerification.test_verify_findings_evidence_structure_complete _

self = <review.test_self_verification.TestSelfVerification object at 0x107b754d0>

    @pytest.fixture
    def reviewer(self):
        """Create a MockReviewerAgent instance."""
>       return MockReviewerAgent()
               ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/test_self_verification.py:50: TypeError
_ ERROR at setup of TestSelfVerification.test_extract_search_terms_with_quoted_strings _

self = <review.test_self_verification.TestSelfVerification object at 0x107b75a10>

    @pytest.fixture
    def reviewer(self):
        """Create a MockReviewerAgent instance."""
>       return MockReviewerAgent()
               ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/test_self_verification.py:50: TypeError
_ ERROR at setup of TestSelfVerification.test_extract_search_terms_with_single_quotes _

self = <review.test_self_verification.TestSelfVerification object at 0x107b760d0>

    @pytest.fixture
    def reviewer(self):
        """Create a MockReviewerAgent instance."""
>       return MockReviewerAgent()
               ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/test_self_verification.py:50: TypeError
_ ERROR at setup of TestSelfVerification.test_extract_search_terms_with_code_identifiers _

self = <review.test_self_verification.TestSelfVerification object at 0x107b76790>

    @pytest.fixture
    def reviewer(self):
        """Create a MockReviewerAgent instance."""
>       return MockReviewerAgent()
               ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/test_self_verification.py:50: TypeError
_ ERROR at setup of TestSelfVerification.test_extract_search_terms_with_assignments _

self = <review.test_self_verification.TestSelfVerification object at 0x107b76e50>

    @pytest.fixture
    def reviewer(self):
        """Create a MockReviewerAgent instance."""
>       return MockReviewerAgent()
               ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/test_self_verification.py:50: TypeError
_ ERROR at setup of TestSelfVerification.test_extract_search_terms_with_title_all_caps _

self = <review.test_self_verification.TestSelfVerification object at 0x107b77510>

    @pytest.fixture
    def reviewer(self):
        """Create a MockReviewerAgent instance."""
>       return MockReviewerAgent()
               ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/test_self_verification.py:50: TypeError
_ ERROR at setup of TestSelfVerification.test_extract_search_terms_filters_common_words _

self = <review.test_self_verification.TestSelfVerification object at 0x107b77b90>

    @pytest.fixture
    def reviewer(self):
        """Create a MockReviewerAgent instance."""
>       return MockReviewerAgent()
               ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/test_self_verification.py:50: TypeError
_ ERROR at setup of TestSelfVerification.test_extract_search_terms_limits_to_five_terms _

self = <review.test_self_verification.TestSelfVerification object at 0x107b7c290>

    @pytest.fixture
    def reviewer(self):
        """Create a MockReviewerAgent instance."""
>       return MockReviewerAgent()
               ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/test_self_verification.py:50: TypeError
_ ERROR at setup of TestSelfVerification.test_extract_search_terms_filters_empty_strings _

self = <review.test_self_verification.TestSelfVerification object at 0x107b7c950>

    @pytest.fixture
    def reviewer(self):
        """Create a MockReviewerAgent instance."""
>       return MockReviewerAgent()
               ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/test_self_verification.py:50: TypeError
_ ERROR at setup of TestSelfVerification.test_extract_search_terms_mixed_patterns _

self = <review.test_self_verification.TestSelfVerification object at 0x107b7d010>

    @pytest.fixture
    def reviewer(self):
        """Create a MockReviewerAgent instance."""
>       return MockReviewerAgent()
               ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/test_self_verification.py:50: TypeError
_ ERROR at setup of TestSelfVerification.test_extract_search_terms_case_sensitive _

self = <review.test_self_verification.TestSelfVerification object at 0x107b77e10>

    @pytest.fixture
    def reviewer(self):
        """Create a MockReviewerAgent instance."""
>       return MockReviewerAgent()
               ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/test_self_verification.py:50: TypeError
____ ERROR at setup of TestSelfVerification.test_grep_files_with_mock_files ____

self = <review.test_self_verification.TestSelfVerification object at 0x107b77290>

    @pytest.fixture
    def reviewer(self):
        """Create a MockReviewerAgent instance."""
>       return MockReviewerAgent()
               ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/test_self_verification.py:50: TypeError
________ ERROR at setup of TestSelfVerification.test_grep_files_timeout ________

self = <review.test_self_verification.TestSelfVerification object at 0x107b76950>

    @pytest.fixture
    def reviewer(self):
        """Create a MockReviewerAgent instance."""
>       return MockReviewerAgent()
               ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/test_self_verification.py:50: TypeError
______ ERROR at setup of TestSelfVerification.test_grep_files_no_matches _______

self = <review.test_self_verification.TestSelfVerification object at 0x107b75c10>

    @pytest.fixture
    def reviewer(self):
        """Create a MockReviewerAgent instance."""
>       return MockReviewerAgent()
               ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/test_self_verification.py:50: TypeError
____ ERROR at setup of TestSelfVerification.test_grep_files_multiple_files _____

self = <review.test_self_verification.TestSelfVerification object at 0x107b50ad0>

    @pytest.fixture
    def reviewer(self):
        """Create a MockReviewerAgent instance."""
>       return MockReviewerAgent()
               ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/test_self_verification.py:50: TypeError
____ ERROR at setup of TestSelfVerification.test_grep_files_file_not_exists ____

self = <review.test_self_verification.TestSelfVerification object at 0x107adbc90>

    @pytest.fixture
    def reviewer(self):
        """Create a MockReviewerAgent instance."""
>       return MockReviewerAgent()
               ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/test_self_verification.py:50: TypeError
_ ERROR at setup of TestSelfVerification.test_grep_uses_fixed_string_matching __

self = <review.test_self_verification.TestSelfVerification object at 0x107b7cd90>

    @pytest.fixture
    def reviewer(self):
        """Create a MockReviewerAgent instance."""
>       return MockReviewerAgent()
               ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/test_self_verification.py:50: TypeError
______ ERROR at setup of TestSelfVerification.test_grep_uses_line_numbers ______

self = <review.test_self_verification.TestSelfVerification object at 0x107b7d750>

    @pytest.fixture
    def reviewer(self):
        """Create a MockReviewerAgent instance."""
>       return MockReviewerAgent()
               ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/test_self_verification.py:50: TypeError
____ ERROR at setup of TestSelfVerification.test_grep_parsing_line_numbers _____

self = <review.test_self_verification.TestSelfVerification object at 0x107b7ddd0>

    @pytest.fixture
    def reviewer(self):
        """Create a MockReviewerAgent instance."""
>       return MockReviewerAgent()
               ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/test_self_verification.py:50: TypeError
______ ERROR at setup of TestSelfVerification.test_grep_malformed_output _______

self = <review.test_self_verification.TestSelfVerification object at 0x107b7e450>

    @pytest.fixture
    def reviewer(self):
        """Create a MockReviewerAgent instance."""
>       return MockReviewerAgent()
               ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/test_self_verification.py:50: TypeError
_ ERROR at setup of TestSelfVerification.test_backward_compatibility_existing_methods _

self = <review.test_self_verification.TestSelfVerification object at 0x107b7eb50>

    @pytest.fixture
    def reviewer(self):
        """Create a MockReviewerAgent instance."""
>       return MockReviewerAgent()
               ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/test_self_verification.py:50: TypeError
_ ERROR at setup of TestSelfVerification.test_performance_multiple_findings_multiple_terms _

self = <review.test_self_verification.TestSelfVerification object at 0x107b7f190>

    @pytest.fixture
    def reviewer(self):
        """Create a MockReviewerAgent instance."""
>       return MockReviewerAgent()
               ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/test_self_verification.py:50: TypeError
_____ ERROR at setup of TestSelfVerification.test_empty_evidence_and_title _____

self = <review.test_self_verification.TestSelfVerification object at 0x107b7f850>

    @pytest.fixture
    def reviewer(self):
        """Create a MockReviewerAgent instance."""
>       return MockReviewerAgent()
               ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/test_self_verification.py:50: TypeError
________ ERROR at setup of TestSelfVerification.test_very_long_evidence ________

self = <review.test_self_verification.TestSelfVerification object at 0x107b7ff10>

    @pytest.fixture
    def reviewer(self):
        """Create a MockReviewerAgent instance."""
>       return MockReviewerAgent()
               ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/test_self_verification.py:50: TypeError
__ ERROR at setup of TestSelfVerification.test_special_characters_in_pattern ___

self = <review.test_self_verification.TestSelfVerification object at 0x107b805d0>

    @pytest.fixture
    def reviewer(self):
        """Create a MockReviewerAgent instance."""
>       return MockReviewerAgent()
               ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/test_self_verification.py:50: TypeError
_______ ERROR at setup of TestSelfVerification.test_unicode_in_evidence ________

self = <review.test_self_verification.TestSelfVerification object at 0x107b80c90>

    @pytest.fixture
    def reviewer(self):
        """Create a MockReviewerAgent instance."""
>       return MockReviewerAgent()
               ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/test_self_verification.py:50: TypeError
__ ERROR at setup of TestSelfVerification.test_verify_findings_logs_warnings ___

self = <review.test_self_verification.TestSelfVerification object at 0x107b7fe10>

    @pytest.fixture
    def reviewer(self):
        """Create a MockReviewerAgent instance."""
>       return MockReviewerAgent()
               ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/test_self_verification.py:50: TypeError
____ ERROR at setup of TestSelfVerification.test_full_verification_workflow ____

self = <review.test_self_verification.TestSelfVerification object at 0x107b7c090>

    @pytest.fixture
    def reviewer(self):
        """Create a MockReviewerAgent instance."""
>       return MockReviewerAgent()
               ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/test_self_verification.py:50: TypeError
_ ERROR at setup of TestSelfVerification.test_multiple_search_terms_per_finding _

self = <review.test_self_verification.TestSelfVerification object at 0x107b80a90>

    @pytest.fixture
    def reviewer(self):
        """Create a MockReviewerAgent instance."""
>       return MockReviewerAgent()
               ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/test_self_verification.py:50: TypeError
=================================== FAILURES ===================================
_ TestSecurityReviewerLLMBased.test_review_includes_system_prompt_and_context_in_message _

self = <test_security_reviewer.TestSecurityReviewerLLMBased object at 0x1078d5590>
reviewer = <dawn_kestrel.agents.review.agents.security.SecurityReviewer object at 0x111561990>
sample_context = ReviewContext(changed_files=['src/auth.py', 'config/api.yaml'], diff="+ api_key = 'sk-1234567890abcdef'\n+ password = 'secret123'", repo_root='/test/repo', base_ref='main', head_ref='feature/add-auth', pr_title=None, pr_description=None)
mock_session = Session(id='test-session-id', slug='test-session', project_id='test-project', directory='/test/repo', parent_id=None, ...updated=1770613580.89465, time_compacting=None, time_archived=None, message_counter=0, message_count=0, total_cost=0.0)
sample_review_output_json = '{\n            "agent": "security",\n            "summary": "Found 1 security issue(s).",\n            "severity": "c...sure all secrets are stored in environment variables or secret managers."\n                ]\n            }\n        }'

    @pytest.mark.asyncio
    async def test_review_includes_system_prompt_and_context_in_message(
        self, reviewer, sample_context, mock_session, sample_review_output_json
    ):
        """Test that review() includes system prompt and formatted context."""
        # Mock AISession
        mock_ai_session = MagicMock()
        mock_message = MagicMock()
        mock_message.text = sample_review_output_json
    
        captured_message = None
    
        async def mock_process_message(user_message, options=None):
            nonlocal captured_message
            captured_message = user_message
            return mock_message
    
        mock_ai_session.process_message = mock_process_message
    
        # Patch AISession
        with patch("dawn_kestrel.agents.review.agents.security.AISession") as mock_ai_session_cls:
            mock_ai_session_cls.return_value = mock_ai_session
    
            # Patch Session creation
            with patch("dawn_kestrel.agents.review.agents.security.Session") as mock_session_cls:
                mock_session_cls.return_value = mock_session
    
                await reviewer.review(sample_context)
    
                # Verify message includes context
>               assert captured_message is not None
E               assert None is not None

tests/review/agents/test_security_reviewer.py:204: AssertionError
_ TestUnitTestsReviewerLLMBased.test_review_creates_ai_session_and_calls_process_message _

self = <test_unit_tests_reviewer.TestUnitTestsReviewerLLMBased object at 0x1078d4ed0>
reviewer = <dawn_kestrel.agents.review.agents.unit_tests.UnitTestsReviewer object at 0x1114dd6d0>
sample_context = ReviewContext(changed_files=['src/calculator.py', 'tests/test_calculator.py'], diff='+ def add(a: int, b: int) -> int:...a + b', repo_root='/test/repo', base_ref='main', head_ref='feature/add-calculator', pr_title=None, pr_description=None)
mock_session = Session(id='test-session-id', slug='test-session', project_id='test-project', directory='/test/repo', parent_id=None, ...pdated=1770613599.870253, time_compacting=None, time_archived=None, message_counter=0, message_count=0, total_cost=0.0)
sample_review_output_json = '{\n            "agent": "unit_tests",\n            "summary": "Unit test review complete.",\n            "severity": ...ent": [\n                    "Add unit tests for the new add() function."\n                ]\n            }\n        }'

    @pytest.mark.asyncio
    async def test_review_creates_ai_session_and_calls_process_message(
        self,
        reviewer,
        sample_context,
        mock_session,
        sample_review_output_json
    ):
        """Test that review() creates AISession and calls process_message()."""
        mock_ai_session = MagicMock()
        mock_message = MagicMock()
        mock_message.text = sample_review_output_json
    
        mock_ai_session.process_message = AsyncMock(return_value=mock_message)
    
>       with patch('dawn_kestrel.agents.review.agents.unit_tests.AISession') as mock_ai_session_cls:

tests/review/agents/test_unit_tests_reviewer.py:92: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1446: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <unittest.mock._patch object at 0x1114e7f90>

    def get_original(self):
        target = self.getter()
        name = self.attribute
    
        original = DEFAULT
        local = False
    
        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True
    
        if name in _builtins and isinstance(target, ModuleType):
            self.create = True
    
        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'dawn_kestrel.agents.review.agents.unit_tests' from '/Users/parkersligting/develop/pt/worktrees/harness-agent-rework/dawn_kestrel/agents/review/agents/unit_tests.py'> does not have the attribute 'AISession'

../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1419: AttributeError
_ TestUnitTestsReviewerLLMBased.test_review_handles_missing_api_key_by_raising_exception _

self = <test_unit_tests_reviewer.TestUnitTestsReviewerLLMBased object at 0x1078c89d0>
reviewer = <dawn_kestrel.agents.review.agents.unit_tests.UnitTestsReviewer object at 0x11171e350>
sample_context = ReviewContext(changed_files=['src/calculator.py', 'tests/test_calculator.py'], diff='+ def add(a: int, b: int) -> int:...a + b', repo_root='/test/repo', base_ref='main', head_ref='feature/add-calculator', pr_title=None, pr_description=None)
mock_session = Session(id='test-session-id', slug='test-session', project_id='test-project', directory='/test/repo', parent_id=None, ...pdated=1770613599.911932, time_compacting=None, time_archived=None, message_counter=0, message_count=0, total_cost=0.0)

    @pytest.mark.asyncio
    async def test_review_handles_missing_api_key_by_raising_exception(
        self,
        reviewer,
        sample_context,
        mock_session
    ):
        """Test that review() raises exception when API key is missing."""
        mock_ai_session = MagicMock()
    
        async def mock_process_message(user_message, options=None):
            raise ValueError("API key not found for provider")
    
        mock_ai_session.process_message = mock_process_message
    
>       with patch('dawn_kestrel.agents.review.agents.unit_tests.AISession') as mock_ai_session_cls:

tests/review/agents/test_unit_tests_reviewer.py:127: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1446: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <unittest.mock._patch object at 0x11171d610>

    def get_original(self):
        target = self.getter()
        name = self.attribute
    
        original = DEFAULT
        local = False
    
        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True
    
        if name in _builtins and isinstance(target, ModuleType):
            self.create = True
    
        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'dawn_kestrel.agents.review.agents.unit_tests' from '/Users/parkersligting/develop/pt/worktrees/harness-agent-rework/dawn_kestrel/agents/review/agents/unit_tests.py'> does not have the attribute 'AISession'

../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1419: AttributeError
___ TestUnitTestsReviewerLLMBased.test_review_handles_invalid_json_response ____

self = <test_unit_tests_reviewer.TestUnitTestsReviewerLLMBased object at 0x1078bf250>
reviewer = <dawn_kestrel.agents.review.agents.unit_tests.UnitTestsReviewer object at 0x111737250>
sample_context = ReviewContext(changed_files=['src/calculator.py', 'tests/test_calculator.py'], diff='+ def add(a: int, b: int) -> int:...a + b', repo_root='/test/repo', base_ref='main', head_ref='feature/add-calculator', pr_title=None, pr_description=None)
mock_session = Session(id='test-session-id', slug='test-session', project_id='test-project', directory='/test/repo', parent_id=None, ...pdated=1770613599.952738, time_compacting=None, time_archived=None, message_counter=0, message_count=0, total_cost=0.0)

    @pytest.mark.asyncio
    async def test_review_handles_invalid_json_response(
        self,
        reviewer,
        sample_context,
        mock_session
    ):
        """Test that review() returns error ReviewOutput for invalid JSON."""
        mock_ai_session = MagicMock()
        mock_message = MagicMock()
        mock_message.text = "This is not valid JSON"
    
        async def mock_process_message(user_message, options=None):
            return mock_message
    
        mock_ai_session.process_message = mock_process_message
    
>       with patch('dawn_kestrel.agents.review.agents.unit_tests.AISession') as mock_ai_session_cls:

tests/review/agents/test_unit_tests_reviewer.py:153: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1446: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <unittest.mock._patch object at 0x1115f0290>

    def get_original(self):
        target = self.getter()
        name = self.attribute
    
        original = DEFAULT
        local = False
    
        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True
    
        if name in _builtins and isinstance(target, ModuleType):
            self.create = True
    
        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'dawn_kestrel.agents.review.agents.unit_tests' from '/Users/parkersligting/develop/pt/worktrees/harness-agent-rework/dawn_kestrel/agents/review/agents/unit_tests.py'> does not have the attribute 'AISession'

../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1419: AttributeError
_ TestUnitTestsReviewerLLMBased.test_review_handles_timeout_error_by_raising_exception _

self = <test_unit_tests_reviewer.TestUnitTestsReviewerLLMBased object at 0x1078dc550>
reviewer = <dawn_kestrel.agents.review.agents.unit_tests.UnitTestsReviewer object at 0x1114e2c50>
sample_context = ReviewContext(changed_files=['src/calculator.py', 'tests/test_calculator.py'], diff='+ def add(a: int, b: int) -> int:...a + b', repo_root='/test/repo', base_ref='main', head_ref='feature/add-calculator', pr_title=None, pr_description=None)
mock_session = Session(id='test-session-id', slug='test-session', project_id='test-project', directory='/test/repo', parent_id=None, ...pdated=1770613599.992997, time_compacting=None, time_archived=None, message_counter=0, message_count=0, total_cost=0.0)

    @pytest.mark.asyncio
    async def test_review_handles_timeout_error_by_raising_exception(
        self,
        reviewer,
        sample_context,
        mock_session
    ):
        """Test that review() raises exception on timeout."""
        mock_ai_session = MagicMock()
    
        async def mock_process_message(user_message, options=None):
            raise TimeoutError("Request timed out after 60s")
    
        mock_ai_session.process_message = mock_process_message
    
>       with patch('dawn_kestrel.agents.review.agents.unit_tests.AISession') as mock_ai_session_cls:

tests/review/agents/test_unit_tests_reviewer.py:180: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1446: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <unittest.mock._patch object at 0x111752690>

    def get_original(self):
        target = self.getter()
        name = self.attribute
    
        original = DEFAULT
        local = False
    
        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True
    
        if name in _builtins and isinstance(target, ModuleType):
            self.create = True
    
        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'dawn_kestrel.agents.review.agents.unit_tests' from '/Users/parkersligting/develop/pt/worktrees/harness-agent-rework/dawn_kestrel/agents/review/agents/unit_tests.py'> does not have the attribute 'AISession'

../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1419: AttributeError
_ TestUnitTestsReviewerLLMBased.test_review_with_no_findings_returns_merge_severity _

self = <test_unit_tests_reviewer.TestUnitTestsReviewerLLMBased object at 0x1078dcd50>
reviewer = <dawn_kestrel.agents.review.agents.unit_tests.UnitTestsReviewer object at 0x111733710>
sample_context = ReviewContext(changed_files=['src/calculator.py', 'tests/test_calculator.py'], diff='+ def add(a: int, b: int) -> int:...a + b', repo_root='/test/repo', base_ref='main', head_ref='feature/add-calculator', pr_title=None, pr_description=None)
mock_session = Session(id='test-session-id', slug='test-session', project_id='test-project', directory='/test/repo', parent_id=None, ...pdated=1770613600.052046, time_compacting=None, time_archived=None, message_counter=0, message_count=0, total_cost=0.0)

    @pytest.mark.asyncio
    async def test_review_with_no_findings_returns_merge_severity(
        self,
        reviewer,
        sample_context,
        mock_session
    ):
        """Test that review() returns severity='merge' when no findings."""
        mock_ai_session = MagicMock()
        mock_message = MagicMock()
        mock_message.text = """{
            "agent": "unit_tests",
            "summary": "No test issues detected.",
            "severity": "merge",
            "scope": {
                "relevant_files": ["src/calculator.py"],
                "ignored_files": [],
                "reasoning": "Unit test review analyzed 1 relevant file."
            },
            "findings": [],
            "merge_gate": {
                "decision": "approve",
                "must_fix": [],
                "should_fix": [],
                "notes_for_coding_agent": []
            }
        }"""
    
        async def mock_process_message(user_message, options=None):
            return mock_message
    
        mock_ai_session.process_message = mock_process_message
    
>       with patch('dawn_kestrel.agents.review.agents.unit_tests.AISession') as mock_ai_session_cls:

tests/review/agents/test_unit_tests_reviewer.py:222: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1446: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <unittest.mock._patch object at 0x111700050>

    def get_original(self):
        target = self.getter()
        name = self.attribute
    
        original = DEFAULT
        local = False
    
        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True
    
        if name in _builtins and isinstance(target, ModuleType):
            self.create = True
    
        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'dawn_kestrel.agents.review.agents.unit_tests' from '/Users/parkersligting/develop/pt/worktrees/harness-agent-rework/dawn_kestrel/agents/review/agents/unit_tests.py'> does not have the attribute 'AISession'

../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1419: AttributeError
_ TestUnitTestsReviewerLLMBased.test_review_includes_system_prompt_and_context_in_message _

self = <test_unit_tests_reviewer.TestUnitTestsReviewerLLMBased object at 0x1078dd550>
reviewer = <dawn_kestrel.agents.review.agents.unit_tests.UnitTestsReviewer object at 0x111533c50>
sample_context = ReviewContext(changed_files=['src/calculator.py', 'tests/test_calculator.py'], diff='+ def add(a: int, b: int) -> int:...a + b', repo_root='/test/repo', base_ref='main', head_ref='feature/add-calculator', pr_title=None, pr_description=None)
mock_session = Session(id='test-session-id', slug='test-session', project_id='test-project', directory='/test/repo', parent_id=None, ...pdated=1770613600.092368, time_compacting=None, time_archived=None, message_counter=0, message_count=0, total_cost=0.0)
sample_review_output_json = '{\n            "agent": "unit_tests",\n            "summary": "Unit test review complete.",\n            "severity": ...ent": [\n                    "Add unit tests for the new add() function."\n                ]\n            }\n        }'

    @pytest.mark.asyncio
    async def test_review_includes_system_prompt_and_context_in_message(
        self,
        reviewer,
        sample_context,
        mock_session,
        sample_review_output_json
    ):
        """Test that review() includes system prompt and formatted context."""
        mock_ai_session = MagicMock()
        mock_message = MagicMock()
        mock_message.text = sample_review_output_json
    
        captured_message = None
    
        async def mock_process_message(user_message, options=None):
            nonlocal captured_message
            captured_message = user_message
            return mock_message
    
        mock_ai_session.process_message = mock_process_message
    
>       with patch('dawn_kestrel.agents.review.agents.unit_tests.AISession') as mock_ai_session_cls:

tests/review/agents/test_unit_tests_reviewer.py:257: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1446: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <unittest.mock._patch object at 0x111724e90>

    def get_original(self):
        target = self.getter()
        name = self.attribute
    
        original = DEFAULT
        local = False
    
        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True
    
        if name in _builtins and isinstance(target, ModuleType):
            self.create = True
    
        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'dawn_kestrel.agents.review.agents.unit_tests' from '/Users/parkersligting/develop/pt/worktrees/harness-agent-rework/dawn_kestrel/agents/review/agents/unit_tests.py'> does not have the attribute 'AISession'

../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1419: AttributeError
_______ TestUnitTestsReviewerLLMBased.test_review_with_blocking_severity _______

self = <test_unit_tests_reviewer.TestUnitTestsReviewerLLMBased object at 0x1078ddd50>
reviewer = <dawn_kestrel.agents.review.agents.unit_tests.UnitTestsReviewer object at 0x111592d10>
sample_context = ReviewContext(changed_files=['src/calculator.py', 'tests/test_calculator.py'], diff='+ def add(a: int, b: int) -> int:...a + b', repo_root='/test/repo', base_ref='main', head_ref='feature/add-calculator', pr_title=None, pr_description=None)
mock_session = Session(id='test-session-id', slug='test-session', project_id='test-project', directory='/test/repo', parent_id=None, ...pdated=1770613600.133024, time_compacting=None, time_archived=None, message_counter=0, message_count=0, total_cost=0.0)

    @pytest.mark.asyncio
    async def test_review_with_blocking_severity(
        self,
        reviewer,
        sample_context,
        mock_session
    ):
        """Test that review() returns blocking severity for failing tests."""
        mock_ai_session = MagicMock()
        mock_message = MagicMock()
        mock_message.text = """{
            "agent": "unit_tests",
            "summary": "Unit test review complete. Found 1 blocking issue(s): - 1 blocking",
            "severity": "blocking",
            "scope": {
                "relevant_files": ["src/calculator.py", "tests/test_calculator.py"],
                "ignored_files": [],
                "reasoning": "Unit test review analyzed 2 relevant files."
            },
            "findings": [
                {
                    "id": "TEST-FAILURE-001",
                    "title": "Test failure in test_calculator.py",
                    "severity": "blocking",
                    "confidence": "high",
                    "owner": "dev",
                    "estimate": "M",
                    "evidence": "Test test_add failed",
                    "risk": "Failing tests indicate broken functionality or regression.",
                    "recommendation": "Fix the failing test or the underlying code.",
                    "suggested_patch": null
                }
            ],
            "merge_gate": {
                "decision": "block",
                "must_fix": ["TEST-FAILURE-001"],
                "should_fix": [],
                "notes_for_coding_agent": [
                    "Fix the failing test test_add in test_calculator.py."
                ]
            }
        }"""
    
        async def mock_process_message(user_message, options=None):
            return mock_message
    
        mock_ai_session.process_message = mock_process_message
    
>       with patch('dawn_kestrel.agents.review.agents.unit_tests.AISession') as mock_ai_session_cls:

tests/review/agents/test_unit_tests_reviewer.py:318: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1446: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <unittest.mock._patch object at 0x111591d10>

    def get_original(self):
        target = self.getter()
        name = self.attribute
    
        original = DEFAULT
        local = False
    
        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True
    
        if name in _builtins and isinstance(target, ModuleType):
            self.create = True
    
        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'dawn_kestrel.agents.review.agents.unit_tests' from '/Users/parkersligting/develop/pt/worktrees/harness-agent-rework/dawn_kestrel/agents/review/agents/unit_tests.py'> does not have the attribute 'AISession'

../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1419: AttributeError
__ TestIsRelevantToChanges.test_is_relevant_to_changes_with_matching_pattern ___

self = <test_base_reviewer.TestIsRelevantToChanges object at 0x1078d4b10>

    def test_is_relevant_to_changes_with_matching_pattern(self):
        """Test that is_relevant_to_changes returns True when files match patterns."""
>       agent = MockReviewerAgent()
                ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/base/test_base_reviewer.py:64: TypeError
_ TestIsRelevantToChanges.test_is_relevant_to_changes_with_no_matching_pattern _

self = <test_base_reviewer.TestIsRelevantToChanges object at 0x1078e8250>

    def test_is_relevant_to_changes_with_no_matching_pattern(self):
        """Test that is_relevant_to_changes returns False when no files match patterns."""
>       agent = MockReviewerAgent()
                ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/base/test_base_reviewer.py:73: TypeError
___ TestIsRelevantToChanges.test_is_relevant_to_changes_with_empty_patterns ____

self = <test_base_reviewer.TestIsRelevantToChanges object at 0x1078e85d0>

    def test_is_relevant_to_changes_with_empty_patterns(self):
        """Test that is_relevant_to_changes returns False when agent has no patterns."""
>       agent = MockReviewerWithNoPatterns()
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerWithNoPatterns with abstract methods get_agent_name, get_allowed_tools

tests/review/base/test_base_reviewer.py:82: TypeError
__ TestIsRelevantToChanges.test_is_relevant_to_changes_with_multiple_patterns __

self = <test_base_reviewer.TestIsRelevantToChanges object at 0x1078e8990>

    def test_is_relevant_to_changes_with_multiple_patterns(self):
        """Test that is_relevant_to_changes returns True when any pattern matches."""
>       agent = MockReviewerAgent()
                ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/base/test_base_reviewer.py:91: TypeError
_ TestIsRelevantToChanges.test_is_relevant_to_changes_with_special_glob_patterns _

self = <test_base_reviewer.TestIsRelevantToChanges object at 0x1078e8d10>

    def test_is_relevant_to_changes_with_special_glob_patterns(self):
        """Test that is_relevant_to_changes works with special glob patterns like **."""
>       agent = MockReviewerAgent()
                ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/base/test_base_reviewer.py:100: TypeError
_____ TestIsRelevantToChanges.test_is_relevant_to_changes_with_nested_path _____

self = <test_base_reviewer.TestIsRelevantToChanges object at 0x1078e9190>

    def test_is_relevant_to_changes_with_nested_path(self):
        """Test that is_relevant_to_changes works with deeply nested paths."""
>       agent = MockReviewerAgent()
                ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/base/test_base_reviewer.py:109: TypeError
_____ TestIsRelevantToChanges.test_is_relevant_to_changes_with_single_file _____

self = <test_base_reviewer.TestIsRelevantToChanges object at 0x1078e9810>

    def test_is_relevant_to_changes_with_single_file(self):
        """Test that is_relevant_to_changes works with a single file."""
>       agent = MockReviewerAgent()
                ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/base/test_base_reviewer.py:118: TypeError
_ TestIsRelevantToChanges.test_is_relevant_to_changes_with_case_sensitive_paths _

self = <test_base_reviewer.TestIsRelevantToChanges object at 0x1078e9e90>

    def test_is_relevant_to_changes_with_case_sensitive_paths(self):
        """Test that is_relevant_to_changes is case-sensitive for nested paths."""
>       agent = MockReviewerAgent()
                ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/base/test_base_reviewer.py:127: TypeError
___ TestIsRelevantToChanges.test_is_relevant_to_changes_with_complex_pattern ___

self = <test_base_reviewer.TestIsRelevantToChanges object at 0x1078ea510>

    def test_is_relevant_to_changes_with_complex_pattern(self):
        """Test that is_relevant_to_changes handles complex patterns correctly."""
>       agent = MockReviewerAgent()
                ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/base/test_base_reviewer.py:136: TypeError
____ TestIsRelevantToChanges.test_is_relevant_to_changes_with_ignored_files ____

self = <test_base_reviewer.TestIsRelevantToChanges object at 0x1078eab50>

    def test_is_relevant_to_changes_with_ignored_files(self):
        """Test that is_relevant_to_changes only matches relevant patterns."""
>       agent = MockReviewerAgent()
                ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/base/test_base_reviewer.py:145: TypeError
________ TestFormatInputsForPrompt.test_format_inputs_for_prompt_basic _________

self = <test_base_reviewer.TestFormatInputsForPrompt object at 0x1078eb450>

    def test_format_inputs_for_prompt_basic(self):
        """Test that format_inputs_for_prompt generates formatted context."""
>       agent = MockReviewerAgent()
                ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/base/test_base_reviewer.py:158: TypeError
___ TestFormatInputsForPrompt.test_format_inputs_for_prompt_without_git_refs ___

self = <test_base_reviewer.TestFormatInputsForPrompt object at 0x1078ebad0>

    def test_format_inputs_for_prompt_without_git_refs(self):
        """Test that format_inputs_for_prompt works without git refs."""
>       agent = MockReviewerAgent()
                ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/base/test_base_reviewer.py:179: TypeError
_____ TestFormatInputsForPrompt.test_format_inputs_for_prompt_with_pr_info _____

self = <test_base_reviewer.TestFormatInputsForPrompt object at 0x1078f8190>

    def test_format_inputs_for_prompt_with_pr_info(self):
        """Test that format_inputs_for_prompt includes PR info when available."""
>       agent = MockReviewerAgent()
                ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/base/test_base_reviewer.py:196: TypeError
____ TestFormatInputsForPrompt.test_format_inputs_for_prompt_multiline_diff ____

self = <test_base_reviewer.TestFormatInputsForPrompt object at 0x1078f8850>

    def test_format_inputs_for_prompt_multiline_diff(self):
        """Test that format_inputs_for_prompt handles multiline diff correctly."""
>       agent = MockReviewerAgent()
                ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/base/test_base_reviewer.py:215: TypeError
____ TestFormatInputsForPrompt.test_format_inputs_for_prompt_multiple_files ____

self = <test_base_reviewer.TestFormatInputsForPrompt object at 0x1078f8ed0>

    def test_format_inputs_for_prompt_multiple_files(self):
        """Test that format_inputs_for_prompt handles multiple changed files."""
>       agent = MockReviewerAgent()
                ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/base/test_base_reviewer.py:231: TypeError
______ TestFormatInputsForPrompt.test_format_inputs_for_prompt_empty_list ______

self = <test_base_reviewer.TestFormatInputsForPrompt object at 0x1078f9550>

    def test_format_inputs_for_prompt_empty_list(self):
        """Test that format_inputs_for_prompt handles empty changed files list."""
>       agent = MockReviewerAgent()
                ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/base/test_base_reviewer.py:246: TypeError
_______ TestFormatInputsForPrompt.test_format_inputs_for_prompt_no_diff ________

self = <test_base_reviewer.TestFormatInputsForPrompt object at 0x1078ea010>

    def test_format_inputs_for_prompt_no_diff(self):
        """Test that format_inputs_for_prompt handles case with no diff."""
>       agent = MockReviewerAgent()
                ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/base/test_base_reviewer.py:261: TypeError
__ TestFormatInputsForPrompt.test_format_inputs_for_prompt_code_block_format ___

self = <test_base_reviewer.TestFormatInputsForPrompt object at 0x1078cacd0>

    def test_format_inputs_for_prompt_code_block_format(self):
        """Test that format_inputs_for_prompt uses proper markdown code block formatting."""
>       agent = MockReviewerAgent()
                ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/base/test_base_reviewer.py:276: TypeError
_ TestFormatInputsForPrompt.test_format_inputs_for_prompt_leading_trailing_whitespace _

self = <test_base_reviewer.TestFormatInputsForPrompt object at 0x1078f8c50>

    def test_format_inputs_for_prompt_leading_trailing_whitespace(self):
        """Test that format_inputs_for_prompt doesn't have excessive whitespace."""
>       agent = MockReviewerAgent()
                ^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/base/test_base_reviewer.py:305: TypeError
_________ TestBaseReviewerAgent.test_concrete_subclass_implementation __________

self = <review.test_base.TestBaseReviewerAgent object at 0x10790e810>

    def test_concrete_subclass_implementation(self):
        """Test a concrete subclass can be created and instantiated."""
    
        class ConcreteReviewer(BaseReviewerAgent):
            """Concrete implementation for testing."""
    
            def get_system_prompt(self) -> str:
                return "You are a code reviewer."
    
            def get_relevant_file_patterns(self) -> List[str]:
                return ["*.py"]
    
            async def review(self, context: ReviewContext) -> ReviewOutput:
                return ReviewOutput(
                    agent="concrete-reviewer",
                    summary="No issues found",
                    severity="merge",
                    scope=Scope(
                        relevant_files=context.changed_files,
                        ignored_files=[],
                        reasoning="Testing concrete implementation"
                    ),
                    checks=[],
                    skips=[],
                    findings=[],
                    merge_gate=MergeGate(
                        decision="approve",
                        must_fix=[],
                        should_fix=[],
                        notes_for_coding_agent=["LGTM"]
                    )
                )
    
        # Can instantiate
>       reviewer = ConcreteReviewer()
                   ^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class ConcreteReviewer with abstract methods get_agent_name, get_allowed_tools

tests/review/test_base.py:99: TypeError
_________ TestBaseReviewerAgent.test_is_relevant_to_changes_with_match _________

self = <review.test_base.TestBaseReviewerAgent object at 0x10790ee90>

    def test_is_relevant_to_changes_with_match(self):
        """Test is_relevant_to_changes returns True when files match patterns."""
    
        class TestReviewer(BaseReviewerAgent):
            def get_system_prompt(self) -> str:
                return "Test"
    
            def get_relevant_file_patterns(self) -> List[str]:
                return ["src/**/*.py", "tests/**/*.py"]
    
            async def review(self, context: ReviewContext) -> ReviewOutput:
                return ReviewOutput(
                    agent="test",
                    summary="test",
                    severity="merge",
                    scope=Scope(relevant_files=[], reasoning="test"),
                    checks=[], skips=[], findings=[],
                    merge_gate=MergeGate(decision="approve", must_fix=[], should_fix=[], notes_for_coding_agent=[])
                )
    
>       reviewer = TestReviewer()
                   ^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class TestReviewer with abstract methods get_agent_name, get_allowed_tools

tests/review/test_base.py:134: TypeError
__________ TestBaseReviewerAgent.test_is_relevant_to_changes_no_match __________

self = <review.test_base.TestBaseReviewerAgent object at 0x10790f510>

    def test_is_relevant_to_changes_no_match(self):
        """Test is_relevant_to_changes returns False when no files match patterns."""
    
        class TestReviewer(BaseReviewerAgent):
            def get_system_prompt(self) -> str:
                return "Test"
    
            def get_relevant_file_patterns(self) -> List[str]:
                return ["src/**/*.py"]
    
            async def review(self, context: ReviewContext) -> ReviewOutput:
                return ReviewOutput(
                    agent="test",
                    summary="test",
                    severity="merge",
                    scope=Scope(relevant_files=[], reasoning="test"),
                    checks=[], skips=[], findings=[],
                    merge_gate=MergeGate(decision="approve", must_fix=[], should_fix=[], notes_for_coding_agent=[])
                )
    
>       reviewer = TestReviewer()
                   ^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class TestReviewer with abstract methods get_agent_name, get_allowed_tools

tests/review/test_base.py:158: TypeError
_______ TestBaseReviewerAgent.test_is_relevant_to_changes_empty_patterns _______

self = <review.test_base.TestBaseReviewerAgent object at 0x1078e8f50>

    def test_is_relevant_to_changes_empty_patterns(self):
        """Test is_relevant_to_changes returns False when no patterns defined."""
    
        class TestReviewer(BaseReviewerAgent):
            def get_system_prompt(self) -> str:
                return "Test"
    
            def get_relevant_file_patterns(self) -> List[str]:
                return []
    
            async def review(self, context: ReviewContext) -> ReviewOutput:
                return ReviewOutput(
                    agent="test",
                    summary="test",
                    severity="merge",
                    scope=Scope(relevant_files=[], reasoning="test"),
                    checks=[], skips=[], findings=[],
                    merge_gate=MergeGate(decision="approve", must_fix=[], should_fix=[], notes_for_coding_agent=[])
                )
    
>       reviewer = TestReviewer()
                   ^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class TestReviewer with abstract methods get_agent_name, get_allowed_tools

tests/review/test_base.py:182: TypeError
_____________ TestBaseReviewerAgent.test_format_inputs_for_prompt ______________

self = <review.test_base.TestBaseReviewerAgent object at 0x10790e590>

    def test_format_inputs_for_prompt(self):
        """Test format_inputs_for_prompt formats context for prompt."""
    
        class TestReviewer(BaseReviewerAgent):
            def get_system_prompt(self) -> str:
                return "Test"
    
            def get_relevant_file_patterns(self) -> List[str]:
                return ["*.py"]
    
            async def review(self, context: ReviewContext) -> ReviewOutput:
                return ReviewOutput(
                    agent="test",
                    summary="test",
                    severity="merge",
                    scope=Scope(relevant_files=[], reasoning="test"),
                    checks=[], skips=[], findings=[],
                    merge_gate=MergeGate(decision="approve", must_fix=[], should_fix=[], notes_for_coding_agent=[])
                )
    
>       reviewer = TestReviewer()
                   ^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class TestReviewer with abstract methods get_agent_name, get_allowed_tools

tests/review/test_base.py:206: TypeError
_____ TestBaseReviewerAgent.test_format_inputs_for_prompt_minimal_context ______

self = <review.test_base.TestBaseReviewerAgent object at 0x10790f7d0>

    def test_format_inputs_for_prompt_minimal_context(self):
        """Test format_inputs_for_prompt with minimal context."""
    
        class TestReviewer(BaseReviewerAgent):
            def get_system_prompt(self) -> str:
                return "Test"
    
            def get_relevant_file_patterns(self) -> List[str]:
                return ["*.py"]
    
            async def review(self, context: ReviewContext) -> ReviewOutput:
                return ReviewOutput(
                    agent="test",
                    summary="test",
                    severity="merge",
                    scope=Scope(relevant_files=[], reasoning="test"),
                    checks=[], skips=[], findings=[],
                    merge_gate=MergeGate(decision="approve", must_fix=[], should_fix=[], notes_for_coding_agent=[])
                )
    
>       reviewer = TestReviewer()
                   ^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class TestReviewer with abstract methods get_agent_name, get_allowed_tools

tests/review/test_base.py:242: TypeError
___________ test_security_reviewer_skips_llm_for_non_relevant_files ____________

    @pytest.mark.asyncio
    async def test_security_reviewer_skips_llm_for_non_relevant_files() -> None:
        """Lock no-relevant-files behavior for SecurityReviewer."""
        reviewer = SecurityReviewer()
        context = ReviewContext(
            changed_files=["README.md"],
            diff="+ docs only",
            repo_root="/tmp/repo",
        )
    
        with patch(
            "dawn_kestrel.agents.review.agents.security.SimpleReviewAgentRunner"
        ) as mock_runner_cls:
            result = await reviewer.review(context)
    
        assert result.agent == "security"
        assert result.summary == "No security-relevant files changed. Security review not applicable."
        assert result.severity == "merge"
        assert result.scope.relevant_files == []
>       assert result.scope.reasoning == "No files matched security review patterns"
E       AssertionError: assert 'No files mat...ance patterns' == 'No files mat...view patterns'
E         
E         - No files matched security review patterns
E         ?                  ---------   ^ -
E         + No files matched relevance patterns
E         ?                    ++ ^^^

tests/review/test_characterization_refactor_safety.py:259: AssertionError
_________________________ test_cli_review_json_output __________________________

monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x111759750>
tmp_path = PosixPath('/private/var/folders/7q/3wffhx8n6j927vjvnwqb7fxm0000gp/T/pytest-of-parkersligting/pytest-91/test_cli_review_json_output0')

    def test_cli_review_json_output(monkeypatch, tmp_path: Path):
        output = _make_output("approve")
        async_mock = AsyncMock(return_value=output)
        def fake_orchestrator(*args, **kwargs):
            return type("O", (), {"run_review": async_mock})()
    
>       monkeypatch.setattr(review_cli, "PRReviewOrchestrator", fake_orchestrator)
E       AttributeError: <module 'dawn_kestrel.agents.review.cli' from '/Users/parkersligting/develop/pt/worktrees/harness-agent-rework/dawn_kestrel/agents/review/cli.py'> has no attribute 'PRReviewOrchestrator'

tests/review/test_cli.py:135: AttributeError
_______________________ test_cli_review_markdown_output ________________________

monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x111759c50>
tmp_path = PosixPath('/private/var/folders/7q/3wffhx8n6j927vjvnwqb7fxm0000gp/T/pytest-of-parkersligting/pytest-91/test_cli_review_markdown_outpu0')

    def test_cli_review_markdown_output(monkeypatch, tmp_path: Path):
        output = _make_output("approve")
        async_mock = AsyncMock(return_value=output)
    
        def fake_orchestrator(*args, **kwargs):
            return type("O", (), {"run_review": async_mock})()
    
>       monkeypatch.setattr(review_cli, "PRReviewOrchestrator", fake_orchestrator)
E       AttributeError: <module 'dawn_kestrel.agents.review.cli' from '/Users/parkersligting/develop/pt/worktrees/harness-agent-rework/dawn_kestrel/agents/review/cli.py'> has no attribute 'PRReviewOrchestrator'

tests/review/test_cli.py:155: AttributeError
____________ test_cli_review_markdown_output_approve_with_warnings _____________

monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x1114eed50>
tmp_path = PosixPath('/private/var/folders/7q/3wffhx8n6j927vjvnwqb7fxm0000gp/T/pytest-of-parkersligting/pytest-91/test_cli_review_markdown_outpu1')

    def test_cli_review_markdown_output_approve_with_warnings(monkeypatch, tmp_path: Path):
        output = _make_output("approve_with_warnings")
        async_mock = AsyncMock(return_value=output)
    
        def fake_orchestrator(*args, **kwargs):
            return type("O", (), {"run_review": async_mock})()
    
>       monkeypatch.setattr(review_cli, "PRReviewOrchestrator", fake_orchestrator)
E       AttributeError: <module 'dawn_kestrel.agents.review.cli' from '/Users/parkersligting/develop/pt/worktrees/harness-agent-rework/dawn_kestrel/agents/review/cli.py'> has no attribute 'PRReviewOrchestrator'

tests/review/test_cli.py:177: AttributeError
_______________ test_cli_review_terminal_output_streams_progress _______________

monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x1114ceb90>
tmp_path = PosixPath('/private/var/folders/7q/3wffhx8n6j927vjvnwqb7fxm0000gp/T/pytest-of-parkersligting/pytest-91/test_cli_review_terminal_outpu0')

    def test_cli_review_terminal_output_streams_progress(monkeypatch, tmp_path: Path):
        output = _make_output("approve")
    
        class DummyResult:
            def __init__(self, severity: str, findings: list) -> None:
                self.severity = severity
                self.findings = findings
    
        class FakeOrchestrator:
            async def run_review(self, inputs, stream_callback=None):
                if stream_callback:
                    await stream_callback("agent", "started", {})
                    await stream_callback("agent", "completed", {}, result=DummyResult("warning", [1]))
                    await stream_callback("agent", "error", {}, error_msg="boom")
                return output
    
>       monkeypatch.setattr(review_cli, "PRReviewOrchestrator", lambda *args, **kwargs: FakeOrchestrator())
E       AttributeError: <module 'dawn_kestrel.agents.review.cli' from '/Users/parkersligting/develop/pt/worktrees/harness-agent-rework/dawn_kestrel/agents/review/cli.py'> has no attribute 'PRReviewOrchestrator'

tests/review/test_cli.py:209: AttributeError
_________________ TestScope.test_scope_extra_fields_forbidden __________________

self = <review.test_contracts.TestScope object at 0x1079606d0>

    def test_scope_extra_fields_forbidden(self):
        """Test Scope rejects extra fields."""
>       with pytest.raises(ValidationError, match="extra"):
E       Failed: DID NOT RAISE <class 'pydantic_core._pydantic_core.ValidationError'>

tests/review/test_contracts.py:39: Failed
__________________ TestSkip.test_skip_extra_fields_forbidden ___________________

self = <review.test_contracts.TestSkip object at 0x107962510>

    def test_skip_extra_fields_forbidden(self):
        """Test Skip rejects extra fields."""
>       with pytest.raises(ValidationError, match="extra"):
E       Failed: DID NOT RAISE <class 'pydantic_core._pydantic_core.ValidationError'>

tests/review/test_contracts.py:89: Failed
_____________ TestMergeGate.test_merge_gate_extra_fields_forbidden _____________

self = <review.test_contracts.TestMergeGate object at 0x107971d90>

    def test_merge_gate_extra_fields_forbidden(self):
        """Test MergeGate rejects extra fields."""
>       with pytest.raises(ValidationError, match="extra"):
E       Failed: DID NOT RAISE <class 'pydantic_core._pydantic_core.ValidationError'>

tests/review/test_contracts.py:238: Failed
__________ TestReviewOutput.test_review_output_extra_fields_forbidden __________

self = <review.test_contracts.TestReviewOutput object at 0x107973b90>

    def test_review_output_extra_fields_forbidden(self):
        """Test ReviewOutput rejects extra fields."""
>       with pytest.raises(ValidationError, match="extra"):
E       Failed: DID NOT RAISE <class 'pydantic_core._pydantic_core.ValidationError'>

tests/review/test_contracts.py:350: Failed
_________ TestDocGenAgentGetAgentName.test_get_agent_name_with_method __________

self = <review.test_doc_gen.TestDocGenAgentGetAgentName object at 0x1079fea50>

    def test_get_agent_name_with_method(self):
        """Test extraction when get_agent_name method exists."""
    
        class MockAgent(BaseReviewerAgent):
            def get_agent_name(self) -> str:
                return "CustomAgent"
    
            def get_system_prompt(self) -> str:
                return "Test"
    
            def get_relevant_file_patterns(self):
                return []
    
            async def review(self, context):
                pass
    
        agent = DocGenAgent()
>       name = agent._get_agent_name(MockAgent())
                                     ^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockAgent with abstract method get_allowed_tools

tests/review/test_doc_gen.py:124: TypeError
______ TestDocGenAgentGetAgentName.test_get_agent_name_fallback_to_class _______

self = <review.test_doc_gen.TestDocGenAgentGetAgentName object at 0x1079fef10>

    def test_get_agent_name_fallback_to_class(self):
        """Test fallback to class name when method doesn't exist."""
    
        class MockAgent(BaseReviewerAgent):
            def get_system_prompt(self) -> str:
                return "Test"
    
            def get_relevant_file_patterns(self):
                return []
    
            async def review(self, context):
                pass
    
        agent = DocGenAgent()
>       name = agent._get_agent_name(MockAgent())
                                     ^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/test_doc_gen.py:142: TypeError
___ TestDocGenAgentGetAgentName.test_get_agent_name_removes_reviewer_suffix ____

self = <review.test_doc_gen.TestDocGenAgentGetAgentName object at 0x1079ff590>

    def test_get_agent_name_removes_reviewer_suffix(self):
        """Test that 'reviewer' suffix is removed from class name."""
    
        class MockReviewer(BaseReviewerAgent):
            def get_system_prompt(self) -> str:
                return "Test"
    
            def get_relevant_file_patterns(self):
                return []
    
            async def review(self, context):
                pass
    
        agent = DocGenAgent()
>       name = agent._get_agent_name(MockReviewer())
                                     ^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewer with abstract methods get_agent_name, get_allowed_tools

tests/review/test_doc_gen.py:160: TypeError
______ TestDocGenAgentGetAgentName.test_get_agent_name_with_complex_name _______

self = <review.test_doc_gen.TestDocGenAgentGetAgentName object at 0x1079ffc50>

    def test_get_agent_name_with_complex_name(self):
        """Test extraction with complex class names."""
    
        class MockReviewer123(BaseReviewerAgent):
            def get_system_prompt(self) -> str:
                return "Test"
    
            def get_relevant_file_patterns(self):
                return []
    
            async def review(self, context):
                pass
    
        agent = DocGenAgent()
>       name = agent._get_agent_name(MockReviewer123())
                                     ^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewer123 with abstract methods get_agent_name, get_allowed_tools

tests/review/test_doc_gen.py:178: TypeError
_ TestDocGenAgentExtractPatternsFromPrompt.test_extract_patterns_with_all_types _

self = <review.test_doc_gen.TestDocGenAgentExtractPatternsFromPrompt object at 0x107a03bd0>

        def test_extract_patterns_with_all_types(self):
            """Test extracting AST, file_path, and content patterns."""
            agent = DocGenAgent()
    
            # Create mock agent with system prompt containing patterns
            class MockAgent(BaseReviewerAgent):
                def get_system_prompt(self) -> str:
                    return """You specialize in security review.
    
    Look for:
    - @login_required decorator
    - FunctionDef with many parameters
    
    File patterns:
    - "auth/**.py"
    - "server/**/*.py"
    
    Content patterns:
    - password = xxx
    - eval( something)"""
    
                def get_relevant_file_patterns(self):
                    return ["tests/**", "README*"]
    
                async def review(self, context):
                    pass
    
>           system_prompt = agent._get_agent_name(MockAgent())  # Temporary
                                                  ^^^^^^^^^^^
E           TypeError: Can't instantiate abstract class MockAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/test_doc_gen.py:320: TypeError
__ TestDocGenAgentExtractPatternsFromPrompt.test_extract_patterns_minimum_ast __

self = <review.test_doc_gen.TestDocGenAgentExtractPatternsFromPrompt object at 0x107a0c310>

    def test_extract_patterns_minimum_ast(self):
        """Test AST patterns added when below minimum count."""
        agent = DocGenAgent()
    
        class MockAgent(BaseReviewerAgent):
            def get_system_prompt(self) -> str:
                return "Minimal prompt"
    
            def get_relevant_file_patterns(self):
                return []
    
            async def review(self, context):
                pass
    
>       patterns = agent._extract_patterns_from_prompt("Minimal prompt", MockAgent())
                                                                         ^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/test_doc_gen.py:344: TypeError
_ TestDocGenAgentExtractPatternsFromPrompt.test_extract_patterns_minimum_file_path _

self = <review.test_doc_gen.TestDocGenAgentExtractPatternsFromPrompt object at 0x107a03610>

    def test_extract_patterns_minimum_file_path(self):
        """Test file_path patterns added when below minimum count."""
        agent = DocGenAgent()
    
        class MockAgent(BaseReviewerAgent):
            def get_system_prompt(self) -> str:
                return "Minimal prompt"
    
            def get_relevant_file_patterns(self):
                return ["test/**"]
    
            async def review(self, context):
                pass
    
>       patterns = agent._extract_patterns_from_prompt("Minimal prompt", MockAgent())
                                                                         ^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/test_doc_gen.py:365: TypeError
_ TestDocGenAgentExtractPatternsFromPrompt.test_extract_patterns_minimum_content _

self = <review.test_doc_gen.TestDocGenAgentExtractPatternsFromPrompt object at 0x107a00390>

    def test_extract_patterns_minimum_content(self):
        """Test content patterns added when below minimum count."""
        agent = DocGenAgent()
    
        class MockAgent(BaseReviewerAgent):
            def get_system_prompt(self) -> str:
                return "Minimal prompt"
    
            def get_relevant_file_patterns(self):
                return []
    
            async def review(self, context):
                pass
    
>       patterns = agent._extract_patterns_from_prompt("Minimal prompt", MockAgent())
                                                                         ^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/test_doc_gen.py:386: TypeError
_ TestDocGenAgentExtractPatternsFromPrompt.test_extract_patterns_sort_by_weight _

self = <review.test_doc_gen.TestDocGenAgentExtractPatternsFromPrompt object at 0x107a0c0d0>

        def test_extract_patterns_sort_by_weight(self):
            """Test patterns are sorted by weight descending."""
            agent = DocGenAgent()
    
            class MockAgent(BaseReviewerAgent):
                def get_system_prompt(self) -> str:
                    return """High weight pattern
    Low weight pattern
    Medium weight pattern"""
    
                def get_relevant_file_patterns(self):
                    return []
    
                async def review(self, context):
                    pass
    
>           patterns = agent._extract_patterns_from_prompt("Test", MockAgent())
                                                                   ^^^^^^^^^^^
E           TypeError: Can't instantiate abstract class MockAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/test_doc_gen.py:409: TypeError
_ TestDocGenAgentExtractPatternsFromPrompt.test_extract_patterns_no_duplicates _

self = <review.test_doc_gen.TestDocGenAgentExtractPatternsFromPrompt object at 0x107a0c990>

        def test_extract_patterns_no_duplicates(self):
            """Test patterns don't have duplicates."""
            agent = DocGenAgent()
    
            class MockAgent(BaseReviewerAgent):
                def get_system_prompt(self) -> str:
                    return """You specialize in testing.
    
    Look for:
    - @test decorator
    - @test decorator"""
    
                def get_relevant_file_patterns(self):
                    return []
    
                async def review(self, context):
                    pass
    
>           patterns = agent._extract_patterns_from_prompt("Test", MockAgent())
                                                                   ^^^^^^^^^^^
E           TypeError: Can't instantiate abstract class MockAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/test_doc_gen.py:433: TypeError
_______ TestDocGenAgentDetermineAgentType.test_determine_required_agent ________

self = <review.test_doc_gen.TestDocGenAgentDetermineAgentType object at 0x107a17890>

    def test_determine_required_agent(self):
        """Test identifying required agents."""
        agent = DocGenAgent()
    
        class SecurityReviewer(BaseReviewerAgent):
            def get_system_prompt(self) -> str:
                return "Test"
    
            def get_relevant_file_patterns(self):
                return []
    
            async def review(self, context):
                pass
    
>       agent_type = agent._determine_agent_type(SecurityReviewer())
                                                 ^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class SecurityReviewer with abstract methods get_agent_name, get_allowed_tools

tests/review/test_doc_gen.py:707: TypeError
_______ TestDocGenAgentDetermineAgentType.test_determine_optional_agent ________

self = <review.test_doc_gen.TestDocGenAgentDetermineAgentType object at 0x107a17f10>

    def test_determine_optional_agent(self):
        """Test identifying optional agents."""
        agent = DocGenAgent()
    
        class CustomAgent(BaseReviewerAgent):
            def get_system_prompt(self) -> str:
                return "Test"
    
            def get_relevant_file_patterns(self):
                return []
    
            async def review(self, context):
                pass
    
>       agent_type = agent._determine_agent_type(CustomAgent())
                                                 ^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class CustomAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/test_doc_gen.py:725: TypeError
_________ TestDocGenAgentDetermineAgentType.test_required_agents_list __________

self = <review.test_doc_gen.TestDocGenAgentDetermineAgentType object at 0x107a1c5d0>

    def test_required_agents_list(self):
        """Test that required agents match expected list."""
        agent = DocGenAgent()
        required = ["architecture", "security", "linting", "diff_scoper", "requirements"]
    
        for agent_name in required:
            # Create test class with the exact name
            class TestAgent(BaseReviewerAgent):
                def get_system_prompt(self) -> str:
                    return "Test"
    
                def get_relevant_file_patterns(self):
                    return []
    
                async def review(self, context):
                    pass
    
            TestAgent.__name__ = f"{agent_name.capitalize()}Reviewer"
    
>           agent_type = agent._determine_agent_type(TestAgent())
                                                     ^^^^^^^^^^^
E           TypeError: Can't instantiate abstract class ArchitectureReviewer with abstract methods get_agent_name, get_allowed_tools

tests/review/test_doc_gen.py:748: TypeError
_______ TestDocGenAgentDetermineAgentType.test_non_required_agent_names ________

self = <review.test_doc_gen.TestDocGenAgentDetermineAgentType object at 0x107a1cc90>

    def test_non_required_agent_names(self):
        """Test non-required agents."""
        agent = DocGenAgent()
        non_required = ["documentation", "performance", "telemetry", "dependencies"]
    
        for agent_name in non_required:
    
            class MockAgent(BaseReviewerAgent):
                def get_system_prompt(self) -> str:
                    return "Test"
    
                def get_relevant_file_patterns(self):
                    return []
    
                async def review(self, context):
                    pass
    
            # Monkey-patch class name
            MockAgent.__name__ = f"{agent_name.capitalize()}Reviewer"
    
>           agent_type = agent._determine_agent_type(MockAgent())
                                                     ^^^^^^^^^^^
E           TypeError: Can't instantiate abstract class DocumentationReviewer with abstract methods get_agent_name, get_allowed_tools

tests/review/test_doc_gen.py:771: TypeError
_ TestDocGenAgentGenerateForAgent.test_generate_for_agent_with_agent_name_extraction _

self = <review.test_doc_gen.TestDocGenAgentGenerateForAgent object at 0x107a26010>
tmp_path = PosixPath('/private/var/folders/7q/3wffhx8n6j927vjvnwqb7fxm0000gp/T/pytest-of-parkersligting/pytest-91/test_generate_for_agent_with_a0')

    def test_generate_for_agent_with_agent_name_extraction(self, tmp_path: Path):
        """Test agent name is extracted from agent instance."""
    
        class TestAgent(BaseReviewerAgent):
            def get_system_prompt(self) -> str:
                return "Test"
    
            def get_relevant_file_patterns(self):
                return []
    
            async def review(self, context):
                pass
    
>       agent = TestAgent()
                ^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class TestAgent with abstract methods get_agent_name, get_allowed_tools

tests/review/test_doc_gen.py:1240: TypeError
______________________ test_generate_docs_with_agent_flag ______________________

tmp_path = PosixPath('/private/var/folders/7q/3wffhx8n6j927vjvnwqb7fxm0000gp/T/pytest-of-parkersligting/pytest-91/test_generate_docs_with_agent_0')

    def test_generate_docs_with_agent_flag(tmp_path: Path):
        """Test generate-docs with --agent flag."""
        runner = CliRunner()
    
        mock_doc_gen = MagicMock()
        mock_doc_gen.generate_for_agent.return_value = (True, "Generated documentation for security")
    
        with patch('dawn_kestrel.agents.review.doc_gen.DocGenAgent') as MockDocGenAgent:
            MockDocGenAgent.return_value = mock_doc_gen
    
            result = runner.invoke(
>               review_cli.generate_docs,
                ^^^^^^^^^^^^^^^^^^^^^^^^
                ["--agent", "security", "--verbose"],
            )
E           AttributeError: module 'dawn_kestrel.agents.review.cli' has no attribute 'generate_docs'

tests/review/test_generate_docs.py:23: AttributeError
______________________ test_generate_docs_with_force_flag ______________________

tmp_path = PosixPath('/private/var/folders/7q/3wffhx8n6j927vjvnwqb7fxm0000gp/T/pytest-of-parkersligting/pytest-91/test_generate_docs_with_force_0')

    def test_generate_docs_with_force_flag(tmp_path: Path):
        """Test generate-docs with --force flag."""
        runner = CliRunner()
    
        mock_agent = MagicMock()
        mock_agent.get_agent_name.return_value = "security"
    
        with patch.dict('dawn_kestrel.agents.review.cli.__dict__', {'all_agents': {'security': mock_agent}}):
            mock_doc_gen = MagicMock()
            mock_doc_gen.generate_for_agent.return_value = (True, "Generated documentation")
    
            with patch('dawn_kestrel.agents.review.doc_gen.DocGenAgent') as MockDocGenAgent:
                MockDocGenAgent.return_value = mock_doc_gen
    
                result = runner.invoke(
>                   review_cli.generate_docs,
                    ^^^^^^^^^^^^^^^^^^^^^^^^
                    ["--agent", "security", "--force"],
                )
E               AttributeError: module 'dawn_kestrel.agents.review.cli' has no attribute 'generate_docs'

tests/review/test_generate_docs.py:53: AttributeError
_____________________ test_generate_docs_with_output_flag ______________________

tmp_path = PosixPath('/private/var/folders/7q/3wffhx8n6j927vjvnwqb7fxm0000gp/T/pytest-of-parkersligting/pytest-91/test_generate_docs_with_output0')

    def test_generate_docs_with_output_flag(tmp_path: Path):
        """Test generate-docs with custom --output directory."""
        runner = CliRunner()
        custom_output = tmp_path / "custom_docs"
    
        mock_agent = MagicMock()
        mock_agent.get_agent_name.return_value = "security"
    
        with patch.dict('dawn_kestrel.agents.review.cli.__dict__', {'all_agents': {'security': mock_agent}}):
            with patch('dawn_kestrel.agents.review.cli.get_subagents') as mock_get_subagents:
                mock_get_subagents.return_value = [mock_agent]
    
                mock_doc_gen = MagicMock()
                mock_doc_gen.generate_for_agent.return_value = (True, "Generated documentation")
    
                with patch('dawn_kestrel.agents.review.doc_gen.DocGenAgent') as MockDocGenAgent:
                    MockDocGenAgent.return_value = mock_doc_gen
    
                    result = runner.invoke(
>                       review_cli.generate_docs,
                        ^^^^^^^^^^^^^^^^^^^^^^^^
                        ["--agent", "security", "--output", str(custom_output)],
                    )
E                   AttributeError: module 'dawn_kestrel.agents.review.cli' has no attribute 'generate_docs'

tests/review/test_generate_docs.py:80: AttributeError
_____________________ test_generate_docs_with_verbose_flag _____________________

tmp_path = PosixPath('/private/var/folders/7q/3wffhx8n6j927vjvnwqb7fxm0000gp/T/pytest-of-parkersligting/pytest-91/test_generate_docs_with_verbos0')

    def test_generate_docs_with_verbose_flag(tmp_path: Path):
        """Test generate-docs with --verbose flag."""
        runner = CliRunner()
    
        mock_agent = MagicMock()
        mock_agent.get_agent_name.return_value = "security"
    
        with patch.dict('dawn_kestrel.agents.review.cli.__dict__', {'all_agents': {'security': mock_agent}}):
            mock_doc_gen = MagicMock()
            mock_doc_gen.generate_for_agent.return_value = (True, "Generated documentation")
    
            with patch('dawn_kestrel.agents.review.doc_gen.DocGenAgent') as MockDocGenAgent:
                MockDocGenAgent.return_value = mock_doc_gen
    
                result = runner.invoke(
>                   review_cli.generate_docs,
                    ^^^^^^^^^^^^^^^^^^^^^^^^
                    ["--agent", "security", "--verbose"],
                )
E               AttributeError: module 'dawn_kestrel.agents.review.cli' has no attribute 'generate_docs'

tests/review/test_generate_docs.py:104: AttributeError
____________________ test_generate_docs_with_invalid_agent _____________________

tmp_path = PosixPath('/private/var/folders/7q/3wffhx8n6j927vjvnwqb7fxm0000gp/T/pytest-of-parkersligting/pytest-91/test_generate_docs_with_invali0')

    def test_generate_docs_with_invalid_agent(tmp_path: Path):
        """Test generate-docs raises error for invalid agent name."""
        runner = CliRunner()
    
        all_agents = {
            'security': MagicMock(),
            'architecture': MagicMock(),
        }
    
        with patch.dict('dawn_kestrel.agents.review.cli.__dict__', {'all_agents': all_agents}):
            mock_doc_gen = MagicMock()
            mock_doc_gen.generate_for_agent.return_value = (True, "")
    
            with patch('dawn_kestrel.agents.review.doc_gen.DocGenAgent') as MockDocGenAgent:
                MockDocGenAgent.return_value = mock_doc_gen
    
                result = runner.invoke(
>                   review_cli.generate_docs,
                    ^^^^^^^^^^^^^^^^^^^^^^^^
                    ["--agent", "invalid_agent"],
                )
E               AttributeError: module 'dawn_kestrel.agents.review.cli' has no attribute 'generate_docs'

tests/review/test_generate_docs.py:130: AttributeError
___________________ test_generate_docs_requires_agent_or_all ___________________

tmp_path = PosixPath('/private/var/folders/7q/3wffhx8n6j927vjvnwqb7fxm0000gp/T/pytest-of-parkersligting/pytest-91/test_generate_docs_requires_ag0')

    def test_generate_docs_requires_agent_or_all(tmp_path: Path):
        """Test generate-docs requires --agent or --all flag."""
        runner = CliRunner()
    
        mock_doc_gen = MagicMock()
        mock_doc_gen.generate_for_agent.return_value = (True, "")
    
        with patch('dawn_kestrel.agents.review.doc_gen.DocGenAgent') as MockDocGenAgent:
            MockDocGenAgent.return_value = mock_doc_gen
    
            result = runner.invoke(
>               review_cli.generate_docs,
                ^^^^^^^^^^^^^^^^^^^^^^^^
                [],
            )
E           AttributeError: module 'dawn_kestrel.agents.review.cli' has no attribute 'generate_docs'

tests/review/test_generate_docs.py:150: AttributeError
____________________ test_generate_docs_default_output_path ____________________

tmp_path = PosixPath('/private/var/folders/7q/3wffhx8n6j927vjvnwqb7fxm0000gp/T/pytest-of-parkersligting/pytest-91/test_generate_docs_default_out0')

    def test_generate_docs_default_output_path(tmp_path: Path):
        """Test generate-docs uses default output path."""
        runner = CliRunner()
    
        mock_agent = MagicMock()
        mock_agent.get_agent_name.return_value = "security"
    
        with patch.dict('dawn_kestrel.agents.review.cli.__dict__', {'all_agents': {'security': mock_agent}}):
            mock_doc_gen = MagicMock()
            mock_doc_gen.generate_for_agent.return_value = (True, "Generated documentation")
    
            with patch('dawn_kestrel.agents.review.doc_gen.DocGenAgent') as MockDocGenAgent:
                MockDocGenAgent.return_value = mock_doc_gen
    
                result = runner.invoke(
>                   review_cli.generate_docs,
                    ^^^^^^^^^^^^^^^^^^^^^^^^
                    ["--agent", "security"],
                )
E               AttributeError: module 'dawn_kestrel.agents.review.cli' has no attribute 'generate_docs'

tests/review/test_generate_docs.py:173: AttributeError
_________ TestBaselineComparison.test_baseline_vs_enhanced_performance _________

self = <review.test_integration_entry_points.TestBaselineComparison object at 0x107a43050>
mock_repo = PosixPath('/private/var/folders/7q/3wffhx8n6j927vjvnwqb7fxm0000gp/T/pytest-of-parkersligting/pytest-91/test_baseline_vs_enhanced_perf0/repo')
mock_pr_diff = 'diff --git a/src/auth/login.py b/src/auth/login.py\n+++ b/src/auth/login.py\n@@ -1,1 +1,1 @@\n-def authenticate(usern...+    for i in range(100):\n+        for j in range(100):\n+            db.query(f"SELECT * FROM users WHERE id={i}")\n'

    @pytest.mark.asyncio
    async def test_baseline_vs_enhanced_performance(self, mock_repo: Path, mock_pr_diff: str):
        """Test that enhanced review is within 20% of baseline performance."""
        # Setup mock agent with predictable review time
        class MockReviewer(BaseReviewerAgent):
            async def review(self, context: ReviewContext) -> ReviewOutput:
                # Simulate review work (0.1s)
                await asyncio.sleep(0.1)
                return ReviewOutput(
                    agent="mock_reviewer",
                    severity="merge",
                    scope=Scope(relevant_files=[], reasoning="Mock review"),
                    findings=[],
                    merge_gate=MergeGate(decision="approve", must_fix=[]),
                    summary="Mock review"
                )
    
            def get_system_prompt(self) -> str:
                return "Mock system prompt"
    
            def get_relevant_file_patterns(self) -> List[str]:
                return ["*.py"]
    
            def get_agent_name(self) -> str:
                return "MockReviewer"
    
        changed_files = ["src/auth/login.py", "src/api/user.py"]
        diff = mock_pr_diff
    
        # Baseline: Review WITHOUT entry points (bypass discovery)
>       agents_baseline = [MockReviewer() for _ in range(3)]
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/review/test_integration_entry_points.py:354: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

.0 = <range_iterator object at 0x1121d36c0>

>   agents_baseline = [MockReviewer() for _ in range(3)]
                       ^^^^^^^^^^^^^^
E   TypeError: Can't instantiate abstract class MockReviewer with abstract method get_allowed_tools

tests/review/test_integration_entry_points.py:354: TypeError
______ TestFallbackBehavior.test_discovery_returns_none_triggers_fallback ______

self = <review.test_integration_entry_points.TestFallbackBehavior object at 0x107a48610>
mock_repo = PosixPath('/private/var/folders/7q/3wffhx8n6j927vjvnwqb7fxm0000gp/T/pytest-of-parkersligting/pytest-91/test_discovery_returns_none_tr0/repo')
mock_pr_diff = 'diff --git a/src/auth/login.py b/src/auth/login.py\n+++ b/src/auth/login.py\n@@ -1,1 +1,1 @@\n-def authenticate(usern...+    for i in range(100):\n+        for j in range(100):\n+            db.query(f"SELECT * FROM users WHERE id={i}")\n'

    @pytest.mark.asyncio
    async def test_discovery_returns_none_triggers_fallback(self, mock_repo: Path, mock_pr_diff: str):
        """Test that None from discovery triggers fallback to is_relevant_to_changes()."""
        class MockReviewer(BaseReviewerAgent):
            async def review(self, context: ReviewContext) -> ReviewOutput:
                return ReviewOutput(
                    agent="mock_reviewer",
                    severity="merge",
                    scope=Scope(relevant_files=[], reasoning="Mock review"),
                    findings=[],
                    merge_gate=MergeGate(decision="approve", must_fix=[]),
                    summary=f"Reviewed {len(context.changed_files)} files"
                )
    
            def get_system_prompt(self) -> str:
                return "Mock reviewer"
    
            def get_relevant_file_patterns(self) -> List[str]:
                return ["*.py"]
    
            def get_agent_name(self) -> str:
                return "MockReviewer"
    
        discovery = EntryPointDiscovery()
    
        # Mock discovery to return None (simulating failure)
        with patch.object(
            discovery,
            "discover_entry_points",
            new_callable=AsyncMock,
            return_value=None
        ):
>           agent = MockReviewer()
                    ^^^^^^^^^^^^^^
E           TypeError: Can't instantiate abstract class MockReviewer with abstract method get_allowed_tools

tests/review/test_integration_entry_points.py:560: TypeError
________ TestFallbackBehavior.test_discovery_timeout_triggers_fallback _________

self = <review.test_integration_entry_points.TestFallbackBehavior object at 0x107a48e90>
mock_repo = PosixPath('/private/var/folders/7q/3wffhx8n6j927vjvnwqb7fxm0000gp/T/pytest-of-parkersligting/pytest-91/test_discovery_timeout_trigger0/repo')
mock_pr_diff = 'diff --git a/src/auth/login.py b/src/auth/login.py\n+++ b/src/auth/login.py\n@@ -1,1 +1,1 @@\n-def authenticate(usern...+    for i in range(100):\n+        for j in range(100):\n+            db.query(f"SELECT * FROM users WHERE id={i}")\n'

    @pytest.mark.asyncio
    async def test_discovery_timeout_triggers_fallback(self, mock_repo: Path, mock_pr_diff: str):
        """Test that discovery timeout triggers fallback."""
        class MockReviewer(BaseReviewerAgent):
            async def review(self, context: ReviewContext) -> ReviewOutput:
                return ReviewOutput(
                    agent="mock_reviewer",
                    severity="merge",
                    scope=Scope(relevant_files=[], reasoning="Mock review"),
                    findings=[],
                    merge_gate=MergeGate(decision="approve", must_fix=[]),
                    summary="Review completed"
                )
    
            def get_system_prompt(self) -> str:
                return "Mock reviewer"
    
            def get_relevant_file_patterns(self) -> List[str]:
                return ["*.py"]
    
            def get_agent_name(self) -> str:
                return "MockReviewer"
    
        discovery = EntryPointDiscovery(timeout_seconds=1)
    
        # Mock discovery to timeout
        async def mock_timeout(agent_name, repo_root, changed_files):
            await asyncio.sleep(2)  # Sleep longer than timeout
            return []
    
        with patch.object(
            discovery,
            "discover_entry_points",
            new_callable=AsyncMock,
            side_effect=mock_timeout
        ):
>           agent = MockReviewer()
                    ^^^^^^^^^^^^^^
E           TypeError: Can't instantiate abstract class MockReviewer with abstract method get_allowed_tools

tests/review/test_integration_entry_points.py:621: TypeError
_______________ TestErrorScenarios.test_review_timeout_handling ________________

self = <review.test_integration_entry_points.TestErrorScenarios object at 0x107a55c50>
mock_repo = PosixPath('/private/var/folders/7q/3wffhx8n6j927vjvnwqb7fxm0000gp/T/pytest-of-parkersligting/pytest-91/test_review_timeout_handling0/repo')
mock_pr_diff = 'diff --git a/src/auth/login.py b/src/auth/login.py\n+++ b/src/auth/login.py\n@@ -1,1 +1,1 @@\n-def authenticate(usern...+    for i in range(100):\n+        for j in range(100):\n+            db.query(f"SELECT * FROM users WHERE id={i}")\n'

    @pytest.mark.asyncio
    async def test_review_timeout_handling(self, mock_repo: Path, mock_pr_diff: str):
        """Test review timeout handling."""
        class SlowReviewer(BaseReviewerAgent):
            async def review(self, context: ReviewContext) -> ReviewOutput:
                await asyncio.sleep(10)  # Simulate slow review
                return ReviewOutput(
                    agent="slow_reviewer",
                    severity="merge",
                    scope=Scope(relevant_files=[], reasoning="Mock review"),
                    findings=[],
                    merge_gate=MergeGate(decision="approve", must_fix=[]),
                    summary="Review"
                )
    
            def get_system_prompt(self) -> str:
                return "Slow reviewer"
    
            def get_relevant_file_patterns(self) -> List[str]:
                return ["*.py"]
    
            def get_agent_name(self) -> str:
                return "SlowReviewer"
    
>       agent = SlowReviewer()
                ^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class SlowReviewer with abstract method get_allowed_tools

tests/review/test_integration_entry_points.py:1068: TypeError
___________________ test_review_pipeline_runs_all_subagents ____________________

tmp_path = PosixPath('/private/var/folders/7q/3wffhx8n6j927vjvnwqb7fxm0000gp/T/pytest-of-parkersligting/pytest-91/test_review_pipeline_runs_all_0')

    @pytest.mark.asyncio
    async def test_review_pipeline_runs_all_subagents(tmp_path: Path):
        module_path = tmp_path / "src" / "module.py"
        module_path.parent.mkdir(parents=True, exist_ok=True)
        module_path.write_text(
            '"""Module docs."""\n'
            "def foo() -> None:\n"
            "    \"\"\"Function docs.\"\"\"\n"
            "    return None\n\n"
            "class Bar:\n"
            "    \"\"\"Class docs.\"\"\"\n"
            "    def baz(self) -> None:\n"
            "        \"\"\"Method docs.\"\"\"\n"
            "        return None\n"
        )
    
        diff = """diff --git a/src/module.py b/src/module.py
    +++ b/src/module.py
    @@ -1,1 +1,1 @@
    -# old
    +# new
    """
    
        agents = [
            DiffScoperReviewer(),
            ArchitectureReviewer(),
            SecurityReviewer(),
            DocumentationReviewer(),
>           LintingReviewer(executor=AsyncExecutor()),
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            UnitTestsReviewer(executor=SyncExecutor(), repo_root=str(tmp_path)),
            RequirementsReviewer(),
            PerformanceReliabilityReviewer(),
            DependencyLicenseReviewer(),
            ReleaseChangelogReviewer(),
            TelemetryMetricsReviewer(),
        ]
E       TypeError: BaseReviewerAgent.__init__() got an unexpected keyword argument 'executor'

tests/review/test_integration_review_pipeline.py:80: TypeError
_______________________ test_orchestrator_initialization _______________________

    @pytest.mark.asyncio
    async def test_orchestrator_initialization():
>       agents = [MockReviewerAgent("agent1"), MockReviewerAgent("agent2")]
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract method get_allowed_tools

tests/review/test_orchestrator.py:157: TypeError
__________________ test_orchestrator_with_custom_dependencies __________________

mock_command_executor = <MagicMock spec='CommandExecutor' id='4600972048'>
mock_stream_manager = <MagicMock spec='ReviewStreamManager' id='4600986704'>

    @pytest.mark.asyncio
    async def test_orchestrator_with_custom_dependencies(mock_command_executor, mock_stream_manager):
>       agents = [MockReviewerAgent("agent1")]
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract method get_allowed_tools

tests/review/test_orchestrator.py:167: TypeError
_____________________ test_run_subagents_parallel_success ______________________

    @pytest.mark.asyncio
    async def test_run_subagents_parallel_success():
    
        agents = [
>           MockReviewerAgent("agent1"),
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
            MockReviewerAgent("agent2"),
            MockReviewerAgent("agent3"),
        ]
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract method get_allowed_tools

tests/review/test_orchestrator.py:180: TypeError
___________________ test_run_subagents_parallel_with_timeout ___________________

    @pytest.mark.asyncio
    async def test_run_subagents_parallel_with_timeout():
    
        agents = [
>           MockReviewerAgent("agent1"),
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
            MockReviewerAgent("agent2", should_timeout=True),
            MockReviewerAgent("agent3"),
        ]
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract method get_allowed_tools

tests/review/test_orchestrator.py:211: TypeError
__________________ test_run_subagents_parallel_with_exception __________________

    @pytest.mark.asyncio
    async def test_run_subagents_parallel_with_exception():
    
        agents = [
>           MockReviewerAgent("agent1"),
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
            MockReviewerAgent("agent2", should_fail=True),
            MockReviewerAgent("agent3"),
        ]
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract method get_allowed_tools

tests/review/test_orchestrator.py:244: TypeError
__________________ test_run_subagents_parallel_with_streaming __________________

mock_stream_manager = <MagicMock spec='ReviewStreamManager' id='4599166928'>

    @pytest.mark.asyncio
    async def test_run_subagents_parallel_with_streaming(mock_stream_manager):
    
>       agents = [MockReviewerAgent("agent1")]
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract method get_allowed_tools

tests/review/test_orchestrator.py:276: TypeError
________________________ test_run_review_full_workflow _________________________

sample_review_outputs = [ReviewOutput(agent='security', summary='Security review', severity='merge', scope=Scope(relevant_files=['src/file.py'...erge_gate=MergeGate(decision='needs_changes', must_fix=[], should_fix=['Fix line length'], notes_for_coding_agent=[]))]

    @pytest.mark.asyncio
    async def test_run_review_full_workflow(sample_review_outputs):
    
>       agent1 = MockReviewerAgent("agent1", output=sample_review_outputs[0])
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract method get_allowed_tools

tests/review/test_orchestrator.py:511: TypeError
________________________ test_run_review_with_streaming ________________________

mock_stream_manager = <MagicMock spec='ReviewStreamManager' id='4600219216'>

    @pytest.mark.asyncio
    async def test_run_review_with_streaming(mock_stream_manager):
    
>       agent = MockReviewerAgent("agent1")
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerAgent with abstract method get_allowed_tools

tests/review/test_orchestrator.py:541: TypeError
___________ test_build_context_with_none_discovery_irrelevant_agent ____________

mock_discovery = <MagicMock spec='EntryPointDiscovery' id='4599961744'>
sample_review_inputs = ReviewInputs(repo_root='/tmp/repo', base_ref='main', head_ref='feature', pr_title='Add authentication feature', pr_description='Implements login/logout functionality', ticket_description='', include_optional=False, timeout_seconds=60)
sample_changed_files = ['src/auth/login.py', 'src/auth/logout.py', 'src/api/routes.py', 'src/models/user.py', 'config/settings.py', 'tests/test_auth.py']

    @pytest.mark.asyncio
    async def test_build_context_with_none_discovery_irrelevant_agent(
        mock_discovery,
        sample_review_inputs,
        sample_changed_files,
    ):
        """Test _build_context when discovery returns None and agent is not relevant."""
>       agent = TestReviewerAgent(agent_name="TestReviewer", is_relevant=False)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class TestReviewerAgent with abstract method get_allowed_tools

tests/review/test_orchestrator_entry_points.py:239: TypeError
__________________ test_build_context_with_discovery_timeout ___________________

mock_discovery = <MagicMock spec='EntryPointDiscovery' id='4585237840'>
sample_review_inputs = ReviewInputs(repo_root='/tmp/repo', base_ref='main', head_ref='feature', pr_title='Add authentication feature', pr_description='Implements login/logout functionality', ticket_description='', include_optional=False, timeout_seconds=60)
sample_changed_files = ['src/auth/login.py', 'src/auth/logout.py', 'src/api/routes.py', 'src/models/user.py', 'config/settings.py', 'tests/test_auth.py']

    @pytest.mark.asyncio
    async def test_build_context_with_discovery_timeout(
        mock_discovery,
        sample_review_inputs,
        sample_changed_files,
    ):
        """Test _build_context when discovery times out (returns None)."""
>       agent = TestReviewerAgent(agent_name="TestReviewer", is_relevant=True)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class TestReviewerAgent with abstract method get_allowed_tools

tests/review/test_orchestrator_entry_points.py:264: TypeError
___________________ test_build_context_with_discovery_error ____________________

mock_discovery = <MagicMock spec='EntryPointDiscovery' id='4587850768'>
sample_review_inputs = ReviewInputs(repo_root='/tmp/repo', base_ref='main', head_ref='feature', pr_title='Add authentication feature', pr_description='Implements login/logout functionality', ticket_description='', include_optional=False, timeout_seconds=60)
sample_changed_files = ['src/auth/login.py', 'src/auth/logout.py', 'src/api/routes.py', 'src/models/user.py', 'config/settings.py', 'tests/test_auth.py']

    @pytest.mark.asyncio
    async def test_build_context_with_discovery_error(
        mock_discovery,
        sample_review_inputs,
        sample_changed_files,
    ):
        """Test _build_context when discovery returns None (simulating error)."""
>       agent = TestReviewerAgent(agent_name="TestReviewer", is_relevant=True)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class TestReviewerAgent with abstract method get_allowed_tools

tests/review/test_orchestrator_entry_points.py:288: TypeError
________________ test_build_context_empty_entry_points_vs_none _________________

mock_discovery = <MagicMock spec='EntryPointDiscovery' id='4601108368'>
sample_review_inputs = ReviewInputs(repo_root='/tmp/repo', base_ref='main', head_ref='feature', pr_title='Add authentication feature', pr_description='Implements login/logout functionality', ticket_description='', include_optional=False, timeout_seconds=60)
sample_changed_files = ['src/auth/login.py', 'src/auth/logout.py', 'src/api/routes.py', 'src/models/user.py', 'config/settings.py', 'tests/test_auth.py']

    @pytest.mark.asyncio
    async def test_build_context_empty_entry_points_vs_none(
        mock_discovery,
        sample_review_inputs,
        sample_changed_files,
    ):
        """Test that empty list returns empty changed_files (no entry points to filter)."""
>       agent = TestReviewerAgent(agent_name="TestReviewer", is_relevant=True)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class TestReviewerAgent with abstract method get_allowed_tools

tests/review/test_orchestrator_entry_points.py:342: TypeError
____________________ test_build_context_multiple_reviewers _____________________

mock_discovery = <MagicMock spec='EntryPointDiscovery' id='4603160784'>
sample_review_inputs = ReviewInputs(repo_root='/tmp/repo', base_ref='main', head_ref='feature', pr_title='Add authentication feature', pr_description='Implements login/logout functionality', ticket_description='', include_optional=False, timeout_seconds=60)
sample_changed_files = ['src/auth/login.py', 'src/auth/logout.py', 'src/api/routes.py', 'src/models/user.py', 'config/settings.py', 'tests/test_auth.py']

    @pytest.mark.asyncio
    async def test_build_context_multiple_reviewers(
        mock_discovery,
        sample_review_inputs,
        sample_changed_files,
    ):
        """Test that different reviewers get filtered based on their entry points."""
>       security_agent = TestReviewerAgent(is_relevant=True)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class TestReviewerAgent with abstract method get_allowed_tools

tests/review/test_orchestrator_entry_points.py:366: TypeError
__________________ test_build_context_logs_agent_not_relevant __________________

mock_discovery = <MagicMock spec='EntryPointDiscovery' id='4600869776'>
sample_review_inputs = ReviewInputs(repo_root='/tmp/repo', base_ref='main', head_ref='feature', pr_title='Add authentication feature', pr_description='Implements login/logout functionality', ticket_description='', include_optional=False, timeout_seconds=60)
sample_changed_files = ['src/auth/login.py', 'src/auth/logout.py', 'src/api/routes.py', 'src/models/user.py', 'config/settings.py', 'tests/test_auth.py']
caplog = <_pytest.logging.LogCaptureFixture object at 0x112321450>

    @pytest.mark.asyncio
    async def test_build_context_logs_agent_not_relevant(
        mock_discovery,
        sample_review_inputs,
        sample_changed_files,
        caplog,
    ):
        """Test that skipping review for irrelevant agent is logged."""
        import logging
    
>       agent = TestReviewerAgent(agent_name="TestReviewer", is_relevant=False)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class TestReviewerAgent with abstract method get_allowed_tools

tests/review/test_orchestrator_entry_points.py:529: TypeError
_________ test_build_context_backward_compatibility_without_discovery __________

sample_review_inputs = ReviewInputs(repo_root='/tmp/repo', base_ref='main', head_ref='feature', pr_title='Add authentication feature', pr_description='Implements login/logout functionality', ticket_description='', include_optional=False, timeout_seconds=60)
sample_changed_files = ['src/auth/login.py', 'src/auth/logout.py', 'src/api/routes.py', 'src/models/user.py', 'config/settings.py', 'tests/test_auth.py']

    @pytest.mark.asyncio
    async def test_build_context_backward_compatibility_without_discovery(
        sample_review_inputs,
        sample_changed_files,
    ):
        """Test backward compatibility when orchestrator is used without discovery parameter."""
>       agent = TestReviewerAgent(agent_name="TestReviewer", is_relevant=True)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class TestReviewerAgent with abstract method get_allowed_tools

tests/review/test_orchestrator_entry_points.py:587: TypeError
__________________ test_build_context_discovery_non_blocking ___________________

mock_discovery = <MagicMock spec='EntryPointDiscovery' id='4587564432'>
sample_review_inputs = ReviewInputs(repo_root='/tmp/repo', base_ref='main', head_ref='feature', pr_title='Add authentication feature', pr_description='Implements login/logout functionality', ticket_description='', include_optional=False, timeout_seconds=60)
sample_changed_files = ['src/auth/login.py', 'src/auth/logout.py', 'src/api/routes.py', 'src/models/user.py', 'config/settings.py', 'tests/test_auth.py']
sample_entry_points = [EntryPoint(file_path='src/auth/login.py', line_number=10, description='Login function entry point', weight=0.95, patt..., line_number=20, description='API route handler', weight=0.85, pattern_type='content', evidence="@app.route('/api')")]

    @pytest.mark.asyncio
    async def test_build_context_discovery_non_blocking(
        mock_discovery,
        sample_review_inputs,
        sample_changed_files,
        sample_entry_points,
    ):
        """Test that slow discovery doesn't block orchestrator beyond timeout."""
>       agent = TestReviewerAgent(agent_name="TestReviewer", is_relevant=True)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class TestReviewerAgent with abstract method get_allowed_tools

tests/review/test_orchestrator_entry_points.py:613: TypeError
_______ TestFixtureCompatibility.test_orchestrator_compatibility_typical _______

self = <review.test_parity_baseline.TestFixtureCompatibility object at 0x107ab53d0>

    @pytest.mark.asyncio
    async def test_orchestrator_compatibility_typical(self):
        """Verify orchestrator can handle typical fixture output with findings."""
        from unittest.mock import AsyncMock, patch
        from dawn_kestrel.agents.review.contracts import OrchestratorOutput, ReviewOutput, Finding, MergeGate, Scope
    
        # Create a mock reviewer that returns typical fixture output with findings
        class MockReviewerWithFindings(BaseReviewerAgent):
            def get_agent_name(self) -> str:
                return "security"
    
            async def review(self, context: ReviewContext) -> ReviewOutput:
                return ReviewOutput(
                    agent="security",
                    summary="Found potential credential exposure in config file",
                    severity="blocking",
                    scope=Scope(
                        relevant_files=["config/secrets.yaml"],
                        ignored_files=[],
                        reasoning="Detected what appears to be a hardcoded API key in the configuration file"
                    ),
                    checks=[],
                    skips=[],
                    findings=[
                        Finding(
                            id="SEC-001",
                            title="Hardcoded API key in config",
                            severity="blocking",
                            confidence="high",
                            owner="security",
                            estimate="S",
                            evidence="Line 42 in config/secrets.yaml contains: AWS_ACCESS_KEY='AKIAIOSFODNN7EXAMPLE'",
                            risk="Secret exposed in version control and production",
                            recommendation="Remove the hardcoded key and load it from a secure environment variable or secret manager",
                            suggested_patch="Remove line 42 from config/secrets.yaml and use os.getenv('AWS_ACCESS_KEY')"
                        )
                    ],
                    merge_gate=MergeGate(
                        decision="block",
                        must_fix=["Remove hardcoded AWS_ACCESS_KEY from config/secrets.yaml"],
                        should_fix=["Add secrets validation during deployment"],
                        notes_for_coding_agent=[
                            "CRITICAL: Remove hardcoded AWS credentials immediately",
                            "Rotate any existing keys that may have been exposed"
                        ]
                    )
                )
    
            def get_system_prompt(self) -> str:
                return "Mock security review agent"
    
            def get_relevant_file_patterns(self) -> list[str]:
                return ["*.py"]
    
>       orchestrator = PRReviewOrchestrator(subagents=[MockReviewerWithFindings()])
                                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class MockReviewerWithFindings with abstract method get_allowed_tools

tests/review/test_parity_baseline.py:318: TypeError
_ TestPatternLearning.test_base_reviewer_agent_learn_entry_point_pattern_default _

self = <review.test_pattern_learning.TestPatternLearning object at 0x107ae6cd0>
caplog = <_pytest.logging.LogCaptureFixture object at 0x11221b510>

    def test_base_reviewer_agent_learn_entry_point_pattern_default(
        self,
        caplog
    ):
        """Test that BaseReviewerAgent.learn_entry_point_pattern() returns False by default."""
        # Create a concrete instance (can't instantiate abstract class directly)
        class TestReviewer(BaseReviewerAgent):
            async def review(self, context):
                pass
    
            def get_system_prompt(self):
                return "test"
    
            def get_relevant_file_patterns(self):
                return ["*.py"]
    
>       reviewer = TestReviewer()
                   ^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class TestReviewer with abstract methods get_agent_name, get_allowed_tools

tests/review/test_pattern_learning.py:725: TypeError
_ TestPatternLearning.test_base_reviewer_agent_learn_entry_point_pattern_override _

self = <review.test_pattern_learning.TestPatternLearning object at 0x107ae7350>
temp_docs_dir = PosixPath('/var/folders/7q/3wffhx8n6j927vjvnwqb7fxm0000gp/T/tmp8bpxw_he')

    def test_base_reviewer_agent_learn_entry_point_pattern_override(
        self,
        temp_docs_dir
    ):
        """Test overriding learn_entry_point_pattern() with PatternLearning."""
        class LearningReviewer(BaseReviewerAgent):
            """Reviewer that learns patterns."""
    
            def __init__(self):
                super().__init__()
                self.pattern_learning = PatternLearning(docs_dir=temp_docs_dir)
                self.name = 'learning_reviewer'
    
            async def review(self, context):
                pass
    
            def get_system_prompt(self):
                return "test"
    
            def get_relevant_file_patterns(self):
                return ["*.py"]
    
            def learn_entry_point_pattern(self, pattern):
                """Override to actually learn patterns."""
                return self.pattern_learning.add_learned_pattern(self.name, pattern)
    
>       reviewer = LearningReviewer()
                   ^^^^^^^^^^^^^^^^^^
E       TypeError: Can't instantiate abstract class LearningReviewer with abstract methods get_agent_name, get_allowed_tools

tests/review/test_pattern_learning.py:768: TypeError
___________________ TestBenchmarkResult.test_result_to_dict ____________________

self = <test_benchmarks.TestBenchmarkResult object at 0x11107ed10>

    def test_result_to_dict(self):
        """Test converting result to dictionary."""
        result = record_result(
            benchmark_name="test",
            metric_name="time",
            values=[0.1, 0.2],
            count=2,
            unit="s",
        )
    
        result_dict = result.to_dict()
    
        assert isinstance(result_dict, dict)
        assert result_dict["benchmark_name"] == "test"
        assert result_dict["metric_name"] == "time"
>       assert result_dict["mean"] == 0.15
E       assert 0.15000000000000002 == 0.15

tests/test_benchmarks.py:63: AssertionError
____________________ TestBenchmarkRunner.test_print_summary ____________________

self = <test_benchmarks.TestBenchmarkRunner object at 0x11109cb10>
capsys = <_pytest.capture.CaptureFixture object at 0x1114c4bd0>

    def test_print_summary(self, capsys):
        """Test printing benchmark summary."""
        runner = BenchmarkRunner(report_name="test_report")
    
        runner.add_benchmark(
            benchmark_name="test_benchmark",
            metric_name="test_metric",
            func=lambda: None,
            iterations=10,
            unit="s",
        )
    
        runner.print_summary()
    
        captured = capsys.readouterr()
        assert "test_report" in captured.out
>       assert "benchmark_name" in captured.out
E       assert 'benchmark_name' in "\n================================================================================\nBENCHMARK REPORT: test_report\n==...else 'N/A') (memory_created=0)\n\n================================================================================\n\n"
E        +  where "\n================================================================================\nBENCHMARK REPORT: test_report\n==...else 'N/A') (memory_created=0)\n\n================================================================================\n\n" = CaptureResult(out="\n================================================================================\nBENCHMARK REPOR...') (memory_created=0)\n\n================================================================================\n\n", err='').out

tests/test_benchmarks.py:230: AssertionError
_______ TestListSessionsCommand.test_list_sessions_uses_session_service ________

args = (<test_cli_integration.TestListSessionsCommand object at 0x1110c9090>,)
keywargs = {'temp_dir': PosixPath('/var/folders/7q/3wffhx8n6j927vjvnwqb7fxm0000gp/T/tmp8mkibyv0')}

    @wraps(func)
    def patched(*args, **keywargs):
>       with self.decoration_helper(patched,
                                    args,
                                    keywargs) as (newargs, newkeywargs):

../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1375: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1357: in decoration_helper
    arg = exit_stack.enter_context(patching)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/contextlib.py:517: in enter_context
    result = _enter(cm)
             ^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1446: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <unittest.mock._patch object at 0x11109ee50>

    def get_original(self):
        target = self.getter()
        name = self.attribute
    
        original = DEFAULT
        local = False
    
        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True
    
        if name in _builtins and isinstance(target, ModuleType):
            self.create = True
    
        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'dawn_kestrel.cli.main' from '/Users/parkersligting/develop/pt/worktrees/harness-agent-rework/dawn_kestrel/cli/main.py'> does not have the attribute 'DefaultSessionService'

../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1419: AttributeError
_________ TestListSessionsCommand.test_list_sessions_displays_sessions _________

args = (<test_cli_integration.TestListSessionsCommand object at 0x1110c9790>,)
keywargs = {'temp_dir': PosixPath('/var/folders/7q/3wffhx8n6j927vjvnwqb7fxm0000gp/T/tmpz14lm2uz')}

    @wraps(func)
    def patched(*args, **keywargs):
>       with self.decoration_helper(patched,
                                    args,
                                    keywargs) as (newargs, newkeywargs):

../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1375: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1357: in decoration_helper
    arg = exit_stack.enter_context(patching)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/contextlib.py:517: in enter_context
    result = _enter(cm)
             ^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1446: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <unittest.mock._patch object at 0x1110c0cd0>

    def get_original(self):
        target = self.getter()
        name = self.attribute
    
        original = DEFAULT
        local = False
    
        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True
    
        if name in _builtins and isinstance(target, ModuleType):
            self.create = True
    
        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'dawn_kestrel.cli.main' from '/Users/parkersligting/develop/pt/worktrees/harness-agent-rework/dawn_kestrel/cli/main.py'> does not have the attribute 'DefaultSessionService'

../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1419: AttributeError
______ TestExportSessionCommand.test_export_session_uses_session_service _______

args = (<test_cli_integration.TestExportSessionCommand object at 0x1110c9d90>,)
keywargs = {'temp_dir': PosixPath('/var/folders/7q/3wffhx8n6j927vjvnwqb7fxm0000gp/T/tmp_q4swj6y')}

    @wraps(func)
    def patched(*args, **keywargs):
>       with self.decoration_helper(patched,
                                    args,
                                    keywargs) as (newargs, newkeywargs):

../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1375: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1357: in decoration_helper
    arg = exit_stack.enter_context(patching)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/contextlib.py:517: in enter_context
    result = _enter(cm)
             ^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1446: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <unittest.mock._patch object at 0x1110c1010>

    def get_original(self):
        target = self.getter()
        name = self.attribute
    
        original = DEFAULT
        local = False
    
        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True
    
        if name in _builtins and isinstance(target, ModuleType):
            self.create = True
    
        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'dawn_kestrel.cli.main' from '/Users/parkersligting/develop/pt/worktrees/harness-agent-rework/dawn_kestrel/cli/main.py'> does not have the attribute 'GitSnapshot'

../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1419: AttributeError
______ TestExportSessionCommand.test_export_session_uses_progress_handler ______

args = (<test_cli_integration.TestExportSessionCommand object at 0x1110ca1d0>,)
keywargs = {'temp_dir': PosixPath('/var/folders/7q/3wffhx8n6j927vjvnwqb7fxm0000gp/T/tmp626rw95g')}

    @wraps(func)
    def patched(*args, **keywargs):
>       with self.decoration_helper(patched,
                                    args,
                                    keywargs) as (newargs, newkeywargs):

../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1375: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1357: in decoration_helper
    arg = exit_stack.enter_context(patching)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/contextlib.py:517: in enter_context
    result = _enter(cm)
             ^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1446: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <unittest.mock._patch object at 0x1110c1550>

    def get_original(self):
        target = self.getter()
        name = self.attribute
    
        original = DEFAULT
        local = False
    
        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True
    
        if name in _builtins and isinstance(target, ModuleType):
            self.create = True
    
        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'dawn_kestrel.cli.main' from '/Users/parkersligting/develop/pt/worktrees/harness-agent-rework/dawn_kestrel/cli/main.py'> does not have the attribute 'GitSnapshot'

../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1419: AttributeError
______ TestImportSessionCommand.test_import_session_uses_session_service _______

args = (<test_cli_integration.TestImportSessionCommand object at 0x1110caa50>,)
keywargs = {'temp_dir': PosixPath('/var/folders/7q/3wffhx8n6j927vjvnwqb7fxm0000gp/T/tmpugpajyvb')}

    @wraps(func)
    def patched(*args, **keywargs):
>       with self.decoration_helper(patched,
                                    args,
                                    keywargs) as (newargs, newkeywargs):

../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1375: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1357: in decoration_helper
    arg = exit_stack.enter_context(patching)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/contextlib.py:517: in enter_context
    result = _enter(cm)
             ^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1446: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <unittest.mock._patch object at 0x1110c1e10>

    def get_original(self):
        target = self.getter()
        name = self.attribute
    
        original = DEFAULT
        local = False
    
        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True
    
        if name in _builtins and isinstance(target, ModuleType):
            self.create = True
    
        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'dawn_kestrel.cli.main' from '/Users/parkersligting/develop/pt/worktrees/harness-agent-rework/dawn_kestrel/cli/main.py'> does not have the attribute 'MessageStorage'

../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1419: AttributeError
____ TestImportSessionCommand.test_import_session_uses_notification_handler ____

args = (<test_cli_integration.TestImportSessionCommand object at 0x1110cb050>,)
keywargs = {'temp_dir': PosixPath('/var/folders/7q/3wffhx8n6j927vjvnwqb7fxm0000gp/T/tmplhn8g6ax')}

    @wraps(func)
    def patched(*args, **keywargs):
>       with self.decoration_helper(patched,
                                    args,
                                    keywargs) as (newargs, newkeywargs):

../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1375: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1357: in decoration_helper
    arg = exit_stack.enter_context(patching)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/contextlib.py:517: in enter_context
    result = _enter(cm)
             ^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1446: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <unittest.mock._patch object at 0x1110c2790>

    def get_original(self):
        target = self.getter()
        name = self.attribute
    
        original = DEFAULT
        local = False
    
        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True
    
        if name in _builtins and isinstance(target, ModuleType):
            self.create = True
    
        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'dawn_kestrel.cli.main' from '/Users/parkersligting/develop/pt/worktrees/harness-agent-rework/dawn_kestrel/cli/main.py'> does not have the attribute 'MessageStorage'

../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1419: AttributeError
______ TestDeprecationWarnings.test_tui_command_shows_deprecation_warning ______

args = (<test_cli_integration.TestDeprecationWarnings object at 0x1110cb8d0>,)
keywargs = {'temp_dir': PosixPath('/var/folders/7q/3wffhx8n6j927vjvnwqb7fxm0000gp/T/tmp9iv24pe6')}

    @wraps(func)
    def patched(*args, **keywargs):
>       with self.decoration_helper(patched,
                                    args,
                                    keywargs) as (newargs, newkeywargs):

../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1375: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1357: in decoration_helper
    arg = exit_stack.enter_context(patching)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/contextlib.py:517: in enter_context
    result = _enter(cm)
             ^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1446: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <unittest.mock._patch object at 0x1110c2d10>

    def get_original(self):
        target = self.getter()
        name = self.attribute
    
        original = DEFAULT
        local = False
    
        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True
    
        if name in _builtins and isinstance(target, ModuleType):
            self.create = True
    
        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'dawn_kestrel.cli.main' from '/Users/parkersligting/develop/pt/worktrees/harness-agent-rework/dawn_kestrel/cli/main.py'> does not have the attribute 'DefaultSessionService'

../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1419: AttributeError
________ TestBackwardCompatibility.test_list_sessions_output_unchanged _________

args = (<test_cli_integration.TestBackwardCompatibility object at 0x1110c4190>,)
keywargs = {'temp_dir': PosixPath('/var/folders/7q/3wffhx8n6j927vjvnwqb7fxm0000gp/T/tmpm630heid')}

    @wraps(func)
    def patched(*args, **keywargs):
>       with self.decoration_helper(patched,
                                    args,
                                    keywargs) as (newargs, newkeywargs):

../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1375: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1357: in decoration_helper
    arg = exit_stack.enter_context(patching)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/contextlib.py:517: in enter_context
    result = _enter(cm)
             ^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1446: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <unittest.mock._patch object at 0x1110c3290>

    def get_original(self):
        target = self.getter()
        name = self.attribute
    
        original = DEFAULT
        local = False
    
        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True
    
        if name in _builtins and isinstance(target, ModuleType):
            self.create = True
    
        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'dawn_kestrel.cli.main' from '/Users/parkersligting/develop/pt/worktrees/harness-agent-rework/dawn_kestrel/cli/main.py'> does not have the attribute 'DefaultSessionService'

../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1419: AttributeError
_____________________________ test_session_export ______________________________

temp_session = (<dawn_kestrel.core.session.SessionManager object at 0x112322f90>, Session(id='eb861295-bd16-4104-b4be-8fbb002bec14', ...dated=1770613692.104134, time_compacting=None, time_archived=None, message_counter=0, message_count=0, total_cost=0.0))

    @pytest.mark.asyncio
    async def test_session_export(temp_session):
        """Test session export to JSON"""
        session_mgr, session_obj = temp_session
    
        exporter = create_import_export_manager(session_obj)
>       export_data = await exporter.export_session()
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_export_import.py:59: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
dawn_kestrel/session/import_export.py:37: in export_session
    session_data = self.session.to_dict()
                   ^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = Session(id='eb861295-bd16-4104-b4be-8fbb002bec14', slug='test-session', project_id='tmpwm6badrb', directory='/var/fold...pdated=1770613692.104134, time_compacting=None, time_archived=None, message_counter=0, message_count=0, total_cost=0.0)
item = 'to_dict'

    def __getattr__(self, item: str) -> Any:
        private_attributes = object.__getattribute__(self, '__private_attributes__')
        if item in private_attributes:
            attribute = private_attributes[item]
            if hasattr(attribute, '__get__'):
                return attribute.__get__(self, type(self))  # type: ignore
    
            try:
                # Note: self.__pydantic_private__ cannot be None if self.__private_attributes__ has items
                return self.__pydantic_private__[item]  # type: ignore
            except KeyError as exc:
                raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}') from exc
        else:
            # `__pydantic_extra__` can fail to be set if the model is not yet fully initialized.
            # See `BaseModel.__repr_args__` for more details
            try:
                pydantic_extra = object.__getattribute__(self, '__pydantic_extra__')
            except AttributeError:
                pydantic_extra = None
    
            if pydantic_extra and item in pydantic_extra:
                return pydantic_extra[item]
            else:
                if hasattr(self.__class__, item):
                    return super().__getattribute__(item)  # Raises AttributeError if appropriate
                else:
                    # this is the current error
>                   raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
E                   AttributeError: 'Session' object has no attribute 'to_dict'

.venv/lib/python3.11/site-packages/pydantic/main.py:1026: AttributeError
_________________________ test_session_export_to_file __________________________

temp_session = (<dawn_kestrel.core.session.SessionManager object at 0x112424c50>, Session(id='42e58803-da95-4304-950a-e98d0a085653', ...dated=1770613692.124175, time_compacting=None, time_archived=None, message_counter=0, message_count=0, total_cost=0.0))
tmp_path = PosixPath('/private/var/folders/7q/3wffhx8n6j927vjvnwqb7fxm0000gp/T/pytest-of-parkersligting/pytest-91/test_session_export_to_file0')

    @pytest.mark.asyncio
    async def test_session_export_to_file(temp_session, tmp_path):
        """Test exporting session to file"""
        session_mgr, session_obj = temp_session
    
        exporter = create_import_export_manager(session_obj)
>       export_data = await exporter.export_session()
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_export_import.py:81: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
dawn_kestrel/session/import_export.py:37: in export_session
    session_data = self.session.to_dict()
                   ^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = Session(id='42e58803-da95-4304-950a-e98d0a085653', slug='test-session', project_id='tmpkzif97jk', directory='/var/fold...pdated=1770613692.124175, time_compacting=None, time_archived=None, message_counter=0, message_count=0, total_cost=0.0)
item = 'to_dict'

    def __getattr__(self, item: str) -> Any:
        private_attributes = object.__getattribute__(self, '__private_attributes__')
        if item in private_attributes:
            attribute = private_attributes[item]
            if hasattr(attribute, '__get__'):
                return attribute.__get__(self, type(self))  # type: ignore
    
            try:
                # Note: self.__pydantic_private__ cannot be None if self.__private_attributes__ has items
                return self.__pydantic_private__[item]  # type: ignore
            except KeyError as exc:
                raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}') from exc
        else:
            # `__pydantic_extra__` can fail to be set if the model is not yet fully initialized.
            # See `BaseModel.__repr_args__` for more details
            try:
                pydantic_extra = object.__getattribute__(self, '__pydantic_extra__')
            except AttributeError:
                pydantic_extra = None
    
            if pydantic_extra and item in pydantic_extra:
                return pydantic_extra[item]
            else:
                if hasattr(self.__class__, item):
                    return super().__getattribute__(item)  # Raises AttributeError if appropriate
                else:
                    # this is the current error
>                   raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
E                   AttributeError: 'Session' object has no attribute 'to_dict'

.venv/lib/python3.11/site-packages/pydantic/main.py:1026: AttributeError
________ TestAllAgentsRegistered.test_all_bolt_merlin_agents_registered ________

self = <test_opencode_agents_integration.TestAllAgentsRegistered object at 0x1112327d0>
agent_registry_with_bolt_merlin = <dawn_kestrel.agents.registry.AgentRegistry object at 0x114dae550>

    def test_all_bolt_merlin_agents_registered(self, agent_registry_with_bolt_merlin):
        """All opencode agents should be registered."""
        agent_names = agent_registry_with_bolt_merlin.list_agents()
    
        expected_agents = [
            "orchestrator",
            "consultant",
            "librarian",
            "explore",
            "multimodal_looker",
            "autonomous_worker",
            "pre_planning",
            "plan_validator",
            "planner",
            "master_orchestrator",
        ]
    
        for name in expected_agents:
>           assert name in agent_names, f"Agent {name} not registered"
E           AssertionError: Agent orchestrator not registered
E           assert 'orchestrator' in [Agent(name='build', description='The default agent. Executes tools based on configured permissions.', mode='primary',...opic/claude-opus-4-6', 'max_tokens': 64000, 'thinking': {'type': 'enabled', 'budget_tokens': 48000}}, steps=None), ...]

tests/test_opencode_agents_integration.py:200: AssertionError
______________ TestSkillUsage.test_frontend_ui_ux_skill_available ______________

self = <test_opencode_agents_integration.TestSkillUsage object at 0x111244f10>
agent_runtime = <dawn_kestrel.agents.runtime.AgentRuntime object at 0x114bb2750>
mock_session = Session(id='test-session-123', slug='test-session', project_id='test-project', directory='/tmp/test-project', parent_i...pdated=1770613692.310514, time_compacting=None, time_archived=None, message_counter=0, message_count=0, total_cost=0.0)
mock_session_manager = <AsyncMock id='4585136912'>
builtin_registry = <dawn_kestrel.tools.framework.ToolRegistry object at 0x112424b50>

    @pytest.mark.asyncio
    async def test_frontend_ui_ux_skill_available(
        self,
        agent_runtime,
        mock_session,
        mock_session_manager,
        builtin_registry,
    ):
        """Frontend UI/UX skill should be available and loadable."""
        # The skill is a string that can be loaded
        skill_content = create_frontend_ui_ux_skill()
    
        assert isinstance(skill_content, str)
        assert len(skill_content) > 500  # Should have substantial content
>       assert "frontend" in skill_content.lower() or "ui/ux" in skill_content.lower()
E       assert ('frontend' in "# role: designer-turned-developer\n\nyou are a designer who learned to code. you see what pure developers missspacin... dark themes, different fonts, different aesthetics. you are capable of extraordinary creative workdon't hold back.\n" or 'ui/ux' in "# role: designer-turned-developer\n\nyou are a designer who learned to code. you see what pure developers missspacin... dark themes, different fonts, different aesthetics. you are capable of extraordinary creative workdon't hold back.\n")
E        +  where "# role: designer-turned-developer\n\nyou are a designer who learned to code. you see what pure developers missspacin... dark themes, different fonts, different aesthetics. you are capable of extraordinary creative workdon't hold back.\n" = <built-in method lower of str object at 0x107131200>()
E        +    where <built-in method lower of str object at 0x107131200> = "# Role: Designer-Turned-Developer\n\nYou are a designer who learned to code. You see what pure developers missspacin... dark themes, different fonts, different aesthetics. You are capable of extraordinary creative workdon't hold back.\n".lower
E        +  and   "# role: designer-turned-developer\n\nyou are a designer who learned to code. you see what pure developers missspacin... dark themes, different fonts, different aesthetics. you are capable of extraordinary creative workdon't hold back.\n" = <built-in method lower of str object at 0x107131200>()
E        +    where <built-in method lower of str object at 0x107131200> = "# Role: Designer-Turned-Developer\n\nYou are a designer who learned to code. You see what pure developers missspacin... dark themes, different fonts, different aesthetics. You are capable of extraordinary creative workdon't hold back.\n".lower

tests/test_opencode_agents_integration.py:600: AssertionError
________ TestToolPermissionFiltering.test_explore_specific_permissions _________

self = <test_opencode_agents_integration.TestToolPermissionFiltering object at 0x111246dd0>
agent_runtime = <dawn_kestrel.agents.runtime.AgentRuntime object at 0x1124d0a50>
mock_session = Session(id='test-session-123', slug='test-session', project_id='test-project', directory='/tmp/test-project', parent_i...pdated=1770613692.371934, time_compacting=None, time_archived=None, message_counter=0, message_count=0, total_cost=0.0)
mock_session_manager = <AsyncMock id='4601350224'>
builtin_registry = <dawn_kestrel.tools.framework.ToolRegistry object at 0x112378450>

    @pytest.mark.asyncio
    async def test_explore_specific_permissions(
        self,
        agent_runtime,
        mock_session,
        mock_session_manager,
        builtin_registry,
    ):
        """Explore agent should only have search tools allowed."""
        explore_agent = create_explore_agent()
    
        with patch.object(
            agent_runtime.agent_registry,
            "get_agent",
            return_value=explore_agent,
        ):
            mock_ai_session = AsyncMock()
            mock_response = create_mock_response(
                mock_session.id,
                "Found results",
                tools_used=["grep", "glob", "read"],
            )
            mock_ai_session.process_message = AsyncMock(return_value=mock_response)
    
            with patch(
                "dawn_kestrel.agents.runtime.AISession", return_value=mock_ai_session
            ) as mock_ai_class:
                await agent_runtime.execute_agent(
                    agent_name="explore",
                    session_id=mock_session.id,
                    user_message="Find files",
                    session_manager=mock_session_manager,
                    tools=builtin_registry,
                    skills=[],
                    options={},
                )
    
                call_kwargs = mock_ai_class.call_args[1]
                filtered_registry = call_kwargs["tool_registry"]
    
                # Explore should have grep, glob, read allowed
                # But not write/edit
>               assert "grep" in filtered_registry.tools
E               AssertionError: assert 'grep' in {}
E                +  where {} = <dawn_kestrel.tools.framework.ToolRegistry object at 0x112463a90>.tools

tests/test_opencode_agents_integration.py:888: AssertionError
_________________ test_migration_doc_required_sections_present _________________

    def test_migration_doc_required_sections_present() -> None:
>       spec_text = _read(CANONICAL_SPEC_PATH)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_planning_docs_migration.py:20: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/test_planning_docs_migration.py:16: in _read
    return path.read_text(encoding="utf-8")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/pathlib.py:1058: in read_text
    with self.open(mode='r', encoding=encoding, errors=errors) as f:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = PosixPath('/Users/parkersligting/develop/pt/worktrees/docs/planning-agent-orchestration.md')
mode = 'r', buffering = -1, encoding = 'utf-8', errors = None, newline = None

    def open(self, mode='r', buffering=-1, encoding=None,
             errors=None, newline=None):
        """
        Open the file pointed by this path and return a file object, as
        the built-in open() function does.
        """
        if "b" not in mode:
            encoding = io.text_encoding(encoding)
>       return io.open(self, mode, buffering, encoding, errors, newline)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       FileNotFoundError: [Errno 2] No such file or directory: '/Users/parkersligting/develop/pt/worktrees/docs/planning-agent-orchestration.md'

../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/pathlib.py:1044: FileNotFoundError
_________________ test_policy_precedence_has_no_contradictions _________________

    def test_policy_precedence_has_no_contradictions() -> None:
>       spec_text = _read(CANONICAL_SPEC_PATH)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_planning_docs_migration.py:36: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/test_planning_docs_migration.py:16: in _read
    return path.read_text(encoding="utf-8")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/pathlib.py:1058: in read_text
    with self.open(mode='r', encoding=encoding, errors=errors) as f:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = PosixPath('/Users/parkersligting/develop/pt/worktrees/docs/planning-agent-orchestration.md')
mode = 'r', buffering = -1, encoding = 'utf-8', errors = None, newline = None

    def open(self, mode='r', buffering=-1, encoding=None,
             errors=None, newline=None):
        """
        Open the file pointed by this path and return a file object, as
        the built-in open() function does.
        """
        if "b" not in mode:
            encoding = io.text_encoding(encoding)
>       return io.open(self, mode, buffering, encoding, errors, newline)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       FileNotFoundError: [Errno 2] No such file or directory: '/Users/parkersligting/develop/pt/worktrees/docs/planning-agent-orchestration.md'

../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/pathlib.py:1044: FileNotFoundError
_______________________ test_runtime_surface_paths_exist _______________________

    def test_runtime_surface_paths_exist() -> None:
        for path in [CANONICAL_SPEC_PATH, INTEGRATION_MAP_PATH, PLAN_ENTER_PATH, PLAN_EXIT_PATH]:
>           assert path.exists(), f"Missing required migration surface: {path}"
E           AssertionError: Missing required migration surface: /Users/parkersligting/develop/pt/worktrees/docs/planning-agent-orchestration.md
E           assert False
E            +  where False = exists()
E            +    where exists = PosixPath('/Users/parkersligting/develop/pt/worktrees/docs/planning-agent-orchestration.md').exists

tests/test_planning_docs_migration.py:49: AssertionError
_____________ test_migration_notes_preserve_plan_safety_semantics ______________

    def test_migration_notes_preserve_plan_safety_semantics() -> None:
>       spec_text = _read(CANONICAL_SPEC_PATH)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_planning_docs_migration.py:53: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/test_planning_docs_migration.py:16: in _read
    return path.read_text(encoding="utf-8")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/pathlib.py:1058: in read_text
    with self.open(mode='r', encoding=encoding, errors=errors) as f:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = PosixPath('/Users/parkersligting/develop/pt/worktrees/docs/planning-agent-orchestration.md')
mode = 'r', buffering = -1, encoding = 'utf-8', errors = None, newline = None

    def open(self, mode='r', buffering=-1, encoding=None,
             errors=None, newline=None):
        """
        Open the file pointed by this path and return a file object, as
        the built-in open() function does.
        """
        if "b" not in mode:
            encoding = io.text_encoding(encoding)
>       return io.open(self, mode, buffering, encoding, errors, newline)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       FileNotFoundError: [Errno 2] No such file or directory: '/Users/parkersligting/develop/pt/worktrees/docs/planning-agent-orchestration.md'

../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/pathlib.py:1044: FileNotFoundError
________________________ test_required_sections_present ________________________

    def test_required_sections_present() -> None:
>       spec_text = _read_spec()
                    ^^^^^^^^^^^^

tests/test_planning_prompt_contract.py:17: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/test_planning_prompt_contract.py:13: in _read_spec
    return CANONICAL_SPEC_PATH.read_text(encoding="utf-8")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/pathlib.py:1058: in read_text
    with self.open(mode='r', encoding=encoding, errors=errors) as f:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = PosixPath('/Users/parkersligting/develop/pt/worktrees/docs/planning-agent-orchestration.md')
mode = 'r', buffering = -1, encoding = 'utf-8', errors = None, newline = None

    def open(self, mode='r', buffering=-1, encoding=None,
             errors=None, newline=None):
        """
        Open the file pointed by this path and return a file object, as
        the built-in open() function does.
        """
        if "b" not in mode:
            encoding = io.text_encoding(encoding)
>       return io.open(self, mode, buffering, encoding, errors, newline)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       FileNotFoundError: [Errno 2] No such file or directory: '/Users/parkersligting/develop/pt/worktrees/docs/planning-agent-orchestration.md'

../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/pathlib.py:1044: FileNotFoundError
____________________ test_forbidden_vague_directives_absent ____________________

    def test_forbidden_vague_directives_absent() -> None:
>       spec_text = _read_spec()
                    ^^^^^^^^^^^^

tests/test_planning_prompt_contract.py:33: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/test_planning_prompt_contract.py:13: in _read_spec
    return CANONICAL_SPEC_PATH.read_text(encoding="utf-8")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/pathlib.py:1058: in read_text
    with self.open(mode='r', encoding=encoding, errors=errors) as f:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = PosixPath('/Users/parkersligting/develop/pt/worktrees/docs/planning-agent-orchestration.md')
mode = 'r', buffering = -1, encoding = 'utf-8', errors = None, newline = None

    def open(self, mode='r', buffering=-1, encoding=None,
             errors=None, newline=None):
        """
        Open the file pointed by this path and return a file object, as
        the built-in open() function does.
        """
        if "b" not in mode:
            encoding = io.text_encoding(encoding)
>       return io.open(self, mode, buffering, encoding, errors, newline)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       FileNotFoundError: [Errno 2] No such file or directory: '/Users/parkersligting/develop/pt/worktrees/docs/planning-agent-orchestration.md'

../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/pathlib.py:1044: FileNotFoundError
________________ test_stagnation_trigger_forces_strategy_switch ________________

    def test_stagnation_trigger_forces_strategy_switch() -> None:
>       spec_text = _read_spec()
                    ^^^^^^^^^^^^

tests/test_planning_prompt_contract.py:44: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/test_planning_prompt_contract.py:13: in _read_spec
    return CANONICAL_SPEC_PATH.read_text(encoding="utf-8")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/pathlib.py:1058: in read_text
    with self.open(mode='r', encoding=encoding, errors=errors) as f:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = PosixPath('/Users/parkersligting/develop/pt/worktrees/docs/planning-agent-orchestration.md')
mode = 'r', buffering = -1, encoding = 'utf-8', errors = None, newline = None

    def open(self, mode='r', buffering=-1, encoding=None,
             errors=None, newline=None):
        """
        Open the file pointed by this path and return a file object, as
        the built-in open() function does.
        """
        if "b" not in mode:
            encoding = io.text_encoding(encoding)
>       return io.open(self, mode, buffering, encoding, errors, newline)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       FileNotFoundError: [Errno 2] No such file or directory: '/Users/parkersligting/develop/pt/worktrees/docs/planning-agent-orchestration.md'

../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/pathlib.py:1044: FileNotFoundError
____________ test_budget_exhaustion_emits_single_blocking_question _____________

    def test_budget_exhaustion_emits_single_blocking_question() -> None:
>       spec_text = _read_spec()
                    ^^^^^^^^^^^^

tests/test_planning_prompt_contract.py:68: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/test_planning_prompt_contract.py:13: in _read_spec
    return CANONICAL_SPEC_PATH.read_text(encoding="utf-8")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/pathlib.py:1058: in read_text
    with self.open(mode='r', encoding=encoding, errors=errors) as f:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = PosixPath('/Users/parkersligting/develop/pt/worktrees/docs/planning-agent-orchestration.md')
mode = 'r', buffering = -1, encoding = 'utf-8', errors = None, newline = None

    def open(self, mode='r', buffering=-1, encoding=None,
             errors=None, newline=None):
        """
        Open the file pointed by this path and return a file object, as
        the built-in open() function does.
        """
        if "b" not in mode:
            encoding = io.text_encoding(encoding)
>       return io.open(self, mode, buffering, encoding, errors, newline)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       FileNotFoundError: [Errno 2] No such file or directory: '/Users/parkersligting/develop/pt/worktrees/docs/planning-agent-orchestration.md'

../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/pathlib.py:1044: FileNotFoundError
____________________ test_rejects_evidence_theater_outputs _____________________

    def test_rejects_evidence_theater_outputs() -> None:
>       spec_text = _read_spec()
                    ^^^^^^^^^^^^

tests/test_planning_prompt_contract.py:83: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/test_planning_prompt_contract.py:13: in _read_spec
    return CANONICAL_SPEC_PATH.read_text(encoding="utf-8")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/pathlib.py:1058: in read_text
    with self.open(mode='r', encoding=encoding, errors=errors) as f:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = PosixPath('/Users/parkersligting/develop/pt/worktrees/docs/planning-agent-orchestration.md')
mode = 'r', buffering = -1, encoding = 'utf-8', errors = None, newline = None

    def open(self, mode='r', buffering=-1, encoding=None,
             errors=None, newline=None):
        """
        Open the file pointed by this path and return a file object, as
        the built-in open() function does.
        """
        if "b" not in mode:
            encoding = io.text_encoding(encoding)
>       return io.open(self, mode, buffering, encoding, errors, newline)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       FileNotFoundError: [Errno 2] No such file or directory: '/Users/parkersligting/develop/pt/worktrees/docs/planning-agent-orchestration.md'

../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/pathlib.py:1044: FileNotFoundError
______________ test_prevents_over_interviewing_after_budget_limit ______________

    def test_prevents_over_interviewing_after_budget_limit() -> None:
>       spec_text = _read_spec()
                    ^^^^^^^^^^^^

tests/test_planning_prompt_contract.py:91: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/test_planning_prompt_contract.py:13: in _read_spec
    return CANONICAL_SPEC_PATH.read_text(encoding="utf-8")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/pathlib.py:1058: in read_text
    with self.open(mode='r', encoding=encoding, errors=errors) as f:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = PosixPath('/Users/parkersligting/develop/pt/worktrees/docs/planning-agent-orchestration.md')
mode = 'r', buffering = -1, encoding = 'utf-8', errors = None, newline = None

    def open(self, mode='r', buffering=-1, encoding=None,
             errors=None, newline=None):
        """
        Open the file pointed by this path and return a file object, as
        the built-in open() function does.
        """
        if "b" not in mode:
            encoding = io.text_encoding(encoding)
>       return io.open(self, mode, buffering, encoding, errors, newline)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       FileNotFoundError: [Errno 2] No such file or directory: '/Users/parkersligting/develop/pt/worktrees/docs/planning-agent-orchestration.md'

../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/pathlib.py:1044: FileNotFoundError
____ TestOpenCodeAsyncClientSessionMethods.test_async_client_create_session ____

self = <dawn_kestrel.sdk.client.OpenCodeAsyncClient object at 0x114c131d0>
title = 'Test Session', version = '1.0.0'

    async def create_session(
        self,
        title: str,
        version: str = "1.0.0",
    ) -> Session:
        """Create a new session.
    
        Args:
            title: Session title.
            version: Session version.
    
        Returns:
            Created Session object.
    
        Raises:
            SessionError: If session creation fails.
        """
        try:
>           session = await self._service.create_session(title)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E           TypeError: object Mock can't be used in 'await' expression

dawn_kestrel/sdk/client.py:125: TypeError

The above exception was the direct cause of the following exception:

self = <test_sdk_async_client.TestOpenCodeAsyncClientSessionMethods object at 0x1112afed0>
mock_storage_cls = <MagicMock name='DefaultSessionService' id='4602741456'>
mock_service_cls = <MagicMock name='SessionStorage' id='4644815760'>

    @patch("dawn_kestrel.sdk.client.SessionStorage")
    @patch("dawn_kestrel.sdk.client.DefaultSessionService")
    @pytest.mark.asyncio
    async def test_async_client_create_session(
        self, mock_storage_cls, mock_service_cls
    ) -> None:
        """Test OpenCodeAsyncClient.create_session() method."""
        mock_storage = Mock()
        mock_storage_cls.return_value = mock_storage
    
        mock_service = Mock()
        mock_service_cls.return_value = mock_service
    
        session = Session(
            id="ses_001",
            title="Test Session",
            slug="test-session",
            project_id="test-project",
            directory="/test",
            time_created=1234567890,
            version="1.0.0",
        )
        mock_service.create_session = AsyncMock(return_value=session)
    
        client = OpenCodeAsyncClient()
>       result = await client.create_session(title="Test Session")
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_sdk_async_client.py:161: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <dawn_kestrel.sdk.client.OpenCodeAsyncClient object at 0x114c131d0>
title = 'Test Session', version = '1.0.0'

    async def create_session(
        self,
        title: str,
        version: str = "1.0.0",
    ) -> Session:
        """Create a new session.
    
        Args:
            title: Session title.
            version: Session version.
    
        Returns:
            Created Session object.
    
        Raises:
            SessionError: If session creation fails.
        """
        try:
            session = await self._service.create_session(title)
            return session
        except Exception as e:
            if isinstance(e, OpenCodeError):
                raise
>           raise SessionError(f"Failed to create session: {e}") from e
E           dawn_kestrel.core.exceptions.SessionError: Failed to create session: object Mock can't be used in 'await' expression

dawn_kestrel/sdk/client.py:130: SessionError
____ TestOpenCodeAsyncClientSessionMethods.test_async_client_delete_session ____

self = <dawn_kestrel.core.services.session_service.DefaultSessionService object at 0x114acea10>
session_id = 'ses_001'

    async def delete_session(self, session_id: str) -> bool:
        """Delete a session using injected handlers.
    
        Args:
            session_id: The session ID to delete.
    
        Returns:
            True if deleted, False if not found.
    
        Raises:
            SessionError: If deletion fails.
        """
        try:
            if self._progress_handler:
                self._progress_handler.start("Deleting session", 100)
                self._progress_handler.update(50, f"Deleting {session_id}...")
    
>           deleted = await self._manager.delete_session(session_id)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

dawn_kestrel/core/services/session_service.py:235: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
dawn_kestrel/core/session.py:107: in delete_session
    session = await self.get_session(session_id)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <dawn_kestrel.core.session.SessionManager object at 0x1125e9c50>
session_id = 'ses_001'

    async def get_session(self, session_id: str) -> Optional[Session]:
        """Get a session by ID"""
>       return await self.storage.get_session(session_id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: object Mock can't be used in 'await' expression

dawn_kestrel/core/session.py:77: TypeError

The above exception was the direct cause of the following exception:

self = <test_sdk_async_client.TestOpenCodeAsyncClientSessionMethods object at 0x1112aea10>
mock_storage_cls = <MagicMock name='SessionStorage' id='4641844880'>
mock_service_cls = <MagicMock name='DefaultSessionService' id='4599505616'>

    @patch("dawn_kestrel.core.services.session_service.DefaultSessionService")
    @patch("dawn_kestrel.sdk.client.SessionStorage")
    @pytest.mark.asyncio
    async def test_async_client_delete_session(
        self, mock_storage_cls, mock_service_cls
    ) -> None:
        """Test OpenCodeAsyncClient.delete_session() method."""
        mock_storage = Mock()
        mock_storage_cls.return_value = mock_storage
    
        mock_service = Mock()
        mock_service_cls.return_value = mock_service
    
        mock_service.delete_session = AsyncMock(return_value=True)
    
        client = OpenCodeAsyncClient()
>       result = await client.delete_session(session_id="ses_001")
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_sdk_async_client.py:272: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
dawn_kestrel/sdk/client.py:182: in delete_session
    deleted = await self._service.delete_session(session_id)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <dawn_kestrel.core.services.session_service.DefaultSessionService object at 0x114acea10>
session_id = 'ses_001'

    async def delete_session(self, session_id: str) -> bool:
        """Delete a session using injected handlers.
    
        Args:
            session_id: The session ID to delete.
    
        Returns:
            True if deleted, False if not found.
    
        Raises:
            SessionError: If deletion fails.
        """
        try:
            if self._progress_handler:
                self._progress_handler.start("Deleting session", 100)
                self._progress_handler.update(50, f"Deleting {session_id}...")
    
            deleted = await self._manager.delete_session(session_id)
    
            if deleted:
                if self._progress_handler:
                    self._progress_handler.update(100, "Session deleted")
                    self._progress_handler.complete(f"Deleted session: {session_id}")
    
                if self._notification_handler:
                    self._notification_handler.show(Notification(
                        notification_type=NotificationType.SUCCESS,
                        message=f"Session {session_id} deleted",
                    ))
    
            return deleted
    
        except Exception as e:
>           raise SessionError(f"Failed to delete session: {e}") from e
E           dawn_kestrel.core.exceptions.SessionError: Failed to delete session: object Mock can't be used in 'await' expression

dawn_kestrel/core/services/session_service.py:251: SessionError
_ TestOpenCodeAsyncClientSessionMethods.test_async_client_delete_session_not_found _

self = <dawn_kestrel.core.services.session_service.DefaultSessionService object at 0x112438d90>
session_id = 'nonexistent'

    async def delete_session(self, session_id: str) -> bool:
        """Delete a session using injected handlers.
    
        Args:
            session_id: The session ID to delete.
    
        Returns:
            True if deleted, False if not found.
    
        Raises:
            SessionError: If deletion fails.
        """
        try:
            if self._progress_handler:
                self._progress_handler.start("Deleting session", 100)
                self._progress_handler.update(50, f"Deleting {session_id}...")
    
>           deleted = await self._manager.delete_session(session_id)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

dawn_kestrel/core/services/session_service.py:235: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
dawn_kestrel/core/session.py:107: in delete_session
    session = await self.get_session(session_id)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <dawn_kestrel.core.session.SessionManager object at 0x1122e01d0>
session_id = 'nonexistent'

    async def get_session(self, session_id: str) -> Optional[Session]:
        """Get a session by ID"""
>       return await self.storage.get_session(session_id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: object Mock can't be used in 'await' expression

dawn_kestrel/core/session.py:77: TypeError

The above exception was the direct cause of the following exception:

self = <test_sdk_async_client.TestOpenCodeAsyncClientSessionMethods object at 0x1112b5b50>
mock_storage_cls = <MagicMock name='SessionStorage' id='4642050128'>
mock_service_cls = <MagicMock name='DefaultSessionService' id='4642047312'>

    @patch("dawn_kestrel.core.services.session_service.DefaultSessionService")
    @patch("dawn_kestrel.sdk.client.SessionStorage")
    @pytest.mark.asyncio
    async def test_async_client_delete_session_not_found(
        self, mock_storage_cls, mock_service_cls
    ) -> None:
        """Test OpenCodeAsyncClient.delete_session() when session not found."""
        mock_storage = Mock()
        mock_storage_cls.return_value = mock_storage
    
        mock_service = Mock()
        mock_service_cls.return_value = mock_service
    
        mock_service.delete_session = AsyncMock(return_value=False)
    
        client = OpenCodeAsyncClient()
>       result = await client.delete_session(session_id="nonexistent")
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_sdk_async_client.py:293: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
dawn_kestrel/sdk/client.py:182: in delete_session
    deleted = await self._service.delete_session(session_id)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <dawn_kestrel.core.services.session_service.DefaultSessionService object at 0x112438d90>
session_id = 'nonexistent'

    async def delete_session(self, session_id: str) -> bool:
        """Delete a session using injected handlers.
    
        Args:
            session_id: The session ID to delete.
    
        Returns:
            True if deleted, False if not found.
    
        Raises:
            SessionError: If deletion fails.
        """
        try:
            if self._progress_handler:
                self._progress_handler.start("Deleting session", 100)
                self._progress_handler.update(50, f"Deleting {session_id}...")
    
            deleted = await self._manager.delete_session(session_id)
    
            if deleted:
                if self._progress_handler:
                    self._progress_handler.update(100, "Session deleted")
                    self._progress_handler.complete(f"Deleted session: {session_id}")
    
                if self._notification_handler:
                    self._notification_handler.show(Notification(
                        notification_type=NotificationType.SUCCESS,
                        message=f"Session {session_id} deleted",
                    ))
    
            return deleted
    
        except Exception as e:
>           raise SessionError(f"Failed to delete session: {e}") from e
E           dawn_kestrel.core.exceptions.SessionError: Failed to delete session: object Mock can't be used in 'await' expression

dawn_kestrel/core/services/session_service.py:251: SessionError
_____ TestOpenCodeAsyncClientSessionMethods.test_async_client_add_message ______

self = <dawn_kestrel.core.services.session_service.DefaultSessionService object at 0x112542310>
session_id = 'ses_001', role = 'user', text = 'Test message'

    async def add_message(self, session_id: str, role: str, text: str) -> str:
        """Add a message to a session using injected handlers.
    
        Args:
            session_id: The session ID.
            role: The message role (user, assistant, system).
            text: The message text.
    
        Returns:
            The created message ID.
    
        Raises:
            SessionError: If adding message fails.
        """
        try:
            if self._progress_handler:
                self._progress_handler.start("Adding message", 100)
                self._progress_handler.update(50, "Creating message...")
    
>           message_id = await self._manager.add_message(
                Message(
                    id="",
                    session_id=session_id,
                    role=role,
                    time={"created": 0},
                    text=text,
                )
            )

dawn_kestrel/core/services/session_service.py:272: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
dawn_kestrel/core/session.py:217: in add_message
    message_storage = MessageStorage(self.storage.base_dir)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
dawn_kestrel/storage/store.py:18: in __init__
    self.base_dir = Path(base_dir)
                    ^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/pathlib.py:871: in __new__
    self = cls._from_parts(args)
           ^^^^^^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/pathlib.py:509: in _from_parts
    drv, root, parts = self._parse_args(args)
                       ^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

cls = <class 'pathlib.PosixPath'>
args = (<Mock name='SessionStorage().base_dir' id='4602476560'>,)

    @classmethod
    def _parse_args(cls, args):
        # This is useful when you don't want to create an instance, just
        # canonicalize some constructor arguments.
        parts = []
        for a in args:
            if isinstance(a, PurePath):
                parts += a._parts
            else:
>               a = os.fspath(a)
                    ^^^^^^^^^^^^
E               TypeError: expected str, bytes or os.PathLike object, not Mock

../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/pathlib.py:493: TypeError

The above exception was the direct cause of the following exception:

self = <test_sdk_async_client.TestOpenCodeAsyncClientSessionMethods object at 0x1112b6010>
mock_storage_cls = <MagicMock name='SessionStorage' id='4642677200'>
mock_service_cls = <MagicMock name='DefaultSessionService' id='4642670352'>

    @patch("dawn_kestrel.core.services.session_service.DefaultSessionService")
    @patch("dawn_kestrel.sdk.client.SessionStorage")
    @pytest.mark.asyncio
    async def test_async_client_add_message(
        self, mock_storage_cls, mock_service_cls
    ) -> None:
        """Test OpenCodeAsyncClient.add_message() method."""
        mock_storage = Mock()
        mock_storage_cls.return_value = mock_storage
    
        mock_service = Mock()
        mock_service_cls.return_value = mock_service
    
        mock_service.add_message = AsyncMock(return_value="msg_001")
    
        client = OpenCodeAsyncClient()
>       result = await client.add_message(
            session_id="ses_001",
            role="user",
            content="Test message",
        )

tests/test_sdk_async_client.py:314: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
dawn_kestrel/sdk/client.py:209: in add_message
    message_id = await self._service.add_message(session_id, role, content)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <dawn_kestrel.core.services.session_service.DefaultSessionService object at 0x112542310>
session_id = 'ses_001', role = 'user', text = 'Test message'

    async def add_message(self, session_id: str, role: str, text: str) -> str:
        """Add a message to a session using injected handlers.
    
        Args:
            session_id: The session ID.
            role: The message role (user, assistant, system).
            text: The message text.
    
        Returns:
            The created message ID.
    
        Raises:
            SessionError: If adding message fails.
        """
        try:
            if self._progress_handler:
                self._progress_handler.start("Adding message", 100)
                self._progress_handler.update(50, "Creating message...")
    
            message_id = await self._manager.add_message(
                Message(
                    id="",
                    session_id=session_id,
                    role=role,
                    time={"created": 0},
                    text=text,
                )
            )
    
            if self._progress_handler:
                self._progress_handler.update(100, "Message added")
                self._progress_handler.complete(f"Added message to session {session_id}")
    
            if self._notification_handler:
                self._notification_handler.show(Notification(
                    notification_type=NotificationType.SUCCESS,
                    message=f"Message added to session {session_id}",
                ))
    
            return message_id
    
        except Exception as e:
>           raise SessionError(f"Failed to add message: {e}") from e
E           dawn_kestrel.core.exceptions.SessionError: Failed to add message: expected str, bytes or os.PathLike object, not Mock

dawn_kestrel/core/services/session_service.py:295: SessionError
_____ TestOpenCodeAsyncClientAgentMethods.test_async_client_register_agent _____

self = <test_sdk_async_client.TestOpenCodeAsyncClientAgentMethods object at 0x1112b6e10>
mock_storage_cls = <MagicMock name='DefaultSessionService' id='4642303632'>
mock_service_cls = <MagicMock name='SessionStorage' id='4642303888'>

    @patch("dawn_kestrel.sdk.client.SessionStorage")
    @patch("dawn_kestrel.sdk.client.DefaultSessionService")
    @pytest.mark.asyncio
    async def test_async_client_register_agent(
        self, mock_storage_cls, mock_service_cls
    ) -> None:
        """Test OpenCodeAsyncClient.register_agent() method."""
        mock_storage = Mock()
        mock_storage_cls.return_value = mock_storage
    
        mock_service = Mock()
        mock_service_cls.return_value = mock_service
    
        client = OpenCodeAsyncClient()
    
        custom_agent = Agent(
            name="test-agent",
            description="Test agent",
            mode="subagent",
            permission=[{"permission": "*", "pattern": "*", "action": "allow"}],
            native=False,
        )
    
        result = await client.register_agent(custom_agent)
    
        assert result == custom_agent
>       assert await client._runtime.get_agent("test-agent") == custom_agent
                     ^^^^^^^^^^^^^^^^^^^^^^^^^
E       AttributeError: 'AgentRuntime' object has no attribute 'get_agent'

tests/test_sdk_async_client.py:375: AttributeError
_____ TestOpenCodeAsyncClientAgentMethods.test_async_client_execute_agent ______

self = <Coroutine test_async_client_execute_agent>

    def runtest(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        runner = self._request.getfixturevalue(runner_fixture_id)
        context = contextvars.copy_context()
        synchronized_obj = _synchronize_coroutine(
            getattr(*self._synchronization_target_attr), runner, context
        )
        with MonkeyPatch.context() as c:
            c.setattr(*self._synchronization_target_attr, synchronized_obj)
>           super().runtest()

.venv/lib/python3.11/site-packages/pytest_asyncio/plugin.py:469: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.11/site-packages/pytest_asyncio/plugin.py:716: in inner
    runner.run(coro, context=context)
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/asyncio/base_events.py:654: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1392: in patched
    with self.decoration_helper(patched,
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1357: in decoration_helper
    arg = exit_stack.enter_context(patching)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/contextlib.py:517: in enter_context
    result = _enter(cm)
             ^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:1430: in __enter__
    self.target = self.getter()
                  ^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

name = 'dawn_kestrel.sdk.client.AgentRuntime'

    def resolve_name(name):
        """
        Resolve a name to an object.
    
        It is expected that `name` will be a string in one of the following
        formats, where W is shorthand for a valid Python identifier and dot stands
        for a literal period in these pseudo-regexes:
    
        W(.W)*
        W(.W)*:(W(.W)*)?
    
        The first form is intended for backward compatibility only. It assumes that
        some part of the dotted name is a package, and the rest is an object
        somewhere within that package, possibly nested inside other objects.
        Because the place where the package stops and the object hierarchy starts
        can't be inferred by inspection, repeated attempts to import must be done
        with this form.
    
        In the second form, the caller makes the division point clear through the
        provision of a single colon: the dotted name to the left of the colon is a
        package to be imported, and the dotted name to the right is the object
        hierarchy within that package. Only one import is needed in this form. If
        it ends with the colon, then a module object is returned.
    
        The function will return an object (which might be a module), or raise one
        of the following exceptions:
    
        ValueError - if `name` isn't in a recognised format
        ImportError - if an import failed when it shouldn't have
        AttributeError - if a failure occurred when traversing the object hierarchy
                         within the imported package to get to the desired object.
        """
        global _NAME_PATTERN
        if _NAME_PATTERN is None:
            # Lazy import to speedup Python startup time
            import re
            dotted_words = r'(?!\d)(\w+)(\.(?!\d)(\w+))*'
            _NAME_PATTERN = re.compile(f'^(?P<pkg>{dotted_words})'
                                       f'(?P<cln>:(?P<obj>{dotted_words})?)?$',
                                       re.UNICODE)
    
        m = _NAME_PATTERN.match(name)
        if not m:
            raise ValueError(f'invalid format: {name!r}')
        gd = m.groupdict()
        if gd.get('cln'):
            # there is a colon - a one-step import is all that's needed
            mod = importlib.import_module(gd['pkg'])
            parts = gd.get('obj')
            parts = parts.split('.') if parts else []
        else:
            # no colon - have to iterate to find the package boundary
            parts = name.split('.')
            modname = parts.pop(0)
            # first part *must* be a module/package.
            mod = importlib.import_module(modname)
            while parts:
                p = parts[0]
                s = f'{modname}.{p}'
                try:
                    mod = importlib.import_module(s)
                    parts.pop(0)
                    modname = s
                except ImportError:
                    break
        # if we reach this point, mod is the module, already imported, and
        # parts is the list of parts in the object hierarchy to be traversed, or
        # an empty list if just the module is wanted.
        result = mod
        for p in parts:
>           result = getattr(result, p)
                     ^^^^^^^^^^^^^^^^^^
E           AttributeError: module 'dawn_kestrel.sdk.client' has no attribute 'AgentRuntime'

../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/pkgutil.py:715: AttributeError
_ TestOpenCodeAsyncClientAgentMethods.test_async_client_execute_agent_with_options _

self = <dawn_kestrel.sdk.client.OpenCodeAsyncClient object at 0x114b01090>
agent_name = 'build', session_id = 'ses_001', user_message = 'Hello'
options = {'model': 'gpt-4', 'skills': ['test']}

    async def execute_agent(
        self,
        agent_name: str,
        session_id: str,
        user_message: str,
        options: Optional[Dict[str, Any]] = None,
    ) -> AgentResult:
        """Execute an agent for a user message.
    
        Args:
            agent_name: Name of agent to execute (e.g., "build", "plan", "explore")
            session_id: Session ID to execute in
            user_message: User's message or request
            options: Optional execution parameters:
                - skills: List[str] - Skill names to inject into system prompt
                - provider: str - Provider ID ("anthropic", "openai")
                - model: str - Model ID (overrides agent default)
    
        Returns:
            AgentResult with response text, parts, metadata, tools used, duration, error
    
        Raises:
            ValueError: If agent not found, session not found, or missing required data
            SessionError: If execution fails
    
        Example:
            >>> result = await client.execute_agent(
            ...     agent_name="build",
            ...     session_id="ses_123",
            ...     user_message="Create a new user model"
            ... )
            >>> print(f"Response: {result.response}")
            >>> print(f"Tools used: {result.tools_used}")
        """
        options = options or {}
    
        skills = options.get("skills", [])
        tools = create_builtin_registry()
    
        try:
>           return await self._runtime.execute_agent(
                agent_name=agent_name,
                session_id=session_id,
                user_message=user_message,
                session_manager=cast(SessionManagerLike, self._service),
                tools=tools,
                skills=skills,
                options=options,
            )

dawn_kestrel/sdk/client.py:306: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <dawn_kestrel.agents.runtime.AgentRuntime object at 0x114b037d0>
agent_name = 'build', session_id = 'ses_001', user_message = 'Hello'
session_manager = <Mock name='DefaultSessionService()' id='4601356304'>
tools = <dawn_kestrel.tools.framework.ToolRegistry object at 0x114b01390>
skills = ['test'], options = {'model': 'gpt-4', 'skills': ['test']}
task_id = None, session_lifecycle = None

    async def execute_agent(
        self,
        agent_name: str,
        session_id: str,
        user_message: str,
        session_manager: SessionManagerLike,
        tools: Optional[ToolRegistry],
        skills: List[str],
        options: Optional[Dict[str, Any]] = None,
        task_id: Optional[str] = None,
        session_lifecycle: Optional[SessionLifecycle] = None,
    ) -> AgentResult:
        """Execute an agent with tool filtering and lifecycle management."""
        start_time = time.time()
        options = options or {}
    
        # Step 1: Fetch agent from AgentRegistry
        agent = self.agent_registry.get_agent(agent_name)
        if not agent:
            await bus.publish(Events.AGENT_ERROR, {
                "session_id": session_id,
                "agent_name": agent_name,
                "error": f"Agent not found: {agent_name}"
            })
            raise ValueError(f"Agent not found: {agent_name}")
    
        # Step 2: Load session from SessionManager
>       session = await session_manager.get_session(session_id)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: object Mock can't be used in 'await' expression

dawn_kestrel/agents/runtime.py:76: TypeError

The above exception was the direct cause of the following exception:

self = <test_sdk_async_client.TestOpenCodeAsyncClientAgentMethods object at 0x1112c0410>
mock_storage_cls = <MagicMock name='DefaultSessionService' id='4601349072'>
mock_service_cls = <MagicMock name='SessionStorage' id='4601357392'>

    @patch("dawn_kestrel.sdk.client.SessionStorage")
    @patch("dawn_kestrel.sdk.client.DefaultSessionService")
    @pytest.mark.asyncio
    async def test_async_client_execute_agent_with_options(
        self, mock_storage_cls, mock_service_cls
    ) -> None:
        """Test OpenCodeAsyncClient.execute_agent() with options."""
        mock_storage = Mock()
        mock_storage_cls.return_value = mock_storage
    
        mock_service = Mock()
        mock_service_cls.return_value = mock_service
    
        session = Session(
            id="ses_001",
            title="Test Session",
            slug="test-session",
            project_id="test-project",
            directory="/test",
            time_created=1234567890,
            version="1.0.0",
        )
        mock_service.get_session = AsyncMock(return_value=session)
    
        client = OpenCodeAsyncClient()
    
>       result = await client.execute_agent(
            agent_name="build",
            session_id="ses_001",
            user_message="Hello",
            options={"skills": ["test"], "model": "gpt-4"},
        )

tests/test_sdk_async_client.py:524: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <dawn_kestrel.sdk.client.OpenCodeAsyncClient object at 0x114b01090>
agent_name = 'build', session_id = 'ses_001', user_message = 'Hello'
options = {'model': 'gpt-4', 'skills': ['test']}

    async def execute_agent(
        self,
        agent_name: str,
        session_id: str,
        user_message: str,
        options: Optional[Dict[str, Any]] = None,
    ) -> AgentResult:
        """Execute an agent for a user message.
    
        Args:
            agent_name: Name of agent to execute (e.g., "build", "plan", "explore")
            session_id: Session ID to execute in
            user_message: User's message or request
            options: Optional execution parameters:
                - skills: List[str] - Skill names to inject into system prompt
                - provider: str - Provider ID ("anthropic", "openai")
                - model: str - Model ID (overrides agent default)
    
        Returns:
            AgentResult with response text, parts, metadata, tools used, duration, error
    
        Raises:
            ValueError: If agent not found, session not found, or missing required data
            SessionError: If execution fails
    
        Example:
            >>> result = await client.execute_agent(
            ...     agent_name="build",
            ...     session_id="ses_123",
            ...     user_message="Create a new user model"
            ... )
            >>> print(f"Response: {result.response}")
            >>> print(f"Tools used: {result.tools_used}")
        """
        options = options or {}
    
        skills = options.get("skills", [])
        tools = create_builtin_registry()
    
        try:
            return await self._runtime.execute_agent(
                agent_name=agent_name,
                session_id=session_id,
                user_message=user_message,
                session_manager=cast(SessionManagerLike, self._service),
                tools=tools,
                skills=skills,
                options=options,
            )
        except ValueError:
            raise
        except Exception as e:
>           raise SessionError(f"Failed to execute agent: {e}") from e
E           dawn_kestrel.core.exceptions.SessionError: Failed to execute agent: object Mock can't be used in 'await' expression

dawn_kestrel/sdk/client.py:318: SessionError
___ TestOpenCodeClientInitialization.test_sync_client_initialization_default ___

self = <test_sdk_sync_client.TestOpenCodeClientInitialization object at 0x1112d3490>
mock_storage_cls = <MagicMock name='DefaultSessionService' id='4659223504'>
mock_service_cls = <MagicMock name='SessionStorage' id='4659230608'>

    @patch("dawn_kestrel.sdk.client.SessionStorage")
    @patch("dawn_kestrel.sdk.client.DefaultSessionService")
    def test_sync_client_initialization_default(
        self, mock_storage_cls, mock_service_cls
    ) -> None:
        """Test OpenCodeSyncClient initialization with default config."""
        from dawn_kestrel.core.config import SDKConfig
    
        mock_storage = Mock()
        mock_storage_cls.return_value = mock_storage
    
        mock_service = Mock()
        mock_service_cls.return_value = mock_service
    
        client = OpenCodeSyncClient()
    
        assert client is not None
>       assert client._async_client == mock_service
E       AssertionError: assert <dawn_kestrel.sdk.client.OpenCodeAsyncClient object at 0x115c0c110> == <Mock name='SessionStorage()' id='4659219984'>
E        +  where <dawn_kestrel.sdk.client.OpenCodeAsyncClient object at 0x115c0c110> = <dawn_kestrel.sdk.client.OpenCodeSyncClient object at 0x115c0fd10>._async_client

tests/test_sdk_sync_client.py:31: AssertionError
_ TestOpenCodeClientInitialization.test_sync_client_initialization_with_sdk_config _

self = <test_sdk_sync_client.TestOpenCodeClientInitialization object at 0x1112c0390>
mock_storage_cls = <MagicMock name='DefaultSessionService' id='4645185552'>
mock_service_cls = <MagicMock name='SessionStorage' id='4645186320'>

    @patch("dawn_kestrel.sdk.client.SessionStorage")
    @patch("dawn_kestrel.sdk.client.DefaultSessionService")
    def test_sync_client_initialization_with_sdk_config(
        self, mock_storage_cls, mock_service_cls
    ) -> None:
        """Test OpenCodeSyncClient initialization with SDKConfig."""
        from dawn_kestrel.core.config import SDKConfig
    
        mock_storage = Mock()
        mock_storage_cls.return_value = mock_storage
    
        mock_service = Mock()
        mock_service_cls.return_value = mock_service
    
        config = SDKConfig(auto_confirm=True)
        client = OpenCodeSyncClient(config=config)
    
        assert client is not None
>       assert client._async_client == mock_service
E       AssertionError: assert <dawn_kestrel.sdk.client.OpenCodeAsyncClient object at 0x114dfd290> == <Mock name='SessionStorage()' id='4645189968'>
E        +  where <dawn_kestrel.sdk.client.OpenCodeAsyncClient object at 0x114dfd290> = <dawn_kestrel.sdk.client.OpenCodeSyncClient object at 0x114dff2d0>._async_client

tests/test_sdk_sync_client.py:53: AssertionError
_ TestOpenCodeClientInitialization.test_sync_client_initialization_with_handlers _

self = <test_sdk_sync_client.TestOpenCodeClientInitialization object at 0x1112d39d0>
mock_storage_cls = <MagicMock name='DefaultSessionService' id='4641585296'>
mock_service_cls = <MagicMock name='SessionStorage' id='4641573008'>

    @patch("dawn_kestrel.sdk.client.SessionStorage")
    @patch("dawn_kestrel.sdk.client.DefaultSessionService")
    def test_sync_client_initialization_with_handlers(
        self, mock_storage_cls, mock_service_cls
    ) -> None:
        """Test OpenCodeSyncClient initialization with custom handlers."""
        from dawn_kestrel.interfaces.io import QuietIOHandler, NoOpProgressHandler, NoOpNotificationHandler
    
        mock_storage = Mock()
        mock_storage_cls.return_value = mock_storage
    
        mock_service = Mock()
        mock_service_cls.return_value = mock_service
    
        io_handler = QuietIOHandler()
        progress_handler = NoOpProgressHandler()
        notification_handler = NoOpNotificationHandler()
    
        client = OpenCodeSyncClient(
            io_handler=io_handler,
            progress_handler=progress_handler,
            notification_handler=notification_handler,
        )
    
        assert client is not None
>       assert client._async_client == mock_service
E       AssertionError: assert <dawn_kestrel.sdk.client.OpenCodeAsyncClient object at 0x114a8e890> == <Mock name='SessionStorage()' id='4641574352'>
E        +  where <dawn_kestrel.sdk.client.OpenCodeAsyncClient object at 0x114a8e890> = <dawn_kestrel.sdk.client.OpenCodeSyncClient object at 0x114a8e210>._async_client

tests/test_sdk_sync_client.py:82: AssertionError
______ TestOpenCodeClientCallbacks.test_on_progress_callback_registration ______

self = <test_sdk_sync_client.TestOpenCodeClientCallbacks object at 0x1112d8090>
mock_storage_cls = <MagicMock name='DefaultSessionService' id='4601308816'>
mock_service_cls = <MagicMock name='SessionStorage' id='4644257936'>

    @patch("dawn_kestrel.sdk.client.SessionStorage")
    @patch("dawn_kestrel.sdk.client.DefaultSessionService")
    def test_on_progress_callback_registration(
        self, mock_storage_cls, mock_service_cls
    ) -> None:
        """Test progress callback registration."""
        mock_storage = Mock()
        mock_storage_cls.return_value = mock_storage
    
        mock_service = Mock()
        mock_service_cls.return_value = mock_service
    
        client = OpenCodeSyncClient()
    
        progress_callback = Mock()
        client.on_progress(progress_callback)
    
>       assert client._on_progress == progress_callback
               ^^^^^^^^^^^^^^^^^^^
E       AttributeError: 'OpenCodeSyncClient' object has no attribute '_on_progress'

tests/test_sdk_sync_client.py:107: AttributeError
____ TestOpenCodeClientCallbacks.test_on_notification_callback_registration ____

self = <test_sdk_sync_client.TestOpenCodeClientCallbacks object at 0x1112d8490>
mock_storage_cls = <MagicMock name='DefaultSessionService' id='4601884880'>
mock_service_cls = <MagicMock name='SessionStorage' id='4659221008'>

    @patch("dawn_kestrel.sdk.client.SessionStorage")
    @patch("dawn_kestrel.sdk.client.DefaultSessionService")
    def test_on_notification_callback_registration(
        self, mock_storage_cls, mock_service_cls
    ) -> None:
        """Test notification callback registration."""
        from dawn_kestrel.interfaces.io import Notification
    
        mock_storage = Mock()
        mock_storage_cls.return_value = mock_storage
    
        mock_service = Mock()
        mock_service_cls.return_value = mock_service
    
        client = OpenCodeSyncClient()
    
        notification_callback = Mock()
        client.on_notification(notification_callback)
    
>       assert client._on_notification == notification_callback
               ^^^^^^^^^^^^^^^^^^^^^^^
E       AttributeError: 'OpenCodeSyncClient' object has no attribute '_on_notification'

tests/test_sdk_sync_client.py:128: AttributeError
_______ TestOpenCodeClientSessionMethods.test_sync_client_create_session _______

self = <dawn_kestrel.sdk.client.OpenCodeAsyncClient object at 0x115c0e910>
title = 'Test Session', version = '1.0.0'

    async def create_session(
        self,
        title: str,
        version: str = "1.0.0",
    ) -> Session:
        """Create a new session.
    
        Args:
            title: Session title.
            version: Session version.
    
        Returns:
            Created Session object.
    
        Raises:
            SessionError: If session creation fails.
        """
        try:
>           session = await self._service.create_session(title)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E           TypeError: object Mock can't be used in 'await' expression

dawn_kestrel/sdk/client.py:125: TypeError

The above exception was the direct cause of the following exception:

self = <test_sdk_sync_client.TestOpenCodeClientSessionMethods object at 0x1112d8b10>
mock_storage_cls = <MagicMock name='DefaultSessionService' id='4599974544'>
mock_service_cls = <MagicMock name='SessionStorage' id='4602475600'>

    @patch("dawn_kestrel.sdk.client.SessionStorage")
    @patch("dawn_kestrel.sdk.client.DefaultSessionService")
    def test_sync_client_create_session(
        self, mock_storage_cls, mock_service_cls
    ) -> None:
        """Test OpenCodeSyncClient.create_session() method."""
        mock_storage = Mock()
        mock_storage_cls.return_value = mock_storage
    
        mock_service = Mock()
        mock_service_cls.return_value = mock_service
    
        session = Session(
            id="ses_001",
            title="Test Session",
            slug="test-session",
            project_id="test-project",
            directory="/test",
            time_created=1234567890,
            version="1.0.0",
        )
        mock_service.create_session = AsyncMock(return_value=session)
    
        client = OpenCodeSyncClient()
>       result = client.create_session(title="Test Session")
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_sdk_sync_client.py:158: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
dawn_kestrel/sdk/client.py:575: in create_session
    return asyncio.run(self._async_client.create_session(title, version))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/asyncio/runners.py:190: in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/asyncio/base_events.py:654: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <dawn_kestrel.sdk.client.OpenCodeAsyncClient object at 0x115c0e910>
title = 'Test Session', version = '1.0.0'

    async def create_session(
        self,
        title: str,
        version: str = "1.0.0",
    ) -> Session:
        """Create a new session.
    
        Args:
            title: Session title.
            version: Session version.
    
        Returns:
            Created Session object.
    
        Raises:
            SessionError: If session creation fails.
        """
        try:
            session = await self._service.create_session(title)
            return session
        except Exception as e:
            if isinstance(e, OpenCodeError):
                raise
>           raise SessionError(f"Failed to create session: {e}") from e
E           dawn_kestrel.core.exceptions.SessionError: Failed to create session: object Mock can't be used in 'await' expression

dawn_kestrel/sdk/client.py:130: SessionError
________ TestOpenCodeClientSessionMethods.test_sync_client_get_session _________

self = <dawn_kestrel.sdk.client.OpenCodeAsyncClient object at 0x114d657d0>
session_id = 'ses_001'

    async def get_session(self, session_id: str) -> Optional[Session]:
        """Get a session by ID.
    
        Args:
            session_id: Session ID to retrieve.
    
        Returns:
            Session object or None if not found.
    
        Raises:
            SessionError: If retrieval fails.
        """
        try:
>           session = await self._service.get_session(session_id)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E           TypeError: object Mock can't be used in 'await' expression

dawn_kestrel/sdk/client.py:145: TypeError

The above exception was the direct cause of the following exception:

self = <test_sdk_sync_client.TestOpenCodeClientSessionMethods object at 0x1112d8f10>
mock_storage_cls = <MagicMock name='DefaultSessionService' id='4582687376'>
mock_service_cls = <MagicMock name='SessionStorage' id='4644820112'>

    @patch("dawn_kestrel.sdk.client.SessionStorage")
    @patch("dawn_kestrel.sdk.client.DefaultSessionService")
    def test_sync_client_get_session(
        self, mock_storage_cls, mock_service_cls
    ) -> None:
        """Test OpenCodeSyncClient.get_session() method."""
        mock_storage = Mock()
        mock_storage_cls.return_value = mock_storage
    
        mock_service = Mock()
        mock_service_cls.return_value = mock_service
    
        session = Session(
            id="ses_001",
            title="Test Session",
            slug="test-session",
            project_id="test-project",
            directory="/test",
            time_created=1234567890,
            version="1.0.0",
        )
        mock_service.get_session = AsyncMock(return_value=session)
    
        client = OpenCodeSyncClient()
>       result = client.get_session(session_id="ses_001")
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_sdk_sync_client.py:187: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
dawn_kestrel/sdk/client.py:592: in get_session
    return asyncio.run(self._async_client.get_session(session_id))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/asyncio/runners.py:190: in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/asyncio/base_events.py:654: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <dawn_kestrel.sdk.client.OpenCodeAsyncClient object at 0x114d657d0>
session_id = 'ses_001'

    async def get_session(self, session_id: str) -> Optional[Session]:
        """Get a session by ID.
    
        Args:
            session_id: Session ID to retrieve.
    
        Returns:
            Session object or None if not found.
    
        Raises:
            SessionError: If retrieval fails.
        """
        try:
            session = await self._service.get_session(session_id)
            return session
        except Exception as e:
            if isinstance(e, OpenCodeError):
                raise
>           raise SessionError(f"Failed to get session: {e}") from e
E           dawn_kestrel.core.exceptions.SessionError: Failed to get session: object Mock can't be used in 'await' expression

dawn_kestrel/sdk/client.py:150: SessionError
___ TestOpenCodeClientSessionMethods.test_sync_client_get_session_not_found ____

self = <dawn_kestrel.sdk.client.OpenCodeAsyncClient object at 0x114dadc10>
session_id = 'nonexistent'

    async def get_session(self, session_id: str) -> Optional[Session]:
        """Get a session by ID.
    
        Args:
            session_id: Session ID to retrieve.
    
        Returns:
            Session object or None if not found.
    
        Raises:
            SessionError: If retrieval fails.
        """
        try:
>           session = await self._service.get_session(session_id)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E           TypeError: object Mock can't be used in 'await' expression

dawn_kestrel/sdk/client.py:145: TypeError

The above exception was the direct cause of the following exception:

self = <test_sdk_sync_client.TestOpenCodeClientSessionMethods object at 0x1112d9390>
mock_storage_cls = <MagicMock name='DefaultSessionService' id='4601170576'>
mock_service_cls = <MagicMock name='SessionStorage' id='4641975184'>

    @patch("dawn_kestrel.sdk.client.SessionStorage")
    @patch("dawn_kestrel.sdk.client.DefaultSessionService")
    def test_sync_client_get_session_not_found(
        self, mock_storage_cls, mock_service_cls
    ) -> None:
        """Test OpenCodeSyncClient.get_session() when session not found."""
        mock_storage = Mock()
        mock_storage_cls.return_value = mock_storage
    
        mock_service = Mock()
        mock_service_cls.return_value = mock_service
    
        mock_service.get_session = AsyncMock(return_value=None)
    
        client = OpenCodeSyncClient()
>       result = client.get_session(session_id="nonexistent")
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_sdk_sync_client.py:207: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
dawn_kestrel/sdk/client.py:592: in get_session
    return asyncio.run(self._async_client.get_session(session_id))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/asyncio/runners.py:190: in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/asyncio/base_events.py:654: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <dawn_kestrel.sdk.client.OpenCodeAsyncClient object at 0x114dadc10>
session_id = 'nonexistent'

    async def get_session(self, session_id: str) -> Optional[Session]:
        """Get a session by ID.
    
        Args:
            session_id: Session ID to retrieve.
    
        Returns:
            Session object or None if not found.
    
        Raises:
            SessionError: If retrieval fails.
        """
        try:
            session = await self._service.get_session(session_id)
            return session
        except Exception as e:
            if isinstance(e, OpenCodeError):
                raise
>           raise SessionError(f"Failed to get session: {e}") from e
E           dawn_kestrel.core.exceptions.SessionError: Failed to get session: object Mock can't be used in 'await' expression

dawn_kestrel/sdk/client.py:150: SessionError
_______ TestOpenCodeClientSessionMethods.test_sync_client_list_sessions ________

self = <dawn_kestrel.sdk.client.OpenCodeAsyncClient object at 0x115c0fdd0>

    async def list_sessions(self) -> list[Session]:
        """List all sessions.
    
        Returns:
            List of Session objects.
    
        Raises:
            SessionError: If listing fails.
        """
        try:
>           sessions = await self._service.list_sessions()
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E           TypeError: object Mock can't be used in 'await' expression

dawn_kestrel/sdk/client.py:162: TypeError

The above exception was the direct cause of the following exception:

self = <test_sdk_sync_client.TestOpenCodeClientSessionMethods object at 0x1112d9a10>
mock_storage_cls = <MagicMock name='DefaultSessionService' id='4601360848'>
mock_service_cls = <MagicMock name='SessionStorage' id='4642049552'>

    @patch("dawn_kestrel.sdk.client.SessionStorage")
    @patch("dawn_kestrel.sdk.client.DefaultSessionService")
    def test_sync_client_list_sessions(
        self, mock_storage_cls, mock_service_cls
    ) -> None:
        """Test OpenCodeSyncClient.list_sessions() method."""
        mock_storage = Mock()
        mock_storage_cls.return_value = mock_storage
    
        mock_service = Mock()
        mock_service_cls.return_value = mock_service
    
        session1 = Session(
            id="ses_001",
            title="Test Session 1",
            slug="test-session-1",
            project_id="test-project",
            directory="/test",
            time_created=1234567890,
            version="1.0.0",
        )
        session2 = Session(
            id="ses_002",
            title="Test Session 2",
            slug="test-session-2",
            project_id="test-project",
            directory="/test",
            time_created=1234567900,
            version="1.0.0",
        )
        mock_service.list_sessions = AsyncMock(return_value=[session1, session2])
    
        client = OpenCodeSyncClient()
>       result = client.list_sessions()
                 ^^^^^^^^^^^^^^^^^^^^^^

tests/test_sdk_sync_client.py:245: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
dawn_kestrel/sdk/client.py:606: in list_sessions
    return asyncio.run(self._async_client.list_sessions())
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/asyncio/runners.py:190: in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/asyncio/base_events.py:654: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <dawn_kestrel.sdk.client.OpenCodeAsyncClient object at 0x115c0fdd0>

    async def list_sessions(self) -> list[Session]:
        """List all sessions.
    
        Returns:
            List of Session objects.
    
        Raises:
            SessionError: If listing fails.
        """
        try:
            sessions = await self._service.list_sessions()
            return sessions
        except Exception as e:
            if isinstance(e, OpenCodeError):
                raise
>           raise SessionError(f"Failed to list sessions: {e}") from e
E           dawn_kestrel.core.exceptions.SessionError: Failed to list sessions: object Mock can't be used in 'await' expression

dawn_kestrel/sdk/client.py:167: SessionError
_______ TestOpenCodeClientSessionMethods.test_sync_client_delete_session _______

self = <dawn_kestrel.sdk.client.OpenCodeAsyncClient object at 0x115c20810>
session_id = 'ses_001'

    async def delete_session(self, session_id: str) -> bool:
        """Delete a session by ID.
    
        Args:
            session_id: Session ID to delete.
    
        Returns:
            True if deleted, False if not found.
    
        Raises:
            SessionError: If deletion fails.
        """
        try:
>           deleted = await self._service.delete_session(session_id)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E           TypeError: object Mock can't be used in 'await' expression

dawn_kestrel/sdk/client.py:182: TypeError

The above exception was the direct cause of the following exception:

self = <test_sdk_sync_client.TestOpenCodeClientSessionMethods object at 0x1112da050>
mock_storage_cls = <MagicMock name='DefaultSessionService' id='4644734416'>
mock_service_cls = <MagicMock name='SessionStorage' id='4644733520'>

    @patch("dawn_kestrel.sdk.client.SessionStorage")
    @patch("dawn_kestrel.sdk.client.DefaultSessionService")
    def test_sync_client_delete_session(
        self, mock_storage_cls, mock_service_cls
    ) -> None:
        """Test OpenCodeSyncClient.delete_session() method."""
        mock_storage = Mock()
        mock_storage_cls.return_value = mock_storage
    
        mock_service = Mock()
        mock_service_cls.return_value = mock_service
    
        mock_service.delete_session = AsyncMock(return_value=True)
    
        client = OpenCodeSyncClient()
>       result = client.delete_session(session_id="ses_001")
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_sdk_sync_client.py:265: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
dawn_kestrel/sdk/client.py:623: in delete_session
    return asyncio.run(self._async_client.delete_session(session_id))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/asyncio/runners.py:190: in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/asyncio/base_events.py:654: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <dawn_kestrel.sdk.client.OpenCodeAsyncClient object at 0x115c20810>
session_id = 'ses_001'

    async def delete_session(self, session_id: str) -> bool:
        """Delete a session by ID.
    
        Args:
            session_id: Session ID to delete.
    
        Returns:
            True if deleted, False if not found.
    
        Raises:
            SessionError: If deletion fails.
        """
        try:
            deleted = await self._service.delete_session(session_id)
            return deleted
        except Exception as e:
            if isinstance(e, OpenCodeError):
                raise
>           raise SessionError(f"Failed to delete session: {e}") from e
E           dawn_kestrel.core.exceptions.SessionError: Failed to delete session: object Mock can't be used in 'await' expression

dawn_kestrel/sdk/client.py:187: SessionError
__ TestOpenCodeClientSessionMethods.test_sync_client_delete_session_not_found __

self = <dawn_kestrel.sdk.client.OpenCodeAsyncClient object at 0x115b60790>
session_id = 'nonexistent'

    async def delete_session(self, session_id: str) -> bool:
        """Delete a session by ID.
    
        Args:
            session_id: Session ID to delete.
    
        Returns:
            True if deleted, False if not found.
    
        Raises:
            SessionError: If deletion fails.
        """
        try:
>           deleted = await self._service.delete_session(session_id)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E           TypeError: object Mock can't be used in 'await' expression

dawn_kestrel/sdk/client.py:182: TypeError

The above exception was the direct cause of the following exception:

self = <test_sdk_sync_client.TestOpenCodeClientSessionMethods object at 0x1112da690>
mock_storage_cls = <MagicMock name='DefaultSessionService' id='4644719056'>
mock_service_cls = <MagicMock name='SessionStorage' id='4644718672'>

    @patch("dawn_kestrel.sdk.client.SessionStorage")
    @patch("dawn_kestrel.sdk.client.DefaultSessionService")
    def test_sync_client_delete_session_not_found(
        self, mock_storage_cls, mock_service_cls
    ) -> None:
        """Test OpenCodeSyncClient.delete_session() when session not found."""
        mock_storage = Mock()
        mock_storage_cls.return_value = mock_storage
    
        mock_service = Mock()
        mock_service_cls.return_value = mock_service
    
        mock_service.delete_session = AsyncMock(return_value=False)
    
        client = OpenCodeSyncClient()
>       result = client.delete_session(session_id="nonexistent")
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_sdk_sync_client.py:285: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
dawn_kestrel/sdk/client.py:623: in delete_session
    return asyncio.run(self._async_client.delete_session(session_id))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/asyncio/runners.py:190: in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/asyncio/base_events.py:654: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <dawn_kestrel.sdk.client.OpenCodeAsyncClient object at 0x115b60790>
session_id = 'nonexistent'

    async def delete_session(self, session_id: str) -> bool:
        """Delete a session by ID.
    
        Args:
            session_id: Session ID to delete.
    
        Returns:
            True if deleted, False if not found.
    
        Raises:
            SessionError: If deletion fails.
        """
        try:
            deleted = await self._service.delete_session(session_id)
            return deleted
        except Exception as e:
            if isinstance(e, OpenCodeError):
                raise
>           raise SessionError(f"Failed to delete session: {e}") from e
E           dawn_kestrel.core.exceptions.SessionError: Failed to delete session: object Mock can't be used in 'await' expression

dawn_kestrel/sdk/client.py:187: SessionError
________ TestOpenCodeClientSessionMethods.test_sync_client_add_message _________

self = <dawn_kestrel.sdk.client.OpenCodeAsyncClient object at 0x114a8e410>
session_id = 'ses_001', role = 'user', content = 'Test message'

    async def add_message(
        self,
        session_id: str,
        role: str,
        content: str,
    ) -> str:
        """Add a message to a session.
    
        Args:
            session_id: Session ID.
            role: Message role (user, assistant, system).
            content: Message content.
    
        Returns:
            Created message ID.
    
        Raises:
            SessionError: If adding message fails.
        """
        try:
>           message_id = await self._service.add_message(session_id, role, content)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E           TypeError: object Mock can't be used in 'await' expression

dawn_kestrel/sdk/client.py:209: TypeError

The above exception was the direct cause of the following exception:

self = <test_sdk_sync_client.TestOpenCodeClientSessionMethods object at 0x1112dacd0>
mock_storage_cls = <MagicMock name='DefaultSessionService' id='4641144272'>
mock_service_cls = <MagicMock name='SessionStorage' id='4641142288'>

    @patch("dawn_kestrel.sdk.client.SessionStorage")
    @patch("dawn_kestrel.sdk.client.DefaultSessionService")
    def test_sync_client_add_message(
        self, mock_storage_cls, mock_service_cls
    ) -> None:
        """Test OpenCodeSyncClient.add_message() method."""
        mock_storage = Mock()
        mock_storage_cls.return_value = mock_storage
    
        mock_service = Mock()
        mock_service_cls.return_value = mock_service
    
        mock_service.add_message = AsyncMock(return_value="msg_001")
    
        client = OpenCodeSyncClient()
>       result = client.add_message(
            session_id="ses_001",
            role="user",
            content="Test message",
        )

tests/test_sdk_sync_client.py:305: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
dawn_kestrel/sdk/client.py:642: in add_message
    return asyncio.run(self._async_client.add_message(session_id, role, content))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/asyncio/runners.py:190: in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/asyncio/base_events.py:654: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <dawn_kestrel.sdk.client.OpenCodeAsyncClient object at 0x114a8e410>
session_id = 'ses_001', role = 'user', content = 'Test message'

    async def add_message(
        self,
        session_id: str,
        role: str,
        content: str,
    ) -> str:
        """Add a message to a session.
    
        Args:
            session_id: Session ID.
            role: Message role (user, assistant, system).
            content: Message content.
    
        Returns:
            Created message ID.
    
        Raises:
            SessionError: If adding message fails.
        """
        try:
            message_id = await self._service.add_message(session_id, role, content)
            return message_id
        except Exception as e:
            if isinstance(e, OpenCodeError):
                raise
>           raise SessionError(f"Failed to add message: {e}") from e
E           dawn_kestrel.core.exceptions.SessionError: Failed to add message: object Mock can't be used in 'await' expression

dawn_kestrel/sdk/client.py:214: SessionError
______ TestOpenCodeClientSessionMethods.test_sync_client_uses_asyncio_run ______

self = <test_sdk_sync_client.TestOpenCodeClientSessionMethods object at 0x1112dba10>
mock_storage_cls = <MagicMock name='DefaultSessionService' id='4644184208'>
mock_service_cls = <MagicMock name='SessionStorage' id='4644183632'>

    @patch("dawn_kestrel.sdk.client.SessionStorage")
    @patch("dawn_kestrel.sdk.client.DefaultSessionService")
    def test_sync_client_uses_asyncio_run(
        self, mock_storage_cls, mock_service_cls
    ) -> None:
        """Test that sync client uses asyncio.run internally."""
        from dawn_kestrel.sdk.client import OpenCodeAsyncClient
        import asyncio
    
        mock_storage = Mock()
        mock_storage_cls.return_value = mock_storage
    
        async_client_mock = Mock(spec=OpenCodeAsyncClient)
        with patch('asyncio.run', return_value=async_client_mock.return_value):
            with patch('dawn_kestrel.sdk.client.OpenCodeAsyncClient', return_value=async_client_mock):
                client = OpenCodeSyncClient()
                client.create_session(title="Test")
    
>       asyncio.run.assert_called_once()
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       AttributeError: 'function' object has no attribute 'assert_called_once'

tests/test_sdk_sync_client.py:354: AttributeError
___ TestOpenCodeClientAsyncIntegration.test_sync_client_handler_integration ____

self = <test_sdk_sync_client.TestOpenCodeClientAsyncIntegration object at 0x1112dce10>
mock_storage_cls = <MagicMock name='DefaultSessionService' id='4644014864'>
mock_service_cls = <MagicMock name='SessionStorage' id='4644025168'>

    @patch("dawn_kestrel.sdk.client.SessionStorage")
    @patch("dawn_kestrel.sdk.client.DefaultSessionService")
    def test_sync_client_handler_integration(
        self, mock_storage_cls, mock_service_cls
    ) -> None:
        """Test OpenCodeSyncClient handler integration."""
        from dawn_kestrel.interfaces.io import QuietIOHandler, NoOpProgressHandler, NoOpNotificationHandler
    
        mock_storage = Mock()
        mock_storage_cls.return_value = mock_storage
    
        mock_service = Mock()
        mock_service_cls.return_value = mock_service
    
        io_handler = QuietIOHandler()
        progress_handler = NoOpProgressHandler()
        notification_handler = NoOpNotificationHandler()
    
        client = OpenCodeSyncClient(
            io_handler=io_handler,
            progress_handler=progress_handler,
            notification_handler=notification_handler,
        )
    
        assert client is not None
>       assert client._async_client == mock_service
E       AssertionError: assert <dawn_kestrel.sdk.client.OpenCodeAsyncClient object at 0x1122024d0> == <Mock name='SessionStorage()' id='4599057488'>
E        +  where <dawn_kestrel.sdk.client.OpenCodeAsyncClient object at 0x1122024d0> = <dawn_kestrel.sdk.client.OpenCodeSyncClient object at 0x112202d50>._async_client

tests/test_sdk_sync_client.py:413: AssertionError
_________ TestSettingsAccounts.test_accounts_field_default_empty_dict __________

self = <test_settings_accounts.TestSettingsAccounts object at 0x1112fa190>

    def test_accounts_field_default_empty_dict(self) -> None:
        """Test that accounts field defaults to empty dict."""
        settings = Settings()
>       assert settings.accounts == {}
E       AssertionError: assert {'default': A...default=True)} == {}
E         
E         Left contains 1 more item:
E         {'default': AccountConfig(account_name='default', provider_id=<ProviderID.Z_AI_CODING_PLAN: 'zai-coding-plan'>, api_key=SecretStr('**********'), model='glm-4.7', base_url=None, options={}, is_default=True)}
E         
E         Full diff:
E         - {}
E         + {
E         +     'default': AccountConfig(account_name='default', provider_id=<ProviderID.Z_AI_CODING_PLAN: 'zai-coding-plan'>, api_key=SecretStr('**********'), model='glm-4.7', base_url=None, options={}, is_default=True),
E         + }

tests/test_settings_accounts.py:36: AssertionError
________ TestSettingsAccounts.test_get_default_account_returns_default _________

self = <test_settings_accounts.TestSettingsAccounts object at 0x111411f10>

    def test_get_default_account_returns_default(self) -> None:
        """Test get_default_account returns account with is_default=True."""
        accounts: Dict[str, AccountConfig] = {
            "openai-1": AccountConfig(
                account_name="openai-1",
                provider_id=ProviderID.OPENAI,
                api_key=SecretStr("sk-key1-12345678901234567890"),
                model="gpt-4",
                is_default=False,
            ),
            "openai-default": AccountConfig(
                account_name="openai-default",
                provider_id=ProviderID.OPENAI,
                api_key=SecretStr("sk-key2-12345678901234567890"),
                model="gpt-4",
                is_default=True,
            ),
        }
        settings = Settings(accounts=accounts)
        result = settings.get_default_account()
        assert result is not None
>       assert result.account_name == "openai-default"
E       AssertionError: assert 'default' == 'openai-default'
E         
E         - openai-default
E         + default

tests/test_settings_accounts.py:123: AssertionError
_ TestSettingsAccounts.test_get_default_account_falls_back_to_provider_default _

self = <test_settings_accounts.TestSettingsAccounts object at 0x1114125d0>

    def test_get_default_account_falls_back_to_provider_default(self) -> None:
        """Test get_default_account falls back to provider_default account."""
        accounts: Dict[str, AccountConfig] = {
            "openai-1": AccountConfig(
                account_name="openai-1",
                provider_id=ProviderID.OPENAI,
                api_key=SecretStr("sk-key1-12345678901234567890"),
                model="gpt-4",
                is_default=False,
            ),
            "anthropic-1": AccountConfig(
                account_name="anthropic-1",
                provider_id=ProviderID.ANTHROPIC,
                api_key=SecretStr("sk-ant-key-12345678901234567890"),
                model="claude-3",
                is_default=False,
            ),
        }
        settings = Settings(accounts=accounts)
        settings.provider_default = ProviderID.ANTHROPIC.value
        result = settings.get_default_account()
        assert result is not None
>       assert result.account_name == "anthropic-1"
E       AssertionError: assert 'default' == 'anthropic-1'
E         
E         - anthropic-1
E         + default

tests/test_settings_accounts.py:148: AssertionError
______ TestSettingsAccounts.test_get_default_account_synthesizes_from_env ______

self = <test_settings_accounts.TestSettingsAccounts object at 0x111412cd0>
monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x114a8cb50>

    def test_get_default_account_synthesizes_from_env(
        self, monkeypatch: pytest.MonkeyPatch
    ) -> None:
        """Test get_default_account creates default account from env vars."""
        monkeypatch.setenv("OPENCODE_PYTHON_PROVIDER_DEFAULT", "openai")
        monkeypatch.setenv("OPENCODE_PYTHON_MODEL_DEFAULT", "gpt-4.1")
        monkeypatch.setenv("OPENCODE_PYTHON_OPENAI_API_KEY", "sk-fallback-key-12345678901234567890")
    
        settings = Settings()
        result = settings.get_default_account()
        assert result is not None
        assert result.account_name == "default"
>       assert result.provider_id == ProviderID.OPENAI
E       AssertionError: assert <ProviderID.Z...-coding-plan'> == <ProviderID.OPENAI: 'openai'>
E         
E         - openai
E         + zai-coding-plan

tests/test_settings_accounts.py:162: AssertionError
_ TestSettingsAccounts.test_get_default_account_prefers_dawn_prefix_env_over_legacy _

self = <test_settings_accounts.TestSettingsAccounts object at 0x111413310>
monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x1123203d0>

    def test_get_default_account_prefers_dawn_prefix_env_over_legacy(
        self, monkeypatch: pytest.MonkeyPatch
    ) -> None:
        """Test DAWN_KESTREL_* API key takes precedence over OPENCODE_PYTHON_* key."""
        monkeypatch.setenv("DAWN_KESTREL_PROVIDER_DEFAULT", "openai")
        monkeypatch.setenv("DAWN_KESTREL_MODEL_DEFAULT", "gpt-4.1-mini")
        monkeypatch.setenv("DAWN_KESTREL_OPENAI_API_KEY", "sk-dawn-priority-key-1234567890")
        monkeypatch.setenv("OPENCODE_PYTHON_PROVIDER_DEFAULT", "anthropic")
        monkeypatch.setenv("OPENCODE_PYTHON_MODEL_DEFAULT", "claude-legacy")
        monkeypatch.setenv("OPENCODE_PYTHON_OPENAI_API_KEY", "sk-legacy-key-1234567890")
    
        settings = Settings()
        result = settings.get_default_account()
    
        assert result is not None
>       assert result.provider_id == ProviderID.OPENAI
E       AssertionError: assert <ProviderID.Z...-coding-plan'> == <ProviderID.OPENAI: 'openai'>
E         
E         - openai
E         + zai-coding-plan

tests/test_settings_accounts.py:181: AssertionError
_____________ TestToolExecutionTracker.test_get_execution_history ______________

self = <test_tool_tracking.TestToolExecutionTracker object at 0x11143e250>
temp_dir = PosixPath('/var/folders/7q/3wffhx8n6j927vjvnwqb7fxm0000gp/T/tmpix5zypec')
sample_tool_state = ToolState(status='pending', input={'param': 'value'}, output=None, title=None, metadata={}, time_start=None, time_end=None, error=None)

    def test_get_execution_history(self, temp_dir, sample_tool_state):
        """Test retrieving execution history"""
        tracker = create_tool_tracker(temp_dir)
        session_id = "session-123"
    
        execution_id_1 = "exec-1"
        execution_id_2 = "exec-2"
    
        asyncio.run(tracker.log_execution(
            execution_id=execution_id_1,
            session_id=session_id,
            message_id="msg-1",
            tool_id="tool-1",
            state=sample_tool_state,
        ))
    
        asyncio.run(tracker.log_execution(
            execution_id=execution_id_2,
            session_id=session_id,
            message_id="msg-2",
            tool_id="tool-2",
            state=ToolState(
                status="completed",
                input={"param": "value"},
                output="result",
            ),
        ))
    
>       history = asyncio.run(tracker.get_execution_history(session_id))
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_tool_tracking.py:136: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/asyncio/runners.py:190: in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/asyncio/base_events.py:654: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <dawn_kestrel.agents.tool_execution_tracker.ToolExecutionTracker object at 0x115c0e0d0>
session_id = 'session-123', tool_id = None, limit = None

    async def get_execution_history(
        self,
        session_id: str,
        tool_id: Optional[str] = None,
        limit: Optional[int] = None,
    ) -> List[Dict[str, Any]]:
        """Get execution history for a session
    
        Args:
            session_id: Session identifier
            tool_id: Optional filter by specific tool
            limit: Optional maximum number of records to return
    
        Returns:
            List of execution records sorted by timestamp (newest first)
        """
        session_dir = self.storage_dir / session_id
        if not session_dir.exists():
            return []
    
        executions = []
        for execution_file in session_dir.glob("*.json"):
            try:
                with open(execution_file, "r") as f:
                    record = json.load(f)
    
                if tool_id and record.get("tool_id") != tool_id:
                    continue
    
                executions.append(record)
    
            except Exception as e:
                logger.warning(f"Failed to read execution file {execution_file}: {e}")
    
>       executions.sort(key=lambda x: x.get("start_time", 0), reverse=True)
E       TypeError: '<' not supported between instances of 'NoneType' and 'NoneType'

dawn_kestrel/agents/tool_execution_tracker.py:189: TypeError
________ TestToolExecutionTracker.test_get_execution_history_with_limit ________

self = <test_tool_tracking.TestToolExecutionTracker object at 0x11143f010>
temp_dir = PosixPath('/var/folders/7q/3wffhx8n6j927vjvnwqb7fxm0000gp/T/tmp3c2rkhe1')
sample_tool_state = ToolState(status='pending', input={'param': 'value'}, output=None, title=None, metadata={}, time_start=None, time_end=None, error=None)

    def test_get_execution_history_with_limit(self, temp_dir, sample_tool_state):
        """Test retrieving execution history with limit"""
        tracker = create_tool_tracker(temp_dir)
        session_id = "session-123"
    
        for i in range(5):
            asyncio.run(tracker.log_execution(
                execution_id=f"exec-{i}",
                session_id=session_id,
                message_id=f"msg-{i}",
                tool_id=f"tool-{i}",
                state=sample_tool_state,
            ))
    
>       history = asyncio.run(tracker.get_execution_history(session_id, limit=3))
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_tool_tracking.py:182: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/asyncio/runners.py:190: in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/asyncio/base_events.py:654: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <dawn_kestrel.agents.tool_execution_tracker.ToolExecutionTracker object at 0x114d78c90>
session_id = 'session-123', tool_id = None, limit = 3

    async def get_execution_history(
        self,
        session_id: str,
        tool_id: Optional[str] = None,
        limit: Optional[int] = None,
    ) -> List[Dict[str, Any]]:
        """Get execution history for a session
    
        Args:
            session_id: Session identifier
            tool_id: Optional filter by specific tool
            limit: Optional maximum number of records to return
    
        Returns:
            List of execution records sorted by timestamp (newest first)
        """
        session_dir = self.storage_dir / session_id
        if not session_dir.exists():
            return []
    
        executions = []
        for execution_file in session_dir.glob("*.json"):
            try:
                with open(execution_file, "r") as f:
                    record = json.load(f)
    
                if tool_id and record.get("tool_id") != tool_id:
                    continue
    
                executions.append(record)
    
            except Exception as e:
                logger.warning(f"Failed to read execution file {execution_file}: {e}")
    
>       executions.sort(key=lambda x: x.get("start_time", 0), reverse=True)
E       TypeError: '<' not supported between instances of 'NoneType' and 'NoneType'

dawn_kestrel/agents/tool_execution_tracker.py:189: TypeError
___________ TestToolExecutionTracker.test_update_execution_not_found ___________

self = <test_tool_tracking.TestToolExecutionTracker object at 0x11144c450>
temp_dir = PosixPath('/var/folders/7q/3wffhx8n6j927vjvnwqb7fxm0000gp/T/tmp0uurqask')

    def test_update_execution_not_found(self, temp_dir):
        """Test updating non-existent execution returns None"""
        tracker = create_tool_tracker(temp_dir)
    
        updated_state = ToolState(status="completed", input={}, output="result")
>       result = asyncio.run(tracker.update_execution(
            execution_id="non-existent",
            state=updated_state,
        ))

tests/test_tool_tracking.py:244: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/asyncio/runners.py:190: in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/asyncio/runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/asyncio/base_events.py:654: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
dawn_kestrel/agents/tool_execution_tracker.py:108: in update_execution
    session_dirs = [d for d in self.storage_dir.iterdir() if d.is_dir()]
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
dawn_kestrel/agents/tool_execution_tracker.py:108: in <listcomp>
    session_dirs = [d for d in self.storage_dir.iterdir() if d.is_dir()]
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = PosixPath('/var/folders/7q/3wffhx8n6j927vjvnwqb7fxm0000gp/T/tmp0uurqask/storage/tool_execution')

    def iterdir(self):
        """Iterate over the files in this directory.  Does not yield any
        result for the special paths '.' and '..'.
        """
>       for name in os.listdir(self):
                    ^^^^^^^^^^^^^^^^
E       FileNotFoundError: [Errno 2] No such file or directory: '/var/folders/7q/3wffhx8n6j927vjvnwqb7fxm0000gp/T/tmp0uurqask/storage/tool_execution'

../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/pathlib.py:931: FileNotFoundError
__________ TestSessionLifecycle.test_listener_protocol_message_added ___________

self = <test_tool_tracking.TestSessionLifecycle object at 0x111459a50>
sample_session = Session(id='test-session-id', slug='test-session', project_id='test-project', directory='/tmp/test', parent_id=None, t...pdated=1770613693.463836, time_compacting=None, time_archived=None, message_counter=0, message_count=0, total_cost=0.0)
sample_message = Message(id='test-message-id', session_id='test-session-id', role='user', time={'created': 0.0}, text='Test message', parts=[], summary=None, token_usage=None, metadata={})

    @pytest.mark.asyncio
    async def test_listener_protocol_message_added(self, sample_session, sample_message):
        """Test listener receives message added event"""
        lifecycle = SessionLifecycle()
    
        listener = Mock(spec=SessionLifecycleListener)
        listener.on_message_added = AsyncMock()
    
        message_data = sample_message.model_dump()
        await lifecycle.register_listener(listener)
        await lifecycle.emit_message_added(message_data)
    
>       listener.on_message_added.assert_called_once()

tests/test_tool_tracking.py:423: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <AsyncMock name='mock.on_message_added' id='4642771856'>

    def assert_called_once(self):
        """assert that the mock was called only once.
        """
        if not self.call_count == 1:
            msg = ("Expected '%s' to have been called once. Called %s times.%s"
                   % (self._mock_name or 'mock',
                      self.call_count,
                      self._calls_repr()))
>           raise AssertionError(msg)
E           AssertionError: Expected 'on_message_added' to have been called once. Called 0 times.

../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:918: AssertionError
------------------------------ Captured log call -------------------------------
ERROR    dawn_kestrel.core.session_lifecycle:session_lifecycle.py:442 Error in lifecycle listener on_message_added: 6 validation errors for Session
id
  Field required [type=missing, input_value={}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
slug
  Field required [type=missing, input_value={}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
project_id
  Field required [type=missing, input_value={}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
directory
  Field required [type=missing, input_value={}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
title
  Field required [type=missing, input_value={}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
version
  Field required [type=missing, input_value={}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
______________ TestSessionLifecycle.test_listener_error_handling _______________

self = <test_tool_tracking.TestSessionLifecycle object at 0x11145a290>

    @pytest.mark.asyncio
    async def test_listener_error_handling(self):
        """Test errors in listeners don't break emission"""
        lifecycle = SessionLifecycle()
    
        listener = Mock(spec=SessionLifecycleListener)
        listener.on_session_created = AsyncMock(side_effect=Exception("Test error"))
    
        await lifecycle.register_listener(listener)
        await lifecycle.emit_session_created({})
    
>       listener.on_session_created.assert_called_once()

tests/test_tool_tracking.py:438: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <AsyncMock name='mock.on_session_created' id='4644624656'>

    def assert_called_once(self):
        """assert that the mock was called only once.
        """
        if not self.call_count == 1:
            msg = ("Expected '%s' to have been called once. Called %s times.%s"
                   % (self._mock_name or 'mock',
                      self.call_count,
                      self._calls_repr()))
>           raise AssertionError(msg)
E           AssertionError: Expected 'on_session_created' to have been called once. Called 0 times.

../../../../.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:918: AssertionError
------------------------------ Captured log call -------------------------------
ERROR    dawn_kestrel.core.session_lifecycle:session_lifecycle.py:389 Error in lifecycle listener on_session_created: 6 validation errors for Session
id
  Field required [type=missing, input_value={}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
slug
  Field required [type=missing, input_value={}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
project_id
  Field required [type=missing, input_value={}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
directory
  Field required [type=missing, input_value={}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
title
  Field required [type=missing, input_value={}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
version
  Field required [type=missing, input_value={}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
_______ TestSessionLifecycle.test_event_bus_integration_session_created ________

self = <test_tool_tracking.TestSessionLifecycle object at 0x11145b310>
sample_session = Session(id='test-session-id', slug='test-session', project_id='test-project', directory='/tmp/test', parent_id=None, t...pdated=1770613693.545046, time_compacting=None, time_archived=None, message_counter=0, message_count=0, total_cost=0.0)

    @pytest.mark.asyncio
    async def test_event_bus_integration_session_created(self, sample_session):
        """Test session lifecycle events are published to event bus"""
        lifecycle = SessionLifecycle()
    
        with patch.object(bus, "publish", new_callable=AsyncMock()) as mock_publish:
>           await lifecycle.emit_session_created(sample_session.model_dump())

tests/test_tool_tracking.py:466: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <dawn_kestrel.core.session_lifecycle.SessionLifecycle object at 0x114de8410>
session_data = {'directory': '/tmp/test', 'id': 'test-session-id', 'message_count': 0, 'message_counter': 0, ...}

    async def emit_session_created(self, session_data: Dict[str, Any]) -> None:
        """
        Emit session creation event to all registered callbacks.
    
        Args:
            session_data: Session data dictionary.
        """
        for callback in self._on_session_created:
            try:
                if asyncio.iscoroutinefunction(callback):
                    await callback(session_data)
                else:
                    callback(session_data)
            except Exception as e:
                logger.error(f"Error in session_created callback: {e}")
    
        for listener in self._listeners:
            try:
                from dawn_kestrel.core.models import Session
                session = Session(**session_data)
                await listener.on_session_created(session)
            except Exception as e:
                logger.error(f"Error in lifecycle listener on_session_created: {e}")
    
>       await bus.publish(Events.SESSION_CREATED, {"session": session_data})
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: 'coroutine' object is not callable

dawn_kestrel/core/session_lifecycle.py:391: TypeError
________ TestSessionLifecycle.test_event_bus_integration_message_added _________

self = <test_tool_tracking.TestSessionLifecycle object at 0x11144f810>
sample_message = Message(id='test-message-id', session_id='test-session-id', role='user', time={'created': 0.0}, text='Test message', parts=[], summary=None, token_usage=None, metadata={})

    @pytest.mark.asyncio
    async def test_event_bus_integration_message_added(self, sample_message):
        """Test message lifecycle events are published to event bus"""
        lifecycle = SessionLifecycle()
    
        with patch.object(bus, "publish", new_callable=AsyncMock()) as mock_publish:
>           await lifecycle.emit_message_added(sample_message.model_dump())

tests/test_tool_tracking.py:479: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <dawn_kestrel.core.session_lifecycle.SessionLifecycle object at 0x115b60bd0>
message_data = {'id': 'test-message-id', 'metadata': {}, 'parts': [], 'role': 'user', ...}

    async def emit_message_added(self, message_data: Dict[str, Any]) -> None:
        """
        Emit message addition event to all registered callbacks.
    
        Args:
            message_data: Message data dictionary.
        """
        for callback in self._on_message_added:
            try:
                if asyncio.iscoroutinefunction(callback):
                    await callback(message_data)
                else:
                    callback(message_data)
            except Exception as e:
                logger.error(f"Error in message_added callback: {e}")
    
        for listener in self._listeners:
            try:
                from dawn_kestrel.core.models import Session, Message
                session = Session(**message_data.get("session", {}))
                message = Message(**message_data)
                await listener.on_message_added(session, message)
            except Exception as e:
                logger.error(f"Error in lifecycle listener on_message_added: {e}")
    
>       await bus.publish(Events.MESSAGE_CREATED, {"message": message_data})
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: 'coroutine' object is not callable

dawn_kestrel/core/session_lifecycle.py:444: TypeError
_______ TestSessionLifecycle.test_event_bus_integration_session_deleted ________

self = <test_tool_tracking.TestSessionLifecycle object at 0x11144d8d0>

    @pytest.mark.asyncio
    async def test_event_bus_integration_session_deleted(self):
        """Test session deleted event is published to event bus"""
        lifecycle = SessionLifecycle()
    
        session_id = "test-session-id"
        with patch.object(bus, "publish", new_callable=AsyncMock()) as mock_publish:
>           await lifecycle.emit_session_deleted(session_id)

tests/test_tool_tracking.py:493: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <dawn_kestrel.core.session_lifecycle.SessionLifecycle object at 0x114b9a110>
session_id = 'test-session-id'

    async def emit_session_deleted(self, session_id: str) -> None:
        """
        Emit session deletion event to all registered callbacks.
    
        Args:
            session_id: Session ID.
        """
        for callback in self._on_session_deleted:
            try:
                callback(session_id)
            except Exception as e:
                logger.error(f"Error in session_deleted callback: {e}")
    
        for listener in self._listeners:
            try:
                await listener.on_session_deleted(session_id)
            except Exception as e:
                logger.error(f"Error in lifecycle listener on_session_deleted: {e}")
    
>       await bus.publish(Events.SESSION_DELETED, {"session_id": session_id})
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: 'coroutine' object is not callable

dawn_kestrel/core/session_lifecycle.py:531: TypeError
=============================== warnings summary ===============================
tests/review/test_parity_baseline.py::TestMinimalFixture::test_minimal_fixture_output
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/.venv/lib/python3.11/site-packages/_pytest/python.py:170: PytestReturnNotNoneWarning: Test functions should return None, but tests/review/test_parity_baseline.py::TestMinimalFixture::test_minimal_fixture_output returned <class 'dawn_kestrel.agents.review.contracts.ReviewOutput'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

tests/test_config.py::TestSettingsDefaults::test_get_default_provider_with_default_account
tests/test_config.py::TestSettingsDefaults::test_get_default_model_with_default_account
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/.venv/lib/python3.11/site-packages/pydantic/main.py:250: UserWarning: API key is shorter than 32 characters (8 chars). This may be insecure or invalid.
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)

tests/test_config.py::TestSettingsDefaults::test_get_default_model_with_provider_param
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/.venv/lib/python3.11/site-packages/pydantic/main.py:250: UserWarning: API key is shorter than 32 characters (10 chars). This may be insecure or invalid.
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)

tests/test_config.py::TestSettingsPydanticValidation::test_secret_str_not_exposed_in_repr
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/.venv/lib/python3.11/site-packages/pydantic/main.py:250: UserWarning: API key is shorter than 32 characters (15 chars). This may be insecure or invalid.
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)

tests/test_multi_env_loading.py::TestMultiEnvLoading::test_loads_from_repo_env_only
tests/test_multi_env_loading.py::TestMultiEnvLoading::test_loads_from_both_envs
tests/test_multi_env_loading.py::TestMultiEnvLoading::test_env_vars_case_insensitive_for_prefix
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/.venv/lib/python3.11/site-packages/pydantic/main.py:250: UserWarning: API key is shorter than 32 characters (17 chars). This may be insecure or invalid.
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)

tests/test_multi_env_loading.py::TestMultiEnvLoading::test_loads_from_home_env_only
tests/test_multi_env_loading.py::TestMultiEnvLoading::test_loads_from_both_envs
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/.venv/lib/python3.11/site-packages/pydantic/main.py:250: UserWarning: API key is shorter than 32 characters (21 chars). This may be insecure or invalid.
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)

tests/test_multi_env_loading.py::TestMultiEnvLoading::test_home_env_overrides_repo_env_for_same_account
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/.venv/lib/python3.11/site-packages/pydantic/main.py:250: UserWarning: API key is shorter than 32 characters (20 chars). This may be insecure or invalid.
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)

tests/test_multi_env_loading.py::TestMultiEnvLoading::test_nested_env_vars_parse_correctly
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/.venv/lib/python3.11/site-packages/pydantic/main.py:250: UserWarning: API key is shorter than 32 characters (19 chars). This may be insecure or invalid.
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)

tests/test_multi_env_loading.py::TestMultiEnvLoading::test_invalid_provider_id_raises_validation_error
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/.venv/lib/python3.11/site-packages/pydantic/main.py:250: UserWarning: API key is shorter than 32 characters (12 chars). This may be insecure or invalid.
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)

tests/test_sdk_async_client.py::TestOpenCodeAsyncClientSessionMethods::test_async_client_get_session
tests/test_sdk_async_client.py::TestOpenCodeAsyncClientSessionMethods::test_async_client_get_session_not_found
tests/test_sdk_async_client.py::TestOpenCodeAsyncClientSessionMethods::test_async_client_list_sessions
tests/test_sdk_async_client.py::TestOpenCodeAsyncClientSessionMethods::test_async_client_delete_session
tests/test_sdk_async_client.py::TestOpenCodeAsyncClientSessionMethods::test_async_client_delete_session_not_found
tests/test_sdk_async_client.py::TestOpenCodeAsyncClientSessionMethods::test_async_client_add_message
tests/test_sdk_async_client.py::TestOpenCodeAsyncClientSessionMethods::test_async_client_exception_handling
tests/test_sdk_provider_integration.py::test_sdk_client_provider_methods
tests/test_sdk_provider_integration.py::test_sdk_client_lifecycle_methods
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/dawn_kestrel/sdk/client.py:68: DeprecationWarning: io_handler is required in version 0.2.0. Pass QuietIOHandler() for headless mode. Direct I/O will be deprecated in Phase 4.
    self._service = DefaultSessionService(

tests/test_sdk_async_client.py::TestOpenCodeAsyncClientSessionMethods::test_async_client_get_session
tests/test_sdk_async_client.py::TestOpenCodeAsyncClientSessionMethods::test_async_client_get_session_not_found
tests/test_sdk_async_client.py::TestOpenCodeAsyncClientSessionMethods::test_async_client_list_sessions
tests/test_sdk_async_client.py::TestOpenCodeAsyncClientSessionMethods::test_async_client_delete_session
tests/test_sdk_async_client.py::TestOpenCodeAsyncClientSessionMethods::test_async_client_delete_session_not_found
tests/test_sdk_async_client.py::TestOpenCodeAsyncClientSessionMethods::test_async_client_add_message
tests/test_sdk_async_client.py::TestOpenCodeAsyncClientSessionMethods::test_async_client_exception_handling
tests/test_sdk_provider_integration.py::test_sdk_client_provider_methods
tests/test_sdk_provider_integration.py::test_sdk_client_lifecycle_methods
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/dawn_kestrel/sdk/client.py:68: DeprecationWarning: progress_handler is required in version 0.2.0. Pass NoOpProgressHandler() for silent mode. Direct progress will be deprecated in Phase 4.
    self._service = DefaultSessionService(

tests/test_sdk_async_client.py::TestOpenCodeAsyncClientSessionMethods::test_async_client_get_session
tests/test_sdk_async_client.py::TestOpenCodeAsyncClientSessionMethods::test_async_client_get_session_not_found
tests/test_sdk_async_client.py::TestOpenCodeAsyncClientSessionMethods::test_async_client_list_sessions
tests/test_sdk_async_client.py::TestOpenCodeAsyncClientSessionMethods::test_async_client_delete_session
tests/test_sdk_async_client.py::TestOpenCodeAsyncClientSessionMethods::test_async_client_delete_session_not_found
tests/test_sdk_async_client.py::TestOpenCodeAsyncClientSessionMethods::test_async_client_add_message
tests/test_sdk_async_client.py::TestOpenCodeAsyncClientSessionMethods::test_async_client_exception_handling
tests/test_sdk_provider_integration.py::test_sdk_client_provider_methods
tests/test_sdk_provider_integration.py::test_sdk_client_lifecycle_methods
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/dawn_kestrel/sdk/client.py:68: DeprecationWarning: notification_handler is required in version 0.2.0. Pass NoOpNotificationHandler() for silent mode. Direct notifications will be deprecated in Phase 4.
    self._service = DefaultSessionService(

tests/test_session_service.py::TestDefaultSessionServiceInitialization::test_default_session_service_with_all_handlers_provided
  /Users/parkersligting/.local/share/uv/python/cpython-3.11.14-macos-aarch64-none/lib/python3.11/unittest/mock.py:2178: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
    def __init__(self, name, parent):
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/test_session_service.py::TestDefaultSessionServiceInitialization::test_default_session_service_with_no_handlers_uses_noop_defaults
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_session_service.py:128: DeprecationWarning: io_handler is required in version 0.2.0. Pass QuietIOHandler() for headless mode. Direct I/O will be deprecated in Phase 4.
    service = DefaultSessionService(

tests/test_session_service.py::TestDefaultSessionServiceInitialization::test_default_session_service_with_no_handlers_uses_noop_defaults
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_session_service.py:128: DeprecationWarning: progress_handler is required in version 0.2.0. Pass NoOpProgressHandler() for silent mode. Direct progress will be deprecated in Phase 4.
    service = DefaultSessionService(

tests/test_session_service.py::TestDefaultSessionServiceInitialization::test_default_session_service_with_no_handlers_uses_noop_defaults
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_session_service.py:128: DeprecationWarning: notification_handler is required in version 0.2.0. Pass NoOpNotificationHandler() for silent mode. Direct notifications will be deprecated in Phase 4.
    service = DefaultSessionService(

tests/test_session_service.py::TestDefaultSessionServiceListSessions::test_list_sessions_delegates_to_storage
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_session_service.py:155: DeprecationWarning: io_handler is required in version 0.2.0. Pass QuietIOHandler() for headless mode. Direct I/O will be deprecated in Phase 4.
    service = DefaultSessionService(

tests/test_session_service.py::TestDefaultSessionServiceListSessions::test_list_sessions_delegates_to_storage
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_session_service.py:155: DeprecationWarning: progress_handler is required in version 0.2.0. Pass NoOpProgressHandler() for silent mode. Direct progress will be deprecated in Phase 4.
    service = DefaultSessionService(

tests/test_session_service.py::TestDefaultSessionServiceListSessions::test_list_sessions_delegates_to_storage
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_session_service.py:155: DeprecationWarning: notification_handler is required in version 0.2.0. Pass NoOpNotificationHandler() for silent mode. Direct notifications will be deprecated in Phase 4.
    service = DefaultSessionService(

tests/test_session_service.py::TestDefaultSessionServiceListSessions::test_list_sessions_returns_list_of_session_objects
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_session_service.py:176: DeprecationWarning: io_handler is required in version 0.2.0. Pass QuietIOHandler() for headless mode. Direct I/O will be deprecated in Phase 4.
    service = DefaultSessionService(

tests/test_session_service.py::TestDefaultSessionServiceListSessions::test_list_sessions_returns_list_of_session_objects
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_session_service.py:176: DeprecationWarning: progress_handler is required in version 0.2.0. Pass NoOpProgressHandler() for silent mode. Direct progress will be deprecated in Phase 4.
    service = DefaultSessionService(

tests/test_session_service.py::TestDefaultSessionServiceListSessions::test_list_sessions_returns_list_of_session_objects
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_session_service.py:176: DeprecationWarning: notification_handler is required in version 0.2.0. Pass NoOpNotificationHandler() for silent mode. Direct notifications will be deprecated in Phase 4.
    service = DefaultSessionService(

tests/test_session_service.py::TestDefaultSessionServiceListSessions::test_list_sessions_calls_notification_handler_on_success
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_session_service.py:198: DeprecationWarning: io_handler is required in version 0.2.0. Pass QuietIOHandler() for headless mode. Direct I/O will be deprecated in Phase 4.
    service = DefaultSessionService(

tests/test_session_service.py::TestDefaultSessionServiceListSessions::test_list_sessions_calls_notification_handler_on_success
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_session_service.py:198: DeprecationWarning: progress_handler is required in version 0.2.0. Pass NoOpProgressHandler() for silent mode. Direct progress will be deprecated in Phase 4.
    service = DefaultSessionService(

tests/test_session_service.py::TestDefaultSessionServiceGetSession::test_get_session_delegates_to_storage
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_session_service.py:218: DeprecationWarning: io_handler is required in version 0.2.0. Pass QuietIOHandler() for headless mode. Direct I/O will be deprecated in Phase 4.
    service = DefaultSessionService(

tests/test_session_service.py::TestDefaultSessionServiceGetSession::test_get_session_delegates_to_storage
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_session_service.py:218: DeprecationWarning: progress_handler is required in version 0.2.0. Pass NoOpProgressHandler() for silent mode. Direct progress will be deprecated in Phase 4.
    service = DefaultSessionService(

tests/test_session_service.py::TestDefaultSessionServiceGetSession::test_get_session_delegates_to_storage
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_session_service.py:218: DeprecationWarning: notification_handler is required in version 0.2.0. Pass NoOpNotificationHandler() for silent mode. Direct notifications will be deprecated in Phase 4.
    service = DefaultSessionService(

tests/test_session_service.py::TestDefaultSessionServiceGetSession::test_get_session_returns_session_when_found
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_session_service.py:243: DeprecationWarning: io_handler is required in version 0.2.0. Pass QuietIOHandler() for headless mode. Direct I/O will be deprecated in Phase 4.
    service = DefaultSessionService(

tests/test_session_service.py::TestDefaultSessionServiceGetSession::test_get_session_returns_session_when_found
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_session_service.py:243: DeprecationWarning: progress_handler is required in version 0.2.0. Pass NoOpProgressHandler() for silent mode. Direct progress will be deprecated in Phase 4.
    service = DefaultSessionService(

tests/test_session_service.py::TestDefaultSessionServiceGetSession::test_get_session_returns_session_when_found
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_session_service.py:243: DeprecationWarning: notification_handler is required in version 0.2.0. Pass NoOpNotificationHandler() for silent mode. Direct notifications will be deprecated in Phase 4.
    service = DefaultSessionService(

tests/test_session_service.py::TestDefaultSessionServiceGetSession::test_get_session_returns_none_when_not_found
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_session_service.py:260: DeprecationWarning: io_handler is required in version 0.2.0. Pass QuietIOHandler() for headless mode. Direct I/O will be deprecated in Phase 4.
    service = DefaultSessionService(

tests/test_session_service.py::TestDefaultSessionServiceGetSession::test_get_session_returns_none_when_not_found
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_session_service.py:260: DeprecationWarning: progress_handler is required in version 0.2.0. Pass NoOpProgressHandler() for silent mode. Direct progress will be deprecated in Phase 4.
    service = DefaultSessionService(

tests/test_session_service.py::TestDefaultSessionServiceGetSession::test_get_session_returns_none_when_not_found
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_session_service.py:260: DeprecationWarning: notification_handler is required in version 0.2.0. Pass NoOpNotificationHandler() for silent mode. Direct notifications will be deprecated in Phase 4.
    service = DefaultSessionService(

tests/test_session_service.py::TestDefaultSessionServiceGetExportData::test_get_export_data_calls_progress_handler_start
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_session_service.py:279: DeprecationWarning: io_handler is required in version 0.2.0. Pass QuietIOHandler() for headless mode. Direct I/O will be deprecated in Phase 4.
    service = DefaultSessionService(

tests/test_session_service.py::TestDefaultSessionServiceGetExportData::test_get_export_data_calls_progress_handler_start
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_session_service.py:279: DeprecationWarning: notification_handler is required in version 0.2.0. Pass NoOpNotificationHandler() for silent mode. Direct notifications will be deprecated in Phase 4.
    service = DefaultSessionService(

tests/test_session_service.py::TestDefaultSessionServiceGetExportData::test_get_export_data_calls_progress_handler_update
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_session_service.py:295: DeprecationWarning: io_handler is required in version 0.2.0. Pass QuietIOHandler() for headless mode. Direct I/O will be deprecated in Phase 4.
    service = DefaultSessionService(

tests/test_session_service.py::TestDefaultSessionServiceGetExportData::test_get_export_data_calls_progress_handler_update
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_session_service.py:295: DeprecationWarning: notification_handler is required in version 0.2.0. Pass NoOpNotificationHandler() for silent mode. Direct notifications will be deprecated in Phase 4.
    service = DefaultSessionService(

tests/test_session_service.py::TestDefaultSessionServiceGetExportData::test_get_export_data_calls_progress_handler_complete
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_session_service.py:313: DeprecationWarning: io_handler is required in version 0.2.0. Pass QuietIOHandler() for headless mode. Direct I/O will be deprecated in Phase 4.
    service = DefaultSessionService(

tests/test_session_service.py::TestDefaultSessionServiceGetExportData::test_get_export_data_calls_progress_handler_complete
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_session_service.py:313: DeprecationWarning: notification_handler is required in version 0.2.0. Pass NoOpNotificationHandler() for silent mode. Direct notifications will be deprecated in Phase 4.
    service = DefaultSessionService(

tests/test_session_service.py::TestDefaultSessionServiceGetExportData::test_get_export_data_calls_notification_handler_on_success
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_session_service.py:329: DeprecationWarning: io_handler is required in version 0.2.0. Pass QuietIOHandler() for headless mode. Direct I/O will be deprecated in Phase 4.
    service = DefaultSessionService(

tests/test_session_service.py::TestDefaultSessionServiceGetExportData::test_get_export_data_calls_notification_handler_on_success
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_session_service.py:329: DeprecationWarning: progress_handler is required in version 0.2.0. Pass NoOpProgressHandler() for silent mode. Direct progress will be deprecated in Phase 4.
    service = DefaultSessionService(

tests/test_session_service.py::TestDefaultSessionServiceImportSession::test_import_session_calls_progress_handler_start
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_session_service.py:352: DeprecationWarning: io_handler is required in version 0.2.0. Pass QuietIOHandler() for headless mode. Direct I/O will be deprecated in Phase 4.
    service = DefaultSessionService(

tests/test_session_service.py::TestDefaultSessionServiceImportSession::test_import_session_calls_progress_handler_start
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_session_service.py:352: DeprecationWarning: notification_handler is required in version 0.2.0. Pass NoOpNotificationHandler() for silent mode. Direct notifications will be deprecated in Phase 4.
    service = DefaultSessionService(

tests/test_session_service.py::TestDefaultSessionServiceImportSession::test_import_session_creates_session_via_storage
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_session_service.py:374: DeprecationWarning: io_handler is required in version 0.2.0. Pass QuietIOHandler() for headless mode. Direct I/O will be deprecated in Phase 4.
    service = DefaultSessionService(

tests/test_session_service.py::TestDefaultSessionServiceImportSession::test_import_session_creates_session_via_storage
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_session_service.py:374: DeprecationWarning: progress_handler is required in version 0.2.0. Pass NoOpProgressHandler() for silent mode. Direct progress will be deprecated in Phase 4.
    service = DefaultSessionService(

tests/test_session_service.py::TestDefaultSessionServiceImportSession::test_import_session_creates_session_via_storage
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_session_service.py:374: DeprecationWarning: notification_handler is required in version 0.2.0. Pass NoOpNotificationHandler() for silent mode. Direct notifications will be deprecated in Phase 4.
    service = DefaultSessionService(

tests/test_session_service.py::TestDefaultSessionServiceImportSession::test_import_session_calls_progress_handler_complete
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_session_service.py:397: DeprecationWarning: io_handler is required in version 0.2.0. Pass QuietIOHandler() for headless mode. Direct I/O will be deprecated in Phase 4.
    service = DefaultSessionService(

tests/test_session_service.py::TestDefaultSessionServiceImportSession::test_import_session_calls_progress_handler_complete
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_session_service.py:397: DeprecationWarning: notification_handler is required in version 0.2.0. Pass NoOpNotificationHandler() for silent mode. Direct notifications will be deprecated in Phase 4.
    service = DefaultSessionService(

tests/test_session_service.py::TestDefaultSessionServiceImportSession::test_import_session_calls_notification_handler_on_success
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_session_service.py:419: DeprecationWarning: io_handler is required in version 0.2.0. Pass QuietIOHandler() for headless mode. Direct I/O will be deprecated in Phase 4.
    service = DefaultSessionService(

tests/test_session_service.py::TestDefaultSessionServiceImportSession::test_import_session_calls_notification_handler_on_success
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_session_service.py:419: DeprecationWarning: progress_handler is required in version 0.2.0. Pass NoOpProgressHandler() for silent mode. Direct progress will be deprecated in Phase 4.
    service = DefaultSessionService(

tests/test_session_service.py::TestDefaultSessionServiceHandlerTypes::test_all_methods_use_correct_handler_types
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_session_service.py:453: DeprecationWarning: io_handler is required in version 0.2.0. Pass QuietIOHandler() for headless mode. Direct I/O will be deprecated in Phase 4.
    service = DefaultSessionService(

tests/test_session_service.py::TestDefaultSessionServiceHandlerTypes::test_all_methods_use_correct_handler_types
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_session_service.py:453: DeprecationWarning: progress_handler is required in version 0.2.0. Pass NoOpProgressHandler() for silent mode. Direct progress will be deprecated in Phase 4.
    service = DefaultSessionService(

tests/test_session_service.py::TestDefaultSessionServiceHandlerTypes::test_all_methods_use_correct_handler_types
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_session_service.py:453: DeprecationWarning: notification_handler is required in version 0.2.0. Pass NoOpNotificationHandler() for silent mode. Direct notifications will be deprecated in Phase 4.
    service = DefaultSessionService(

tests/test_session_service.py::TestDefaultSessionServiceHandlerTypes::test_mock_storage_with_async_mock
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_session_service.py:503: DeprecationWarning: io_handler is required in version 0.2.0. Pass QuietIOHandler() for headless mode. Direct I/O will be deprecated in Phase 4.
    service = DefaultSessionService(

tests/test_session_service.py::TestDefaultSessionServiceHandlerTypes::test_mock_storage_with_async_mock
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_session_service.py:503: DeprecationWarning: progress_handler is required in version 0.2.0. Pass NoOpProgressHandler() for silent mode. Direct progress will be deprecated in Phase 4.
    service = DefaultSessionService(

tests/test_session_service.py::TestDefaultSessionServiceHandlerTypes::test_mock_storage_with_async_mock
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_session_service.py:503: DeprecationWarning: notification_handler is required in version 0.2.0. Pass NoOpNotificationHandler() for silent mode. Direct notifications will be deprecated in Phase 4.
    service = DefaultSessionService(

tests/test_settings_accounts.py::TestSettingsAccounts::test_get_accounts_by_provider_filters_correctly
tests/test_settings_accounts.py::TestSettingsAccounts::test_get_default_account_returns_default
tests/test_settings_accounts.py::TestSettingsAccounts::test_get_default_account_falls_back_to_provider_default
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/.venv/lib/python3.11/site-packages/pydantic/main.py:250: UserWarning: API key is shorter than 32 characters (28 chars). This may be insecure or invalid.
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)

tests/test_settings_accounts.py::TestSettingsAccounts::test_get_accounts_by_provider_filters_correctly
tests/test_settings_accounts.py::TestSettingsAccounts::test_get_accounts_by_provider_returns_empty_for_no_matches
tests/test_settings_accounts.py::TestSettingsAccounts::test_get_default_account_falls_back_to_provider_default
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/.venv/lib/python3.11/site-packages/pydantic/main.py:250: UserWarning: API key is shorter than 32 characters (31 chars). This may be insecure or invalid.
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)

tests/test_tui_integration.py::TestTUIIntegration::test_tui_app_launches_with_session_service_and_handlers
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_tui_integration.py:27: DeprecationWarning: io_handler is required in version 0.2.0. Pass QuietIOHandler() for headless mode. Direct I/O will be deprecated in Phase 4.
    session_service = DefaultSessionService(

tests/test_tui_integration.py::TestTUIIntegration::test_tui_app_launches_with_session_service_and_handlers
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_tui_integration.py:27: DeprecationWarning: progress_handler is required in version 0.2.0. Pass NoOpProgressHandler() for silent mode. Direct progress will be deprecated in Phase 4.
    session_service = DefaultSessionService(

tests/test_tui_integration.py::TestTUIIntegration::test_tui_app_launches_with_session_service_and_handlers
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_tui_integration.py:27: DeprecationWarning: notification_handler is required in version 0.2.0. Pass NoOpNotificationHandler() for silent mode. Direct notifications will be deprecated in Phase 4.
    session_service = DefaultSessionService(

tests/test_tui_integration.py::TestTUIIntegration::test_tui_session_list_loads_from_session_service
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_tui_integration.py:48: DeprecationWarning: io_handler is required in version 0.2.0. Pass QuietIOHandler() for headless mode. Direct I/O will be deprecated in Phase 4.
    session_service = DefaultSessionService(storage=storage)

tests/test_tui_integration.py::TestTUIIntegration::test_tui_session_list_loads_from_session_service
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_tui_integration.py:48: DeprecationWarning: progress_handler is required in version 0.2.0. Pass NoOpProgressHandler() for silent mode. Direct progress will be deprecated in Phase 4.
    session_service = DefaultSessionService(storage=storage)

tests/test_tui_integration.py::TestTUIIntegration::test_tui_session_list_loads_from_session_service
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_tui_integration.py:48: DeprecationWarning: notification_handler is required in version 0.2.0. Pass NoOpNotificationHandler() for silent mode. Direct notifications will be deprecated in Phase 4.
    session_service = DefaultSessionService(storage=storage)

tests/test_tui_integration.py::TestTUIIntegration::test_backward_compatibility_tui_visuals_unchanged
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_tui_integration.py:63: DeprecationWarning: io_handler is required in version 0.2.0. Pass QuietIOHandler() for headless mode. Direct I/O will be deprecated in Phase 4.
    session_service = DefaultSessionService(storage=storage)

tests/test_tui_integration.py::TestTUIIntegration::test_backward_compatibility_tui_visuals_unchanged
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_tui_integration.py:63: DeprecationWarning: progress_handler is required in version 0.2.0. Pass NoOpProgressHandler() for silent mode. Direct progress will be deprecated in Phase 4.
    session_service = DefaultSessionService(storage=storage)

tests/test_tui_integration.py::TestTUIIntegration::test_backward_compatibility_tui_visuals_unchanged
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_tui_integration.py:63: DeprecationWarning: notification_handler is required in version 0.2.0. Pass NoOpNotificationHandler() for silent mode. Direct notifications will be deprecated in Phase 4.
    session_service = DefaultSessionService(storage=storage)

tests/test_tui_integration.py::TestTUIIntegration::test_tui_no_direct_io_calls
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_tui_integration.py:81: DeprecationWarning: io_handler is required in version 0.2.0. Pass QuietIOHandler() for headless mode. Direct I/O will be deprecated in Phase 4.
    session_service = DefaultSessionService(storage=storage)

tests/test_tui_integration.py::TestTUIIntegration::test_tui_no_direct_io_calls
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_tui_integration.py:81: DeprecationWarning: progress_handler is required in version 0.2.0. Pass NoOpProgressHandler() for silent mode. Direct progress will be deprecated in Phase 4.
    session_service = DefaultSessionService(storage=storage)

tests/test_tui_integration.py::TestTUIIntegration::test_tui_no_direct_io_calls
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_tui_integration.py:81: DeprecationWarning: notification_handler is required in version 0.2.0. Pass NoOpNotificationHandler() for silent mode. Direct notifications will be deprecated in Phase 4.
    session_service = DefaultSessionService(storage=storage)

tests/test_tui_integration.py::TestTUIIntegration::test_tui_textual_structure_unchanged
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_tui_integration.py:99: DeprecationWarning: io_handler is required in version 0.2.0. Pass QuietIOHandler() for headless mode. Direct I/O will be deprecated in Phase 4.
    session_service = DefaultSessionService(storage=storage)

tests/test_tui_integration.py::TestTUIIntegration::test_tui_textual_structure_unchanged
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_tui_integration.py:99: DeprecationWarning: progress_handler is required in version 0.2.0. Pass NoOpProgressHandler() for silent mode. Direct progress will be deprecated in Phase 4.
    session_service = DefaultSessionService(storage=storage)

tests/test_tui_integration.py::TestTUIIntegration::test_tui_textual_structure_unchanged
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_tui_integration.py:99: DeprecationWarning: notification_handler is required in version 0.2.0. Pass NoOpNotificationHandler() for silent mode. Direct notifications will be deprecated in Phase 4.
    session_service = DefaultSessionService(storage=storage)

tests/test_tui_integration.py::TestTUIIntegration::test_tui_message_screen_accepts_session_service_when_provided
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_tui_integration.py:139: DeprecationWarning: io_handler is required in version 0.2.0. Pass QuietIOHandler() for headless mode. Direct I/O will be deprecated in Phase 4.
    session_service = DefaultSessionService(storage=storage)

tests/test_tui_integration.py::TestTUIIntegration::test_tui_message_screen_accepts_session_service_when_provided
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_tui_integration.py:139: DeprecationWarning: progress_handler is required in version 0.2.0. Pass NoOpProgressHandler() for silent mode. Direct progress will be deprecated in Phase 4.
    session_service = DefaultSessionService(storage=storage)

tests/test_tui_integration.py::TestTUIIntegration::test_tui_message_screen_accepts_session_service_when_provided
  /Users/parkersligting/develop/pt/worktrees/harness-agent-rework/tests/test_tui_integration.py:139: DeprecationWarning: notification_handler is required in version 0.2.0. Pass NoOpNotificationHandler() for silent mode. Direct notifications will be deprecated in Phase 4.
    session_service = DefaultSessionService(storage=storage)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
______________ coverage: platform darwin, python 3.11.14-final-0 _______________

Name                                                               Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------
dawn_kestrel/__init__.py                                              35     14    60%   25-26, 33-34, 40-41, 60-64, 69-73
dawn_kestrel/agents/__init__.py                                      145    105    28%   30-31, 38-41, 49-70, 74-79, 86-90, 97-103, 111-123, 127, 131, 135, 139, 143-144, 149, 161-164, 184-217, 231-265, 282-292, 304-323, 334-341
dawn_kestrel/agents/bolt_merlin/__init__.py                           13      0   100%
dawn_kestrel/agents/bolt_merlin/autonomous_worker/__init__.py          6      0   100%
dawn_kestrel/agents/bolt_merlin/consultant/__init__.py                 6      0   100%
dawn_kestrel/agents/bolt_merlin/explore/__init__.py                    7      0   100%
dawn_kestrel/agents/bolt_merlin/frontend_ui_engineer/__init__.py       7      0   100%
dawn_kestrel/agents/bolt_merlin/librarian/__init__.py                  7      0   100%
dawn_kestrel/agents/bolt_merlin/master_orchestrator/__init__.py        6      0   100%
dawn_kestrel/agents/bolt_merlin/multimodal_looker/__init__.py          7      0   100%
dawn_kestrel/agents/bolt_merlin/orchestrator/__init__.py               7      0   100%
dawn_kestrel/agents/bolt_merlin/plan_validator/__init__.py             7      0   100%
dawn_kestrel/agents/bolt_merlin/planner/__init__.py                    6      0   100%
dawn_kestrel/agents/bolt_merlin/pre_planning/__init__.py               6      0   100%
dawn_kestrel/agents/builtin.py                                        33      6    82%   120-125
dawn_kestrel/agents/memory_embedder.py                                95     45    53%   51-55, 63, 69-70, 91-96, 154-182, 193-229
dawn_kestrel/agents/memory_manager.py                                 50      0   100%
dawn_kestrel/agents/memory_summarizer.py                             130     48    63%   46, 55, 105-109, 117, 123-124, 164-165, 192-197, 232, 280, 300-375
dawn_kestrel/agents/orchestrator.py                                  142     17    88%   134, 256, 259-264, 295-323
dawn_kestrel/agents/registry.py                                      100      8    92%   80, 94, 120-121, 155-159
dawn_kestrel/agents/review/__init__.py                                 5      0   100%
dawn_kestrel/agents/review/agents/__init__.py                         12      0   100%
dawn_kestrel/agents/review/agents/architecture.py                     19      0   100%
dawn_kestrel/agents/review/agents/changelog.py                        19      0   100%
dawn_kestrel/agents/review/agents/dependencies.py                     16      0   100%
dawn_kestrel/agents/review/agents/diff_scoper.py                      17      0   100%
dawn_kestrel/agents/review/agents/documentation.py                    17      0   100%
dawn_kestrel/agents/review/agents/linting.py                          17      0   100%
dawn_kestrel/agents/review/agents/performance.py                      17      0   100%
dawn_kestrel/agents/review/agents/requirements.py                     18      0   100%
dawn_kestrel/agents/review/agents/security.py                         48      0   100%
dawn_kestrel/agents/review/agents/telemetry.py                        17      0   100%
dawn_kestrel/agents/review/agents/unit_tests.py                       17      0   100%
dawn_kestrel/agents/review/base.py                                   155     22    86%   34-37, 44, 48, 54, 56, 104, 109, 118, 127, 136, 145, 158, 165-166, 380, 415-423
dawn_kestrel/agents/review/cli.py                                    195     88    55%   23-34, 176-237, 269-270, 327, 398-456
dawn_kestrel/agents/review/context_builder.py                         32      3    91%   47, 120-121
dawn_kestrel/agents/review/contracts.py                              100      1    99%   28
dawn_kestrel/agents/review/discovery.py                              268     28    90%   275-276, 338, 351-355, 398, 438-439, 459-460, 485, 491, 528-529, 534-535, 549-550, 594-595, 636-639, 642, 647
dawn_kestrel/agents/review/doc_gen.py                                272     11    96%   68, 83-140, 195, 211-212, 380, 753-756
dawn_kestrel/agents/review/neighbors.py                               77      4    95%   55-56, 65, 74
dawn_kestrel/agents/review/orchestrator.py                            95      4    96%   101, 117, 127, 153
dawn_kestrel/agents/review/pattern_learning.py                       205     16    92%   35, 166-168, 249-251, 304-305, 312-314, 444-445, 452-453
dawn_kestrel/agents/review/pr_facts.py                                86     15    83%   74-97
dawn_kestrel/agents/review/redaction.py                               27      0   100%
dawn_kestrel/agents/review/registry.py                                66      0   100%
dawn_kestrel/agents/review/streaming.py                              111      4    96%   203-204, 237-238
dawn_kestrel/agents/review/utils/__init__.py                           0      0   100%
dawn_kestrel/agents/review/utils/config.py                           214     26    88%   47-52, 65-67, 113-115, 136-138, 223, 228, 338, 367, 372-380, 383
dawn_kestrel/agents/review/utils/executor.py                         174     17    90%   92, 107, 116, 227-228, 233, 236, 240-248, 282
dawn_kestrel/agents/review/utils/git.py                               63      7    89%   57, 85-88, 121-122
dawn_kestrel/agents/review/verifier.py                                88     15    83%   43, 82-83, 114-120, 206, 227-235
dawn_kestrel/agents/runtime.py                                       106      8    92%   95-100, 103-108, 123, 178, 204, 285
dawn_kestrel/agents/tool_execution_tracker.py                         91     15    84%   116-117, 139-140, 151-153, 173, 186-187, 192, 215-219
dawn_kestrel/ai/tool_execution.py                                    113     92    19%   47-183, 186, 203-320, 329-338, 342-344, 354
dawn_kestrel/ai_session.py                                           152    110    28%   49, 52, 58, 67-74, 78-80, 86-173, 178-221, 235-291, 295-297, 301-315, 319-334
dawn_kestrel/benchmarks/__init__.py                                   79      1    99%   92
dawn_kestrel/benchmarks/agent_execution.py                            30     30     0%   10-96
dawn_kestrel/benchmarks/context_build.py                              40     40     0%   10-148
dawn_kestrel/benchmarks/memory_search.py                              40     40     0%   10-139
dawn_kestrel/cli/__init__.py                                           2      0   100%
dawn_kestrel/cli/ai_commands.py                                      164    164     0%   8-282
dawn_kestrel/cli/handlers.py                                          76     76     0%   7-232
dawn_kestrel/cli/main.py                                             150    102    32%   21-24, 29-36, 43, 51-90, 99-109, 125-173, 182-223, 229-242, 256-258, 272-274
dawn_kestrel/compaction.py                                            89     89     0%   8-178
dawn_kestrel/context/__init__.py                                       2      0   100%
dawn_kestrel/context/builder.py                                       84      0   100%
dawn_kestrel/context/pipeline.py                                     102    102     0%   2-279
dawn_kestrel/core/__init__.py                                          4      0   100%
dawn_kestrel/core/agent_task.py                                       53      0   100%
dawn_kestrel/core/agent_types.py                                      55      0   100%
dawn_kestrel/core/config.py                                           15      0   100%
dawn_kestrel/core/event_bus.py                                        77      1    99%   96
dawn_kestrel/core/exceptions.py                                        7      0   100%
dawn_kestrel/core/harness/__init__.py                                  2      0   100%
dawn_kestrel/core/harness/runner.py                                  135     14    90%   410, 427, 487, 520-527, 529-538
dawn_kestrel/core/http_client.py                                     106     66    38%   57, 72, 105-179, 207, 215-222, 225-234, 241-245, 249-263, 270, 278
dawn_kestrel/core/models.py                                          172      0   100%
dawn_kestrel/core/provider_config.py                                  34      3    91%   56-57, 147
dawn_kestrel/core/provider_settings.py                                46      3    93%   137-139
dawn_kestrel/core/services/session_service.py                        100     20    80%   194, 203-213, 237-248, 282-292
dawn_kestrel/core/session.py                                         144     75    48%   38, 85-102, 109, 135-152, 156-164, 168-178, 182, 186, 190-210, 251-266, 271-310, 315, 320, 325, 330-339
dawn_kestrel/core/session_lifecycle.py                               218     76    65%   231, 246-250, 265-269, 284-288, 303-307, 322-326, 341-345, 380-381, 406-407, 410-415, 432-433, 439-440, 456-457, 460-466, 480-481, 484-489, 501-502, 505-510, 522-523, 526-529
dawn_kestrel/core/settings.py                                        146     27    82%   190-206, 216-224, 233, 238, 255, 282, 304, 308, 332, 345
dawn_kestrel/interfaces/io.py                                         67      0   100%
dawn_kestrel/llm/__init__.py                                           2      0   100%
dawn_kestrel/llm/client.py                                           183     14    92%   95, 207, 231, 244, 306, 346, 366, 412-430
dawn_kestrel/permissions/__init__.py                                   0      0   100%
dawn_kestrel/permissions/evaluate.py                                  28     14    50%   18-28, 51-60, 88
dawn_kestrel/provider/__init__.py                                    103     53    49%   43, 53, 58, 63, 68, 72, 79-82, 85-88, 96-103, 107-112, 115, 119-139, 147, 156-157, 161-162, 166, 170-184
dawn_kestrel/provider/handler.py                                      40     40     0%   2-84
dawn_kestrel/provider/stream_types.py                                 67      1    99%   12
dawn_kestrel/providers/__init__.py                                   116     83    28%   53-87, 96-193, 196, 204-210, 215-216, 219-248, 257-272, 279, 286-288, 294, 304, 315-318
dawn_kestrel/providers/base.py                                        88      2    98%   95, 99
dawn_kestrel/providers/openai.py                                      72     72     0%   7-200
dawn_kestrel/providers/registry.py                                    95     19    80%   100, 155-156, 190, 211, 226-227, 237-252
dawn_kestrel/providers/zai.py                                         11      1    91%   30
dawn_kestrel/providers/zai_base.py                                    82     22    73%   45, 58, 72, 98-100, 103, 108-110, 126-131, 147-148, 152-153, 165-166
dawn_kestrel/providers/zai_coding_plan.py                             11      0   100%
dawn_kestrel/review.py                                                48     48     0%   2-157
dawn_kestrel/sdk/__init__.py                                           8      2    75%   6-7
dawn_kestrel/sdk/client.py                                           174     38    78%   126, 149, 166, 183, 210, 240-243, 261-264, 316, 359-362, 411-412, 449-452, 478, 504, 646, 650, 660, 673, 679, 683, 687, 697, 701, 705, 709, 713
dawn_kestrel/session/__init__.py                                       5      0   100%
dawn_kestrel/session/compaction.py                                    96     82    15%   20-21, 38-54, 67-128, 153-204
dawn_kestrel/session/export_import.py                                 77     77     0%   2-177
dawn_kestrel/session/fork_revert.py                                  116    116     0%   8-231
dawn_kestrel/session/import_export.py                                 58     41    29%   39-66, 78-115
dawn_kestrel/session/processor.py                                    125    105    16%   50-56, 65-84, 89-206, 214-216, 224-237, 241-245, 249-259, 267-270, 282-283, 287-288, 292-293
dawn_kestrel/session/revert.py                                        31     20    35%   16-18, 35-76, 86, 96
dawn_kestrel/skills/injector.py                                       35      2    94%   111, 116
dawn_kestrel/skills/loader.py                                         74     35    53%   11-12, 27-30, 52, 60, 69, 73-78, 92-118, 131-132, 137-138
dawn_kestrel/snapshot.py                                             142    142     0%   8-219
dawn_kestrel/snapshot/__init__.py                                      2      0   100%
dawn_kestrel/snapshot/index.py                                        82     64    22%   17-18, 27-57, 66-84, 97-112, 125-140, 149-173, 182-196, 200-211, 215-221, 225-226
dawn_kestrel/storage/__init__.py                                       0      0   100%
dawn_kestrel/storage/memory_storage.py                                25      1    96%   25
dawn_kestrel/storage/store.py                                        118     48    59%   50-53, 82-87, 91-99, 108-110, 114-115, 123-126, 135-143, 151-154, 163-164, 168-174
dawn_kestrel/tools/__init__.py                                        30      5    83%   79-80, 89-100
dawn_kestrel/tools/additional.py                                     854    709    17%   42, 50-122, 138-166, 177-206, 214-217, 220-223, 240-344, 362-449, 461-494, 519, 531-578, 590-652, 664-667, 671-675, 691-788, 803-805, 809-872, 878-907, 917-935, 970-979, 1003-1110, 1187, 1216-1326, 1340-1353, 1358-1372, 1376, 1380, 1402-1450, 1468-1528, 1543-1544, 1559-1608, 1620-1706, 1714-1715, 1734-1797, 1827-1965, 1993-2000, 2023-2030, 2061-2139
dawn_kestrel/tools/builtin.py                                        170    109    36%   34, 47-82, 113-161, 192-216, 247-283, 313-348, 379-435
dawn_kestrel/tools/framework.py                                       60     17    72%   25, 33, 64, 73, 81, 101, 124-155
dawn_kestrel/tools/permission_filter.py                               77     15    81%   48, 55, 83-84, 88-89, 123-124, 127, 150, 168, 181-187
dawn_kestrel/tools/prompts/__init__.py                                10      1    90%   11
dawn_kestrel/tools/registry.py                                        47     47     0%   7-99
dawn_kestrel/tui/__init__.py                                           2      0   100%
dawn_kestrel/tui/app.py                                              134     80    40%   61, 106-151, 155-159, 163-168, 176-178, 183, 187-192, 196-201, 205-217, 221-223, 227-236, 240-265, 269, 273-274, 278-280
dawn_kestrel/tui/dialogs/__init__.py                                 153    153     0%   3-394
dawn_kestrel/tui/dialogs/command_palette_dialog.py                    66     66     0%   3-180
dawn_kestrel/tui/dialogs/model_select_dialog.py                       69     69     0%   3-165
dawn_kestrel/tui/dialogs/theme_select_dialog.py                       58     58     0%   3-135
dawn_kestrel/tui/handlers.py                                          38      0   100%
dawn_kestrel/tui/keybindings.py                                        4      4     0%   7-25
dawn_kestrel/tui/message_view.py                                     114     93    18%   53-55, 58-135, 205-207, 210-240, 244-258, 262
dawn_kestrel/tui/screens/__init__.py                                   2      0   100%
dawn_kestrel/tui/screens/context_browser.py                          228    228     0%   12-508
dawn_kestrel/tui/screens/diff_viewer.py                              225    225     0%   14-457
dawn_kestrel/tui/screens/message_screen.py                           275    214    22%   162-174, 178-181, 185-210, 214-217, 221-226, 230-232, 236-274, 278-367, 371-402, 406-410, 414-455, 459-507, 511-546, 550, 554, 558, 562, 566, 570, 574, 578, 582, 586, 590-621, 625-649, 653
dawn_kestrel/tui/screens/session_list_screen.py                       58     58     0%   9-112
dawn_kestrel/tui/widgets/__init__.py                                   3      0   100%
dawn_kestrel/tui/widgets/footer.py                                    62     37    40%   68-78, 82-105, 109-110, 114-115, 119-120, 124-125, 131, 136, 141, 146
dawn_kestrel/tui/widgets/header.py                                    46     25    46%   64-72, 76-93, 97-98, 104-105, 109-110, 116, 121, 126
dawn_kestrel/utils/__init__.py                                         0      0   100%
dawn_kestrel/utils/json_parser.py                                     18      2    89%   53, 65
------------------------------------------------------------------------------------------------
TOTAL                                                              10900   5015    54%
=========================== short test summary info ============================
FAILED tests/review/agents/test_security_reviewer.py::TestSecurityReviewerLLMBased::test_review_includes_system_prompt_and_context_in_message - assert None is not None
FAILED tests/review/agents/test_unit_tests_reviewer.py::TestUnitTestsReviewerLLMBased::test_review_creates_ai_session_and_calls_process_message - AttributeError: <module 'dawn_kestrel.agents.review.agents.unit_tests' from '/Users/parkersligting/develop/pt/worktrees/harness-agent-rework/dawn_kestrel/agents/review/agents/unit_tests.py'> does not have the attribute 'AISession'
FAILED tests/review/agents/test_unit_tests_reviewer.py::TestUnitTestsReviewerLLMBased::test_review_handles_missing_api_key_by_raising_exception - AttributeError: <module 'dawn_kestrel.agents.review.agents.unit_tests' from '/Users/parkersligting/develop/pt/worktrees/harness-agent-rework/dawn_kestrel/agents/review/agents/unit_tests.py'> does not have the attribute 'AISession'
FAILED tests/review/agents/test_unit_tests_reviewer.py::TestUnitTestsReviewerLLMBased::test_review_handles_invalid_json_response - AttributeError: <module 'dawn_kestrel.agents.review.agents.unit_tests' from '/Users/parkersligting/develop/pt/worktrees/harness-agent-rework/dawn_kestrel/agents/review/agents/unit_tests.py'> does not have the attribute 'AISession'
FAILED tests/review/agents/test_unit_tests_reviewer.py::TestUnitTestsReviewerLLMBased::test_review_handles_timeout_error_by_raising_exception - AttributeError: <module 'dawn_kestrel.agents.review.agents.unit_tests' from '/Users/parkersligting/develop/pt/worktrees/harness-agent-rework/dawn_kestrel/agents/review/agents/unit_tests.py'> does not have the attribute 'AISession'
FAILED tests/review/agents/test_unit_tests_reviewer.py::TestUnitTestsReviewerLLMBased::test_review_with_no_findings_returns_merge_severity - AttributeError: <module 'dawn_kestrel.agents.review.agents.unit_tests' from '/Users/parkersligting/develop/pt/worktrees/harness-agent-rework/dawn_kestrel/agents/review/agents/unit_tests.py'> does not have the attribute 'AISession'
FAILED tests/review/agents/test_unit_tests_reviewer.py::TestUnitTestsReviewerLLMBased::test_review_includes_system_prompt_and_context_in_message - AttributeError: <module 'dawn_kestrel.agents.review.agents.unit_tests' from '/Users/parkersligting/develop/pt/worktrees/harness-agent-rework/dawn_kestrel/agents/review/agents/unit_tests.py'> does not have the attribute 'AISession'
FAILED tests/review/agents/test_unit_tests_reviewer.py::TestUnitTestsReviewerLLMBased::test_review_with_blocking_severity - AttributeError: <module 'dawn_kestrel.agents.review.agents.unit_tests' from '/Users/parkersligting/develop/pt/worktrees/harness-agent-rework/dawn_kestrel/agents/review/agents/unit_tests.py'> does not have the attribute 'AISession'
FAILED tests/review/base/test_base_reviewer.py::TestIsRelevantToChanges::test_is_relevant_to_changes_with_matching_pattern - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
FAILED tests/review/base/test_base_reviewer.py::TestIsRelevantToChanges::test_is_relevant_to_changes_with_no_matching_pattern - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
FAILED tests/review/base/test_base_reviewer.py::TestIsRelevantToChanges::test_is_relevant_to_changes_with_empty_patterns - TypeError: Can't instantiate abstract class MockReviewerWithNoPatterns with abstract methods get_agent_name, get_allowed_tools
FAILED tests/review/base/test_base_reviewer.py::TestIsRelevantToChanges::test_is_relevant_to_changes_with_multiple_patterns - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
FAILED tests/review/base/test_base_reviewer.py::TestIsRelevantToChanges::test_is_relevant_to_changes_with_special_glob_patterns - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
FAILED tests/review/base/test_base_reviewer.py::TestIsRelevantToChanges::test_is_relevant_to_changes_with_nested_path - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
FAILED tests/review/base/test_base_reviewer.py::TestIsRelevantToChanges::test_is_relevant_to_changes_with_single_file - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
FAILED tests/review/base/test_base_reviewer.py::TestIsRelevantToChanges::test_is_relevant_to_changes_with_case_sensitive_paths - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
FAILED tests/review/base/test_base_reviewer.py::TestIsRelevantToChanges::test_is_relevant_to_changes_with_complex_pattern - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
FAILED tests/review/base/test_base_reviewer.py::TestIsRelevantToChanges::test_is_relevant_to_changes_with_ignored_files - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
FAILED tests/review/base/test_base_reviewer.py::TestFormatInputsForPrompt::test_format_inputs_for_prompt_basic - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
FAILED tests/review/base/test_base_reviewer.py::TestFormatInputsForPrompt::test_format_inputs_for_prompt_without_git_refs - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
FAILED tests/review/base/test_base_reviewer.py::TestFormatInputsForPrompt::test_format_inputs_for_prompt_with_pr_info - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
FAILED tests/review/base/test_base_reviewer.py::TestFormatInputsForPrompt::test_format_inputs_for_prompt_multiline_diff - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
FAILED tests/review/base/test_base_reviewer.py::TestFormatInputsForPrompt::test_format_inputs_for_prompt_multiple_files - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
FAILED tests/review/base/test_base_reviewer.py::TestFormatInputsForPrompt::test_format_inputs_for_prompt_empty_list - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
FAILED tests/review/base/test_base_reviewer.py::TestFormatInputsForPrompt::test_format_inputs_for_prompt_no_diff - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
FAILED tests/review/base/test_base_reviewer.py::TestFormatInputsForPrompt::test_format_inputs_for_prompt_code_block_format - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
FAILED tests/review/base/test_base_reviewer.py::TestFormatInputsForPrompt::test_format_inputs_for_prompt_leading_trailing_whitespace - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
FAILED tests/review/test_base.py::TestBaseReviewerAgent::test_concrete_subclass_implementation - TypeError: Can't instantiate abstract class ConcreteReviewer with abstract methods get_agent_name, get_allowed_tools
FAILED tests/review/test_base.py::TestBaseReviewerAgent::test_is_relevant_to_changes_with_match - TypeError: Can't instantiate abstract class TestReviewer with abstract methods get_agent_name, get_allowed_tools
FAILED tests/review/test_base.py::TestBaseReviewerAgent::test_is_relevant_to_changes_no_match - TypeError: Can't instantiate abstract class TestReviewer with abstract methods get_agent_name, get_allowed_tools
FAILED tests/review/test_base.py::TestBaseReviewerAgent::test_is_relevant_to_changes_empty_patterns - TypeError: Can't instantiate abstract class TestReviewer with abstract methods get_agent_name, get_allowed_tools
FAILED tests/review/test_base.py::TestBaseReviewerAgent::test_format_inputs_for_prompt - TypeError: Can't instantiate abstract class TestReviewer with abstract methods get_agent_name, get_allowed_tools
FAILED tests/review/test_base.py::TestBaseReviewerAgent::test_format_inputs_for_prompt_minimal_context - TypeError: Can't instantiate abstract class TestReviewer with abstract methods get_agent_name, get_allowed_tools
FAILED tests/review/test_characterization_refactor_safety.py::test_security_reviewer_skips_llm_for_non_relevant_files - AssertionError: assert 'No files mat...ance patterns' == 'No files mat...view patterns'
  
  - No files matched security review patterns
  ?                  ---------   ^ -
  + No files matched relevance patterns
  ?                    ++ ^^^
FAILED tests/review/test_cli.py::test_cli_review_json_output - AttributeError: <module 'dawn_kestrel.agents.review.cli' from '/Users/parkersligting/develop/pt/worktrees/harness-agent-rework/dawn_kestrel/agents/review/cli.py'> has no attribute 'PRReviewOrchestrator'
FAILED tests/review/test_cli.py::test_cli_review_markdown_output - AttributeError: <module 'dawn_kestrel.agents.review.cli' from '/Users/parkersligting/develop/pt/worktrees/harness-agent-rework/dawn_kestrel/agents/review/cli.py'> has no attribute 'PRReviewOrchestrator'
FAILED tests/review/test_cli.py::test_cli_review_markdown_output_approve_with_warnings - AttributeError: <module 'dawn_kestrel.agents.review.cli' from '/Users/parkersligting/develop/pt/worktrees/harness-agent-rework/dawn_kestrel/agents/review/cli.py'> has no attribute 'PRReviewOrchestrator'
FAILED tests/review/test_cli.py::test_cli_review_terminal_output_streams_progress - AttributeError: <module 'dawn_kestrel.agents.review.cli' from '/Users/parkersligting/develop/pt/worktrees/harness-agent-rework/dawn_kestrel/agents/review/cli.py'> has no attribute 'PRReviewOrchestrator'
FAILED tests/review/test_contracts.py::TestScope::test_scope_extra_fields_forbidden - Failed: DID NOT RAISE <class 'pydantic_core._pydantic_core.ValidationError'>
FAILED tests/review/test_contracts.py::TestSkip::test_skip_extra_fields_forbidden - Failed: DID NOT RAISE <class 'pydantic_core._pydantic_core.ValidationError'>
FAILED tests/review/test_contracts.py::TestMergeGate::test_merge_gate_extra_fields_forbidden - Failed: DID NOT RAISE <class 'pydantic_core._pydantic_core.ValidationError'>
FAILED tests/review/test_contracts.py::TestReviewOutput::test_review_output_extra_fields_forbidden - Failed: DID NOT RAISE <class 'pydantic_core._pydantic_core.ValidationError'>
FAILED tests/review/test_doc_gen.py::TestDocGenAgentGetAgentName::test_get_agent_name_with_method - TypeError: Can't instantiate abstract class MockAgent with abstract method get_allowed_tools
FAILED tests/review/test_doc_gen.py::TestDocGenAgentGetAgentName::test_get_agent_name_fallback_to_class - TypeError: Can't instantiate abstract class MockAgent with abstract methods get_agent_name, get_allowed_tools
FAILED tests/review/test_doc_gen.py::TestDocGenAgentGetAgentName::test_get_agent_name_removes_reviewer_suffix - TypeError: Can't instantiate abstract class MockReviewer with abstract methods get_agent_name, get_allowed_tools
FAILED tests/review/test_doc_gen.py::TestDocGenAgentGetAgentName::test_get_agent_name_with_complex_name - TypeError: Can't instantiate abstract class MockReviewer123 with abstract methods get_agent_name, get_allowed_tools
FAILED tests/review/test_doc_gen.py::TestDocGenAgentExtractPatternsFromPrompt::test_extract_patterns_with_all_types - TypeError: Can't instantiate abstract class MockAgent with abstract methods get_agent_name, get_allowed_tools
FAILED tests/review/test_doc_gen.py::TestDocGenAgentExtractPatternsFromPrompt::test_extract_patterns_minimum_ast - TypeError: Can't instantiate abstract class MockAgent with abstract methods get_agent_name, get_allowed_tools
FAILED tests/review/test_doc_gen.py::TestDocGenAgentExtractPatternsFromPrompt::test_extract_patterns_minimum_file_path - TypeError: Can't instantiate abstract class MockAgent with abstract methods get_agent_name, get_allowed_tools
FAILED tests/review/test_doc_gen.py::TestDocGenAgentExtractPatternsFromPrompt::test_extract_patterns_minimum_content - TypeError: Can't instantiate abstract class MockAgent with abstract methods get_agent_name, get_allowed_tools
FAILED tests/review/test_doc_gen.py::TestDocGenAgentExtractPatternsFromPrompt::test_extract_patterns_sort_by_weight - TypeError: Can't instantiate abstract class MockAgent with abstract methods get_agent_name, get_allowed_tools
FAILED tests/review/test_doc_gen.py::TestDocGenAgentExtractPatternsFromPrompt::test_extract_patterns_no_duplicates - TypeError: Can't instantiate abstract class MockAgent with abstract methods get_agent_name, get_allowed_tools
FAILED tests/review/test_doc_gen.py::TestDocGenAgentDetermineAgentType::test_determine_required_agent - TypeError: Can't instantiate abstract class SecurityReviewer with abstract methods get_agent_name, get_allowed_tools
FAILED tests/review/test_doc_gen.py::TestDocGenAgentDetermineAgentType::test_determine_optional_agent - TypeError: Can't instantiate abstract class CustomAgent with abstract methods get_agent_name, get_allowed_tools
FAILED tests/review/test_doc_gen.py::TestDocGenAgentDetermineAgentType::test_required_agents_list - TypeError: Can't instantiate abstract class ArchitectureReviewer with abstract methods get_agent_name, get_allowed_tools
FAILED tests/review/test_doc_gen.py::TestDocGenAgentDetermineAgentType::test_non_required_agent_names - TypeError: Can't instantiate abstract class DocumentationReviewer with abstract methods get_agent_name, get_allowed_tools
FAILED tests/review/test_doc_gen.py::TestDocGenAgentGenerateForAgent::test_generate_for_agent_with_agent_name_extraction - TypeError: Can't instantiate abstract class TestAgent with abstract methods get_agent_name, get_allowed_tools
FAILED tests/review/test_generate_docs.py::test_generate_docs_with_agent_flag - AttributeError: module 'dawn_kestrel.agents.review.cli' has no attribute 'generate_docs'
FAILED tests/review/test_generate_docs.py::test_generate_docs_with_force_flag - AttributeError: module 'dawn_kestrel.agents.review.cli' has no attribute 'generate_docs'
FAILED tests/review/test_generate_docs.py::test_generate_docs_with_output_flag - AttributeError: module 'dawn_kestrel.agents.review.cli' has no attribute 'generate_docs'
FAILED tests/review/test_generate_docs.py::test_generate_docs_with_verbose_flag - AttributeError: module 'dawn_kestrel.agents.review.cli' has no attribute 'generate_docs'
FAILED tests/review/test_generate_docs.py::test_generate_docs_with_invalid_agent - AttributeError: module 'dawn_kestrel.agents.review.cli' has no attribute 'generate_docs'
FAILED tests/review/test_generate_docs.py::test_generate_docs_requires_agent_or_all - AttributeError: module 'dawn_kestrel.agents.review.cli' has no attribute 'generate_docs'
FAILED tests/review/test_generate_docs.py::test_generate_docs_default_output_path - AttributeError: module 'dawn_kestrel.agents.review.cli' has no attribute 'generate_docs'
FAILED tests/review/test_integration_entry_points.py::TestBaselineComparison::test_baseline_vs_enhanced_performance - TypeError: Can't instantiate abstract class MockReviewer with abstract method get_allowed_tools
FAILED tests/review/test_integration_entry_points.py::TestFallbackBehavior::test_discovery_returns_none_triggers_fallback - TypeError: Can't instantiate abstract class MockReviewer with abstract method get_allowed_tools
FAILED tests/review/test_integration_entry_points.py::TestFallbackBehavior::test_discovery_timeout_triggers_fallback - TypeError: Can't instantiate abstract class MockReviewer with abstract method get_allowed_tools
FAILED tests/review/test_integration_entry_points.py::TestErrorScenarios::test_review_timeout_handling - TypeError: Can't instantiate abstract class SlowReviewer with abstract method get_allowed_tools
FAILED tests/review/test_integration_review_pipeline.py::test_review_pipeline_runs_all_subagents - TypeError: BaseReviewerAgent.__init__() got an unexpected keyword argument 'executor'
FAILED tests/review/test_orchestrator.py::test_orchestrator_initialization - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract method get_allowed_tools
FAILED tests/review/test_orchestrator.py::test_orchestrator_with_custom_dependencies - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract method get_allowed_tools
FAILED tests/review/test_orchestrator.py::test_run_subagents_parallel_success - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract method get_allowed_tools
FAILED tests/review/test_orchestrator.py::test_run_subagents_parallel_with_timeout - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract method get_allowed_tools
FAILED tests/review/test_orchestrator.py::test_run_subagents_parallel_with_exception - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract method get_allowed_tools
FAILED tests/review/test_orchestrator.py::test_run_subagents_parallel_with_streaming - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract method get_allowed_tools
FAILED tests/review/test_orchestrator.py::test_run_review_full_workflow - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract method get_allowed_tools
FAILED tests/review/test_orchestrator.py::test_run_review_with_streaming - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract method get_allowed_tools
FAILED tests/review/test_orchestrator_entry_points.py::test_build_context_with_none_discovery_irrelevant_agent - TypeError: Can't instantiate abstract class TestReviewerAgent with abstract method get_allowed_tools
FAILED tests/review/test_orchestrator_entry_points.py::test_build_context_with_discovery_timeout - TypeError: Can't instantiate abstract class TestReviewerAgent with abstract method get_allowed_tools
FAILED tests/review/test_orchestrator_entry_points.py::test_build_context_with_discovery_error - TypeError: Can't instantiate abstract class TestReviewerAgent with abstract method get_allowed_tools
FAILED tests/review/test_orchestrator_entry_points.py::test_build_context_empty_entry_points_vs_none - TypeError: Can't instantiate abstract class TestReviewerAgent with abstract method get_allowed_tools
FAILED tests/review/test_orchestrator_entry_points.py::test_build_context_multiple_reviewers - TypeError: Can't instantiate abstract class TestReviewerAgent with abstract method get_allowed_tools
FAILED tests/review/test_orchestrator_entry_points.py::test_build_context_logs_agent_not_relevant - TypeError: Can't instantiate abstract class TestReviewerAgent with abstract method get_allowed_tools
FAILED tests/review/test_orchestrator_entry_points.py::test_build_context_backward_compatibility_without_discovery - TypeError: Can't instantiate abstract class TestReviewerAgent with abstract method get_allowed_tools
FAILED tests/review/test_orchestrator_entry_points.py::test_build_context_discovery_non_blocking - TypeError: Can't instantiate abstract class TestReviewerAgent with abstract method get_allowed_tools
FAILED tests/review/test_parity_baseline.py::TestFixtureCompatibility::test_orchestrator_compatibility_typical - TypeError: Can't instantiate abstract class MockReviewerWithFindings with abstract method get_allowed_tools
FAILED tests/review/test_pattern_learning.py::TestPatternLearning::test_base_reviewer_agent_learn_entry_point_pattern_default - TypeError: Can't instantiate abstract class TestReviewer with abstract methods get_agent_name, get_allowed_tools
FAILED tests/review/test_pattern_learning.py::TestPatternLearning::test_base_reviewer_agent_learn_entry_point_pattern_override - TypeError: Can't instantiate abstract class LearningReviewer with abstract methods get_agent_name, get_allowed_tools
FAILED tests/test_benchmarks.py::TestBenchmarkResult::test_result_to_dict - assert 0.15000000000000002 == 0.15
FAILED tests/test_benchmarks.py::TestBenchmarkRunner::test_print_summary - assert 'benchmark_name' in "\n================================================================================\nBENCHMARK REPORT: test_report\n==...else 'N/A') (memory_created=0)\n\n================================================================================\n\n"
 +  where "\n================================================================================\nBENCHMARK REPORT: test_report\n==...else 'N/A') (memory_created=0)\n\n================================================================================\n\n" = CaptureResult(out="\n================================================================================\nBENCHMARK REPOR...') (memory_created=0)\n\n================================================================================\n\n", err='').out
FAILED tests/test_cli_integration.py::TestListSessionsCommand::test_list_sessions_uses_session_service - AttributeError: <module 'dawn_kestrel.cli.main' from '/Users/parkersligting/develop/pt/worktrees/harness-agent-rework/dawn_kestrel/cli/main.py'> does not have the attribute 'DefaultSessionService'
FAILED tests/test_cli_integration.py::TestListSessionsCommand::test_list_sessions_displays_sessions - AttributeError: <module 'dawn_kestrel.cli.main' from '/Users/parkersligting/develop/pt/worktrees/harness-agent-rework/dawn_kestrel/cli/main.py'> does not have the attribute 'DefaultSessionService'
FAILED tests/test_cli_integration.py::TestExportSessionCommand::test_export_session_uses_session_service - AttributeError: <module 'dawn_kestrel.cli.main' from '/Users/parkersligting/develop/pt/worktrees/harness-agent-rework/dawn_kestrel/cli/main.py'> does not have the attribute 'GitSnapshot'
FAILED tests/test_cli_integration.py::TestExportSessionCommand::test_export_session_uses_progress_handler - AttributeError: <module 'dawn_kestrel.cli.main' from '/Users/parkersligting/develop/pt/worktrees/harness-agent-rework/dawn_kestrel/cli/main.py'> does not have the attribute 'GitSnapshot'
FAILED tests/test_cli_integration.py::TestImportSessionCommand::test_import_session_uses_session_service - AttributeError: <module 'dawn_kestrel.cli.main' from '/Users/parkersligting/develop/pt/worktrees/harness-agent-rework/dawn_kestrel/cli/main.py'> does not have the attribute 'MessageStorage'
FAILED tests/test_cli_integration.py::TestImportSessionCommand::test_import_session_uses_notification_handler - AttributeError: <module 'dawn_kestrel.cli.main' from '/Users/parkersligting/develop/pt/worktrees/harness-agent-rework/dawn_kestrel/cli/main.py'> does not have the attribute 'MessageStorage'
FAILED tests/test_cli_integration.py::TestDeprecationWarnings::test_tui_command_shows_deprecation_warning - AttributeError: <module 'dawn_kestrel.cli.main' from '/Users/parkersligting/develop/pt/worktrees/harness-agent-rework/dawn_kestrel/cli/main.py'> does not have the attribute 'DefaultSessionService'
FAILED tests/test_cli_integration.py::TestBackwardCompatibility::test_list_sessions_output_unchanged - AttributeError: <module 'dawn_kestrel.cli.main' from '/Users/parkersligting/develop/pt/worktrees/harness-agent-rework/dawn_kestrel/cli/main.py'> does not have the attribute 'DefaultSessionService'
FAILED tests/test_export_import.py::test_session_export - AttributeError: 'Session' object has no attribute 'to_dict'
FAILED tests/test_export_import.py::test_session_export_to_file - AttributeError: 'Session' object has no attribute 'to_dict'
FAILED tests/test_opencode_agents_integration.py::TestAllAgentsRegistered::test_all_bolt_merlin_agents_registered - AssertionError: Agent orchestrator not registered
assert 'orchestrator' in [Agent(name='build', description='The default agent. Executes tools based on configured permissions.', mode='primary',...opic/claude-opus-4-6', 'max_tokens': 64000, 'thinking': {'type': 'enabled', 'budget_tokens': 48000}}, steps=None), ...]
FAILED tests/test_opencode_agents_integration.py::TestSkillUsage::test_frontend_ui_ux_skill_available - assert ('frontend' in "# role: designer-turned-developer\n\nyou are a designer who learned to code. you see what pure developers missspacin... dark themes, different fonts, different aesthetics. you are capable of extraordinary creative workdon't hold back.\n" or 'ui/ux' in "# role: designer-turned-developer\n\nyou are a designer who learned to code. you see what pure developers missspacin... dark themes, different fonts, different aesthetics. you are capable of extraordinary creative workdon't hold back.\n")
 +  where "# role: designer-turned-developer\n\nyou are a designer who learned to code. you see what pure developers missspacin... dark themes, different fonts, different aesthetics. you are capable of extraordinary creative workdon't hold back.\n" = <built-in method lower of str object at 0x107131200>()
 +    where <built-in method lower of str object at 0x107131200> = "# Role: Designer-Turned-Developer\n\nYou are a designer who learned to code. You see what pure developers missspacin... dark themes, different fonts, different aesthetics. You are capable of extraordinary creative workdon't hold back.\n".lower
 +  and   "# role: designer-turned-developer\n\nyou are a designer who learned to code. you see what pure developers missspacin... dark themes, different fonts, different aesthetics. you are capable of extraordinary creative workdon't hold back.\n" = <built-in method lower of str object at 0x107131200>()
 +    where <built-in method lower of str object at 0x107131200> = "# Role: Designer-Turned-Developer\n\nYou are a designer who learned to code. You see what pure developers missspacin... dark themes, different fonts, different aesthetics. You are capable of extraordinary creative workdon't hold back.\n".lower
FAILED tests/test_opencode_agents_integration.py::TestToolPermissionFiltering::test_explore_specific_permissions - AssertionError: assert 'grep' in {}
 +  where {} = <dawn_kestrel.tools.framework.ToolRegistry object at 0x112463a90>.tools
FAILED tests/test_planning_docs_migration.py::test_migration_doc_required_sections_present - FileNotFoundError: [Errno 2] No such file or directory: '/Users/parkersligting/develop/pt/worktrees/docs/planning-agent-orchestration.md'
FAILED tests/test_planning_docs_migration.py::test_policy_precedence_has_no_contradictions - FileNotFoundError: [Errno 2] No such file or directory: '/Users/parkersligting/develop/pt/worktrees/docs/planning-agent-orchestration.md'
FAILED tests/test_planning_docs_migration.py::test_runtime_surface_paths_exist - AssertionError: Missing required migration surface: /Users/parkersligting/develop/pt/worktrees/docs/planning-agent-orchestration.md
assert False
 +  where False = exists()
 +    where exists = PosixPath('/Users/parkersligting/develop/pt/worktrees/docs/planning-agent-orchestration.md').exists
FAILED tests/test_planning_docs_migration.py::test_migration_notes_preserve_plan_safety_semantics - FileNotFoundError: [Errno 2] No such file or directory: '/Users/parkersligting/develop/pt/worktrees/docs/planning-agent-orchestration.md'
FAILED tests/test_planning_prompt_contract.py::test_required_sections_present - FileNotFoundError: [Errno 2] No such file or directory: '/Users/parkersligting/develop/pt/worktrees/docs/planning-agent-orchestration.md'
FAILED tests/test_planning_prompt_contract.py::test_forbidden_vague_directives_absent - FileNotFoundError: [Errno 2] No such file or directory: '/Users/parkersligting/develop/pt/worktrees/docs/planning-agent-orchestration.md'
FAILED tests/test_planning_prompt_contract.py::test_stagnation_trigger_forces_strategy_switch - FileNotFoundError: [Errno 2] No such file or directory: '/Users/parkersligting/develop/pt/worktrees/docs/planning-agent-orchestration.md'
FAILED tests/test_planning_prompt_contract.py::test_budget_exhaustion_emits_single_blocking_question - FileNotFoundError: [Errno 2] No such file or directory: '/Users/parkersligting/develop/pt/worktrees/docs/planning-agent-orchestration.md'
FAILED tests/test_planning_prompt_contract.py::test_rejects_evidence_theater_outputs - FileNotFoundError: [Errno 2] No such file or directory: '/Users/parkersligting/develop/pt/worktrees/docs/planning-agent-orchestration.md'
FAILED tests/test_planning_prompt_contract.py::test_prevents_over_interviewing_after_budget_limit - FileNotFoundError: [Errno 2] No such file or directory: '/Users/parkersligting/develop/pt/worktrees/docs/planning-agent-orchestration.md'
FAILED tests/test_sdk_async_client.py::TestOpenCodeAsyncClientSessionMethods::test_async_client_create_session - dawn_kestrel.core.exceptions.SessionError: Failed to create session: object Mock can't be used in 'await' expression
FAILED tests/test_sdk_async_client.py::TestOpenCodeAsyncClientSessionMethods::test_async_client_delete_session - dawn_kestrel.core.exceptions.SessionError: Failed to delete session: object Mock can't be used in 'await' expression
FAILED tests/test_sdk_async_client.py::TestOpenCodeAsyncClientSessionMethods::test_async_client_delete_session_not_found - dawn_kestrel.core.exceptions.SessionError: Failed to delete session: object Mock can't be used in 'await' expression
FAILED tests/test_sdk_async_client.py::TestOpenCodeAsyncClientSessionMethods::test_async_client_add_message - dawn_kestrel.core.exceptions.SessionError: Failed to add message: expected str, bytes or os.PathLike object, not Mock
FAILED tests/test_sdk_async_client.py::TestOpenCodeAsyncClientAgentMethods::test_async_client_register_agent - AttributeError: 'AgentRuntime' object has no attribute 'get_agent'
FAILED tests/test_sdk_async_client.py::TestOpenCodeAsyncClientAgentMethods::test_async_client_execute_agent - AttributeError: module 'dawn_kestrel.sdk.client' has no attribute 'AgentRuntime'
FAILED tests/test_sdk_async_client.py::TestOpenCodeAsyncClientAgentMethods::test_async_client_execute_agent_with_options - dawn_kestrel.core.exceptions.SessionError: Failed to execute agent: object Mock can't be used in 'await' expression
FAILED tests/test_sdk_sync_client.py::TestOpenCodeClientInitialization::test_sync_client_initialization_default - AssertionError: assert <dawn_kestrel.sdk.client.OpenCodeAsyncClient object at 0x115c0c110> == <Mock name='SessionStorage()' id='4659219984'>
 +  where <dawn_kestrel.sdk.client.OpenCodeAsyncClient object at 0x115c0c110> = <dawn_kestrel.sdk.client.OpenCodeSyncClient object at 0x115c0fd10>._async_client
FAILED tests/test_sdk_sync_client.py::TestOpenCodeClientInitialization::test_sync_client_initialization_with_sdk_config - AssertionError: assert <dawn_kestrel.sdk.client.OpenCodeAsyncClient object at 0x114dfd290> == <Mock name='SessionStorage()' id='4645189968'>
 +  where <dawn_kestrel.sdk.client.OpenCodeAsyncClient object at 0x114dfd290> = <dawn_kestrel.sdk.client.OpenCodeSyncClient object at 0x114dff2d0>._async_client
FAILED tests/test_sdk_sync_client.py::TestOpenCodeClientInitialization::test_sync_client_initialization_with_handlers - AssertionError: assert <dawn_kestrel.sdk.client.OpenCodeAsyncClient object at 0x114a8e890> == <Mock name='SessionStorage()' id='4641574352'>
 +  where <dawn_kestrel.sdk.client.OpenCodeAsyncClient object at 0x114a8e890> = <dawn_kestrel.sdk.client.OpenCodeSyncClient object at 0x114a8e210>._async_client
FAILED tests/test_sdk_sync_client.py::TestOpenCodeClientCallbacks::test_on_progress_callback_registration - AttributeError: 'OpenCodeSyncClient' object has no attribute '_on_progress'
FAILED tests/test_sdk_sync_client.py::TestOpenCodeClientCallbacks::test_on_notification_callback_registration - AttributeError: 'OpenCodeSyncClient' object has no attribute '_on_notification'
FAILED tests/test_sdk_sync_client.py::TestOpenCodeClientSessionMethods::test_sync_client_create_session - dawn_kestrel.core.exceptions.SessionError: Failed to create session: object Mock can't be used in 'await' expression
FAILED tests/test_sdk_sync_client.py::TestOpenCodeClientSessionMethods::test_sync_client_get_session - dawn_kestrel.core.exceptions.SessionError: Failed to get session: object Mock can't be used in 'await' expression
FAILED tests/test_sdk_sync_client.py::TestOpenCodeClientSessionMethods::test_sync_client_get_session_not_found - dawn_kestrel.core.exceptions.SessionError: Failed to get session: object Mock can't be used in 'await' expression
FAILED tests/test_sdk_sync_client.py::TestOpenCodeClientSessionMethods::test_sync_client_list_sessions - dawn_kestrel.core.exceptions.SessionError: Failed to list sessions: object Mock can't be used in 'await' expression
FAILED tests/test_sdk_sync_client.py::TestOpenCodeClientSessionMethods::test_sync_client_delete_session - dawn_kestrel.core.exceptions.SessionError: Failed to delete session: object Mock can't be used in 'await' expression
FAILED tests/test_sdk_sync_client.py::TestOpenCodeClientSessionMethods::test_sync_client_delete_session_not_found - dawn_kestrel.core.exceptions.SessionError: Failed to delete session: object Mock can't be used in 'await' expression
FAILED tests/test_sdk_sync_client.py::TestOpenCodeClientSessionMethods::test_sync_client_add_message - dawn_kestrel.core.exceptions.SessionError: Failed to add message: object Mock can't be used in 'await' expression
FAILED tests/test_sdk_sync_client.py::TestOpenCodeClientSessionMethods::test_sync_client_uses_asyncio_run - AttributeError: 'function' object has no attribute 'assert_called_once'
FAILED tests/test_sdk_sync_client.py::TestOpenCodeClientAsyncIntegration::test_sync_client_handler_integration - AssertionError: assert <dawn_kestrel.sdk.client.OpenCodeAsyncClient object at 0x1122024d0> == <Mock name='SessionStorage()' id='4599057488'>
 +  where <dawn_kestrel.sdk.client.OpenCodeAsyncClient object at 0x1122024d0> = <dawn_kestrel.sdk.client.OpenCodeSyncClient object at 0x112202d50>._async_client
FAILED tests/test_settings_accounts.py::TestSettingsAccounts::test_accounts_field_default_empty_dict - AssertionError: assert {'default': A...default=True)} == {}
  
  Left contains 1 more item:
  {'default': AccountConfig(account_name='default', provider_id=<ProviderID.Z_AI_CODING_PLAN: 'zai-coding-plan'>, api_key=SecretStr('**********'), model='glm-4.7', base_url=None, options={}, is_default=True)}
  
  Full diff:
  - {}
  + {
  +     'default': AccountConfig(account_name='default', provider_id=<ProviderID.Z_AI_CODING_PLAN: 'zai-coding-plan'>, api_key=SecretStr('**********'), model='glm-4.7', base_url=None, options={}, is_default=True),
  + }
FAILED tests/test_settings_accounts.py::TestSettingsAccounts::test_get_default_account_returns_default - AssertionError: assert 'default' == 'openai-default'
  
  - openai-default
  + default
FAILED tests/test_settings_accounts.py::TestSettingsAccounts::test_get_default_account_falls_back_to_provider_default - AssertionError: assert 'default' == 'anthropic-1'
  
  - anthropic-1
  + default
FAILED tests/test_settings_accounts.py::TestSettingsAccounts::test_get_default_account_synthesizes_from_env - AssertionError: assert <ProviderID.Z...-coding-plan'> == <ProviderID.OPENAI: 'openai'>
  
  - openai
  + zai-coding-plan
FAILED tests/test_settings_accounts.py::TestSettingsAccounts::test_get_default_account_prefers_dawn_prefix_env_over_legacy - AssertionError: assert <ProviderID.Z...-coding-plan'> == <ProviderID.OPENAI: 'openai'>
  
  - openai
  + zai-coding-plan
FAILED tests/test_tool_tracking.py::TestToolExecutionTracker::test_get_execution_history - TypeError: '<' not supported between instances of 'NoneType' and 'NoneType'
FAILED tests/test_tool_tracking.py::TestToolExecutionTracker::test_get_execution_history_with_limit - TypeError: '<' not supported between instances of 'NoneType' and 'NoneType'
FAILED tests/test_tool_tracking.py::TestToolExecutionTracker::test_update_execution_not_found - FileNotFoundError: [Errno 2] No such file or directory: '/var/folders/7q/3wffhx8n6j927vjvnwqb7fxm0000gp/T/tmp0uurqask/storage/tool_execution'
FAILED tests/test_tool_tracking.py::TestSessionLifecycle::test_listener_protocol_message_added - AssertionError: Expected 'on_message_added' to have been called once. Called 0 times.
FAILED tests/test_tool_tracking.py::TestSessionLifecycle::test_listener_error_handling - AssertionError: Expected 'on_session_created' to have been called once. Called 0 times.
FAILED tests/test_tool_tracking.py::TestSessionLifecycle::test_event_bus_integration_session_created - TypeError: 'coroutine' object is not callable
FAILED tests/test_tool_tracking.py::TestSessionLifecycle::test_event_bus_integration_message_added - TypeError: 'coroutine' object is not callable
FAILED tests/test_tool_tracking.py::TestSessionLifecycle::test_event_bus_integration_session_deleted - TypeError: 'coroutine' object is not callable
ERROR tests/review/test_orchestrator_entry_points.py::test_build_context_extract_agent_name - TypeError: Can't instantiate abstract class TestReviewerAgent with abstract method get_allowed_tools
ERROR tests/review/test_orchestrator_entry_points.py::test_build_context_with_successful_discovery - TypeError: Can't instantiate abstract class TestReviewerAgent with abstract method get_allowed_tools
ERROR tests/review/test_orchestrator_entry_points.py::test_build_context_with_none_discovery_relevant_agent - TypeError: Can't instantiate abstract class TestReviewerAgent with abstract method get_allowed_tools
ERROR tests/review/test_orchestrator_entry_points.py::test_build_context_filters_files_to_entry_points - TypeError: Can't instantiate abstract class TestReviewerAgent with abstract method get_allowed_tools
ERROR tests/review/test_orchestrator_entry_points.py::test_build_context_discovery_integration_parameters - TypeError: Can't instantiate abstract class TestReviewerAgent with abstract method get_allowed_tools
ERROR tests/review/test_orchestrator_entry_points.py::test_build_context_logs_discovery_success - TypeError: Can't instantiate abstract class TestReviewerAgent with abstract method get_allowed_tools
ERROR tests/review/test_orchestrator_entry_points.py::test_build_context_logs_fallback - TypeError: Can't instantiate abstract class TestReviewerAgent with abstract method get_allowed_tools
ERROR tests/review/test_orchestrator_entry_points.py::test_build_context_populates_all_fields - TypeError: Can't instantiate abstract class TestReviewerAgent with abstract method get_allowed_tools
ERROR tests/review/test_parity_baseline.py::TestFixtureCompatibility::test_orchestrator_compatibility_minimal - TypeError: Can't instantiate abstract class MockReviewer with abstract method get_allowed_tools
ERROR tests/review/test_parity_baseline.py::TestFixtureCompatibility::test_orchestrator_deduplication - TypeError: Can't instantiate abstract class MockReviewer with abstract method get_allowed_tools
ERROR tests/review/test_self_verification.py::TestSelfVerification::test_verify_findings_with_valid_findings - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
ERROR tests/review/test_self_verification.py::TestSelfVerification::test_verify_findings_with_empty_findings - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
ERROR tests/review/test_self_verification.py::TestSelfVerification::test_verify_findings_with_invalid_finding_objects - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
ERROR tests/review/test_self_verification.py::TestSelfVerification::test_verify_findings_evidence_structure_complete - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
ERROR tests/review/test_self_verification.py::TestSelfVerification::test_extract_search_terms_with_quoted_strings - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
ERROR tests/review/test_self_verification.py::TestSelfVerification::test_extract_search_terms_with_single_quotes - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
ERROR tests/review/test_self_verification.py::TestSelfVerification::test_extract_search_terms_with_code_identifiers - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
ERROR tests/review/test_self_verification.py::TestSelfVerification::test_extract_search_terms_with_assignments - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
ERROR tests/review/test_self_verification.py::TestSelfVerification::test_extract_search_terms_with_title_all_caps - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
ERROR tests/review/test_self_verification.py::TestSelfVerification::test_extract_search_terms_filters_common_words - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
ERROR tests/review/test_self_verification.py::TestSelfVerification::test_extract_search_terms_limits_to_five_terms - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
ERROR tests/review/test_self_verification.py::TestSelfVerification::test_extract_search_terms_filters_empty_strings - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
ERROR tests/review/test_self_verification.py::TestSelfVerification::test_extract_search_terms_mixed_patterns - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
ERROR tests/review/test_self_verification.py::TestSelfVerification::test_extract_search_terms_case_sensitive - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
ERROR tests/review/test_self_verification.py::TestSelfVerification::test_grep_files_with_mock_files - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
ERROR tests/review/test_self_verification.py::TestSelfVerification::test_grep_files_timeout - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
ERROR tests/review/test_self_verification.py::TestSelfVerification::test_grep_files_no_matches - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
ERROR tests/review/test_self_verification.py::TestSelfVerification::test_grep_files_multiple_files - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
ERROR tests/review/test_self_verification.py::TestSelfVerification::test_grep_files_file_not_exists - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
ERROR tests/review/test_self_verification.py::TestSelfVerification::test_grep_uses_fixed_string_matching - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
ERROR tests/review/test_self_verification.py::TestSelfVerification::test_grep_uses_line_numbers - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
ERROR tests/review/test_self_verification.py::TestSelfVerification::test_grep_parsing_line_numbers - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
ERROR tests/review/test_self_verification.py::TestSelfVerification::test_grep_malformed_output - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
ERROR tests/review/test_self_verification.py::TestSelfVerification::test_backward_compatibility_existing_methods - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
ERROR tests/review/test_self_verification.py::TestSelfVerification::test_performance_multiple_findings_multiple_terms - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
ERROR tests/review/test_self_verification.py::TestSelfVerification::test_empty_evidence_and_title - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
ERROR tests/review/test_self_verification.py::TestSelfVerification::test_very_long_evidence - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
ERROR tests/review/test_self_verification.py::TestSelfVerification::test_special_characters_in_pattern - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
ERROR tests/review/test_self_verification.py::TestSelfVerification::test_unicode_in_evidence - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
ERROR tests/review/test_self_verification.py::TestSelfVerification::test_verify_findings_logs_warnings - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
ERROR tests/review/test_self_verification.py::TestSelfVerification::test_full_verification_workflow - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
ERROR tests/review/test_self_verification.py::TestSelfVerification::test_multiple_search_terms_per_finding - TypeError: Can't instantiate abstract class MockReviewerAgent with abstract methods get_agent_name, get_allowed_tools
147 failed, 988 passed, 2 skipped, 108 warnings, 42 errors in 114.06s (0:01:54)
